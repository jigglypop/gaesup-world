"use strict";var an=Object.defineProperty;var on=(n,e,t)=>e in n?an(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var j=(n,e,t)=>on(n,typeof e!="symbol"?e+"":e,t);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const h=require("react"),cn=require("three"),q=require("@react-three/rapier"),L=require("@react-three/drei"),U=require("@react-three/fiber"),Ae=require("three-stdlib");function ln(n){const e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(n){for(const t in n)if(t!=="default"){const i=Object.getOwnPropertyDescriptor(n,t);Object.defineProperty(e,t,i.get?i:{enumerable:!0,get:()=>n[t]})}}return e.default=n,Object.freeze(e)}const y=ln(cn),Ge=n=>{let e;const t=new Set,i=(l,d)=>{const m=typeof l=="function"?l(e):l;if(!Object.is(m,e)){const p=e;e=d??(typeof m!="object"||m===null)?m:Object.assign({},e,m),t.forEach(M=>M(e,p))}},s=()=>e,c={setState:i,getState:s,getInitialState:()=>u,subscribe:l=>(t.add(l),()=>t.delete(l))},u=e=n(i,s,c);return c},un=n=>n?Ge(n):Ge,dn=n=>n;function mn(n,e=dn){const t=h.useSyncExternalStore(n.subscribe,()=>e(n.getState()),()=>e(n.getInitialState()));return h.useDebugValue(t),t}const Le=n=>{const e=un(n),t=i=>mn(e,i);return Object.assign(t,e),t},it=n=>n?Le(n):Le,Fe={BASE_URL:"/",DEV:!1,MODE:"cjs",PROD:!0,SSR:!1},ee=new Map,se=n=>{const e=ee.get(n);return e?Object.fromEntries(Object.entries(e.stores).map(([t,i])=>[t,i.getState()])):{}},hn=(n,e,t)=>{if(n===void 0)return{type:"untracked",connection:e.connect(t)};const i=ee.get(t.name);if(i)return{type:"tracked",store:n,...i};const s={connection:e.connect(t),stores:{}};return ee.set(t.name,s),{type:"tracked",store:n,...s}},fn=(n,e)=>{if(e===void 0)return;const t=ee.get(n);t&&(delete t.stores[e],Object.keys(t.stores).length===0&&ee.delete(n))},pn=n=>{var e,t;if(!n)return;const i=n.split(`
`),s=i.findIndex(o=>o.includes("api.setState"));if(s<0)return;const a=((e=i[s+1])==null?void 0:e.trim())||"";return(t=/.+ (.+) .+/.exec(a))==null?void 0:t[1]},gn=(n,e={})=>(t,i,s)=>{const{enabled:a,anonymousActionType:o,store:c,...u}=e;let l;try{l=(a??(Fe?"cjs":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!l)return n(t,i,s);const{connection:d,...m}=hn(c,l,u);let p=!0;s.setState=(b,f,x)=>{const g=t(b,f);if(!p)return g;const v=x===void 0?{type:o||pn(new Error().stack)||"anonymous"}:typeof x=="string"?{type:x}:x;return c===void 0?(d==null||d.send(v,i()),g):(d==null||d.send({...v,type:`${c}/${v.type}`},{...se(u.name),[c]:s.getState()}),g)},s.devtools={cleanup:()=>{d&&typeof d.unsubscribe=="function"&&d.unsubscribe(),fn(u.name,c)}};const M=(...b)=>{const f=p;p=!1,t(...b),p=f},S=n(s.setState,i,s);if(m.type==="untracked"?d==null||d.init(S):(m.stores[m.store]=s,d==null||d.init(Object.fromEntries(Object.entries(m.stores).map(([b,f])=>[b,b===m.store?S:f.getState()])))),s.dispatchFromDevtools&&typeof s.dispatch=="function"){let b=!1;const f=s.dispatch;s.dispatch=(...x)=>{(Fe?"cjs":void 0)!=="production"&&x[0].type==="__setState"&&!b&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),b=!0),f(...x)}}return d.subscribe(b=>{var f;switch(b.type){case"ACTION":if(typeof b.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return ye(b.payload,x=>{if(x.type==="__setState"){if(c===void 0){M(x.state);return}Object.keys(x.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format.
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const g=x.state[c];if(g==null)return;JSON.stringify(s.getState())!==JSON.stringify(g)&&M(g);return}s.dispatchFromDevtools&&typeof s.dispatch=="function"&&s.dispatch(x)});case"DISPATCH":switch(b.payload.type){case"RESET":return M(S),c===void 0?d==null?void 0:d.init(s.getState()):d==null?void 0:d.init(se(u.name));case"COMMIT":if(c===void 0){d==null||d.init(s.getState());return}return d==null?void 0:d.init(se(u.name));case"ROLLBACK":return ye(b.state,x=>{if(c===void 0){M(x),d==null||d.init(s.getState());return}M(x[c]),d==null||d.init(se(u.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return ye(b.state,x=>{if(c===void 0){M(x);return}JSON.stringify(s.getState())!==JSON.stringify(x[c])&&M(x[c])});case"IMPORT_STATE":{const{nextLiftedState:x}=b.payload,g=(f=x.computedStates.slice(-1)[0])==null?void 0:f.state;if(!g)return;M(c===void 0?g:g[c]),d==null||d.send(null,x);return}case"PAUSE_RECORDING":return p=!p}return}}),S},yn=gn,ye=(n,e)=>{let t;try{t=JSON.parse(n)}catch(i){console.error("[zustand devtools middleware] Could not parse the received json",i)}t!==void 0&&e(t)},xn=n=>(e,t,i)=>{const s=i.subscribe;return i.subscribe=(o,c,u)=>{let l=o;if(c){const d=(u==null?void 0:u.equalityFn)||Object.is;let m=o(i.getState());l=p=>{const M=o(p);if(!d(m,M)){const S=m;c(m=M,S)}},u!=null&&u.fireImmediately&&c(m,m)}return s(l)},n(e,t,i)},bn=xn,vn={characterUrl:"",vehicleUrl:"",airplaneUrl:"",wheelUrl:"",ridingUrl:""},wn=n=>({urls:vn,setUrls:e=>n(t=>({urls:{...t.urls,...e}}))}),Sn={type:"character",controller:"keyboard",control:"thirdPerson"},Cn={lerp:{cameraTurn:1,cameraPosition:1}},jn=n=>({mode:Sn,controllerOptions:Cn,setMode:e=>n(t=>({mode:{...t.mode,...e}})),setControllerOptions:e=>n(t=>({controllerOptions:{...t.controllerOptions,...e}}))}),Mn=n=>({block:{camera:!1,control:!1,animation:!1,scroll:!0},setBlock:e=>n(t=>({block:{...t.block,...e}}))}),_e=new y.Vector3,Ue=new y.Vector3(0,0,1),Ce=[],kn=new y.Vector3(0,0,0),En=new y.Vector3(1,1,1);function me(){return Ce.pop()||new y.Vector3}function An(n){Ce.length<50&&(n.set(0,0,0),Ce.push(n))}function Rn(n){return n.x!==0&&n.y!==0&&n.z!==0}function st(n,e,t){const i=n.x-e.x,s=n.y-e.y,a=n.z-e.z;return Math.sqrt(i*i+(t?s*s:0)+a*a)}const Nn=(n,e)=>n?e:kn,In=(n,e)=>n?e:En;function rt(n){const e=n.dot(Ue)/n.length(),t=Math.acos(Math.max(-1,Math.min(1,e)));_e.copy(n).cross(Ue);const i=Math.sin(_e.y)||1;return Math.PI-t*i}const Tn=n=>n instanceof y.Vector3?[n.x,n.y,n.z]:n instanceof y.Euler?[n.x,n.y,n.z]:n,On=n=>n instanceof y.Vector3?n:H(n[0],n[1],n[2]),Dn=n=>n instanceof y.Euler?n:at(n[0],n[1],n[2]),H=(n=0,e=0,t=0)=>{const i=me();return i.set(n,e,t),i},Pn=(n=0,e=0,t=0,i=1)=>new y.Quaternion(n,e,t,i),at=(n=0,e=0,t=0)=>new y.Euler(n,e,t),zn=()=>me(),Vn=()=>H(1,1,1),I={OFFSET:H(-10,-10,-10),MAX_DISTANCE:-7,DISTANCE:-1,X_DISTANCE:15,Y_DISTANCE:8,Z_DISTANCE:15,ZOOM:1,TARGET:H(0,0,0),POSITION:H(-15,8,-15),FOCUS:!1,ENABLE_COLLISION:!0,COLLISION_MARGIN:.1,SMOOTHING:{POSITION:.08,ROTATION:.1,FOV:.1},FOV:75,MIN_FOV:10,MAX_FOV:120,BOUNDS:{MIN_Y:2,MAX_Y:50}},ot=n=>({cameraOption:{offset:I.OFFSET,maxDistance:I.MAX_DISTANCE,distance:I.DISTANCE,xDistance:I.X_DISTANCE,yDistance:I.Y_DISTANCE,zDistance:I.Z_DISTANCE,zoom:I.ZOOM,target:I.TARGET,position:I.POSITION,focus:I.FOCUS,enableCollision:I.ENABLE_COLLISION,collisionMargin:I.COLLISION_MARGIN,smoothing:{position:I.SMOOTHING.POSITION,rotation:I.SMOOTHING.ROTATION,fov:I.SMOOTHING.FOV},fov:I.FOV,minFov:I.MIN_FOV,maxFov:I.MAX_FOV,bounds:{minY:I.BOUNDS.MIN_Y,maxY:I.BOUNDS.MAX_Y},modeSettings:{}},setCameraOption:e=>n(t=>({cameraOption:{...t.cameraOption,...e}}))}),Gn=()=>({name:"default",type:"thirdPerson",position:new y.Vector3(0,5,10),rotation:new y.Euler(0,0,0),fov:75,config:{distance:10,height:5,followSpeed:.1,rotationSpeed:.1},priority:0,tags:[]}),Ln=()=>[{from:"character",to:"vehicle",duration:1,easing:"easeInOut"},{from:"vehicle",to:"airplane",duration:1.5,easing:"easeOut"}],ct=n=>({cameraStates:new Map([["default",Gn()]]),cameraTransitions:Ln(),currentCameraStateName:"default",cameraStateHistory:["default"],setCameraStates:e=>{n({cameraStates:e})},setCameraTransitions:e=>{n({cameraTransitions:e})},setCurrentCameraStateName:e=>{n(t=>({currentCameraStateName:e,cameraStateHistory:[...t.cameraStateHistory,e]}))},setCameraStateHistory:e=>{n({cameraStateHistory:e})},addCameraState:(e,t)=>{n(i=>{const s=new Map(i.cameraStates);return s.set(e,t),{cameraStates:s}})},updateCurrentCameraState:e=>{n(t=>{const i=t.cameraStates.get(t.currentCameraStateName);if(i){const s={...i,...e},a=new Map(t.cameraStates);return a.set(t.currentCameraStateName,s),{cameraStates:a}}return t})},zoomIn:()=>{n(e=>{var i;const t=e.cameraStates.get(e.currentCameraStateName);if(t&&t.config.distance){const s=Math.max(t.config.distance-.5,((i=t.config.constraints)==null?void 0:i.minDistance)||1),a=new Map(e.cameraStates);return a.set(e.currentCameraStateName,{...t,config:{...t.config,distance:s}}),{cameraStates:a}}return e})},zoomOut:()=>{n(e=>{var i;const t=e.cameraStates.get(e.currentCameraStateName);if(t&&t.config.distance){const s=Math.min(t.config.distance+.5,((i=t.config.constraints)==null?void 0:i.maxDistance)||20),a=new Map(e.cameraStates);return a.set(e.currentCameraStateName,{...t,config:{...t.config,distance:s}}),{cameraStates:a}}return e})},setZoom:e=>{n(t=>{var s,a;const i=t.cameraStates.get(t.currentCameraStateName);if(i){const o=Math.max(((s=i.config.constraints)==null?void 0:s.minDistance)||1,Math.min(e,((a=i.config.constraints)==null?void 0:a.maxDistance)||20)),c=new Map(t.cameraStates);return c.set(t.currentCameraStateName,{...i,config:{...i.config,distance:o}}),{cameraStates:c}}return t})},setRotation:e=>{n(t=>{const i=t.cameraStates.get(t.currentCameraStateName);if(i){const s=new Map(t.cameraStates);return s.set(t.currentCameraStateName,{...i,rotation:e}),{cameraStates:s}}return t})}}),Fn=n=>({minimap:{props:{}},addMinimapMarker:(e,t)=>n(i=>({minimap:{props:{...i.minimap.props,[e]:t}}})),removeMinimapMarker:e=>n(t=>{const i={...t.minimap.props};return delete i[e],{minimap:{props:i}}})}),_n=n=>({sizes:{},setSizes:e=>n(t=>({sizes:e(t.sizes)}))}),Be={character:{current:"idle",default:"idle",store:{}},vehicle:{current:"idle",default:"idle",store:{}},airplane:{current:"idle",default:"idle",store:{}}},lt=(n,e)=>({animationState:Be,setAnimation:(t,i)=>{n(s=>({animationState:{...s.animationState,[t]:{...s.animationState[t],current:i}}}))},resetAnimations:()=>n(()=>({animationState:Be})),setAnimationAction:(t,i,s)=>n(a=>({animationState:{...a.animationState,[t]:{...a.animationState[t],store:{...a.animationState[t].store,[i]:s}}}}))}),qe=()=>({isActive:!1,currentPreset:"normal",motionType:"character",position:new y.Vector3,velocity:new y.Vector3,rotation:new y.Euler,speed:0,direction:new y.Vector3,isGrounded:!1,isMoving:!1,lastUpdate:0}),He=()=>({maxSpeed:10,acceleration:15,deceleration:10,turnSpeed:8,jumpForce:12,gravity:-30,linearDamping:.95,angularDamping:.85}),We=()=>({currentSpeed:0,averageSpeed:0,totalDistance:0,frameTime:0,physicsTime:0,isAccelerating:!1,groundContact:!1,lastPosition:new y.Vector3}),Un=(n,e)=>({motion:qe(),config:He(),metrics:We(),entities:new Map,activeEntityId:null,setMotionActive:t=>n(i=>({motion:{...i.motion,isActive:t}})),setCurrentPreset:t=>n(i=>({motion:{...i.motion,currentPreset:t}})),setMotionType:t=>n(i=>({motion:{...i.motion,motionType:t}})),updatePosition:t=>n(i=>({motion:{...i.motion,position:t.clone()}})),updateVelocity:t=>n(i=>{const s=t.length();return{motion:{...i.motion,velocity:t.clone(),speed:s,isMoving:s>.1}}}),updateRotation:t=>n(i=>({motion:{...i.motion,rotation:t.clone()}})),setGrounded:t=>n(i=>({motion:{...i.motion,isGrounded:t}})),updateConfig:t=>n(i=>({config:{...i.config,...t}})),updateMetrics:t=>n(i=>({metrics:{...i.metrics,...t}})),registerEntity:(t,i)=>n(s=>{const a=new Map(s.entities);return a.set(t,i),{entities:a,activeEntityId:s.activeEntityId||t}}),unregisterEntity:t=>n(i=>{const s=new Map(i.entities);return s.delete(t),{entities:s,activeEntityId:i.activeEntityId===t?null:i.activeEntityId}}),setActiveEntity:t=>n(i=>({activeEntityId:i.entities.has(t)?t:null})),resetMotion:()=>n(()=>({motion:qe(),config:He(),metrics:We(),entities:new Map,activeEntityId:null}))}),$e=()=>({keyboard:{forward:!1,backward:!1,leftward:!1,rightward:!1,shift:!1,space:!1,keyZ:!1,keyR:!1,keyF:!1,keyE:!1,escape:!1},mouse:{target:new y.Vector3,angle:0,isActive:!1,shouldRun:!1,buttons:{left:!1,right:!1,middle:!1},wheel:0,position:new y.Vector2},gamepad:{connected:!1,leftStick:new y.Vector2,rightStick:new y.Vector2,triggers:{left:0,right:0},buttons:{},vibration:{weak:0,strong:0}},touch:{touches:[],gestures:{pinch:1,rotation:0,pan:new y.Vector2}},lastUpdate:0,isActive:!0}),Ke=()=>({isActive:!1,queue:{actions:[],currentIndex:0,isRunning:!1,isPaused:!1,loop:!1,maxRetries:3},currentAction:null,executionStats:{totalExecuted:0,successRate:100,averageTime:0,errors:[]},settings:{throttle:100,autoStart:!1,trackProgress:!0,showVisualCues:!0}}),Ye=()=>({isActive:!0,lastCommand:null,commandHistory:[],syncStatus:"idle"}),Qe=()=>({sensitivity:{mouse:1,gamepad:1,touch:1},deadzone:{gamepad:.1,touch:.05},smoothing:{mouse:.1,gamepad:.2},invertY:!1,enableVibration:!0}),Xe=()=>({maxConcurrentActions:1,defaultDelay:100,retryDelay:1e3,timeoutDuration:5e3,enableLogging:!0,visualCues:{showPath:!0,showTargets:!0,lineColor:"#00ff00",targetColor:"#ff0000"}}),Je=()=>({inputLatency:0,frameTime:0,eventCount:0,activeInputs:[],performanceScore:100}),Ze=()=>({queueLength:0,executionTime:0,performance:100,memoryUsage:0,errorRate:0}),ut=(n,e)=>({interaction:$e(),automation:Ke(),bridge:Ye(),config:{interaction:Qe(),automation:Xe()},metrics:{interaction:Je(),automation:Ze()},addAutomationAction:t=>{const i=`action_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,s={...t,id:i,timestamp:Date.now()};return n(a=>({automation:{...a.automation,queue:{...a.automation.queue,actions:[...a.automation.queue.actions,s]}}})),i},removeAutomationAction:t=>n(i=>({automation:{...i.automation,queue:{...i.automation.queue,actions:i.automation.queue.actions.filter(s=>s.id!==t)}}})),startAutomation:()=>n(t=>({automation:{...t.automation,queue:{...t.automation.queue,isRunning:!0,isPaused:!1}}})),pauseAutomation:()=>n(t=>({automation:{...t.automation,queue:{...t.automation.queue,isPaused:!0}}})),resumeAutomation:()=>n(t=>({automation:{...t.automation,queue:{...t.automation.queue,isPaused:!1}}})),stopAutomation:()=>n(t=>({automation:{...t.automation,queue:{...t.automation.queue,isRunning:!1,isPaused:!1,currentIndex:0},currentAction:null}})),clearAutomationQueue:()=>n(t=>({automation:{...t.automation,queue:{...t.automation.queue,actions:[],currentIndex:0}}})),updateAutomationSettings:t=>n(i=>({automation:{...i.automation,settings:{...i.automation.settings,...t}}})),updateInteractionConfig:t=>n(i=>({config:{...i.config,interaction:{...i.config.interaction,...t}}})),updateAutomationConfig:t=>n(i=>({config:{...i.config,automation:{...i.config.automation,...t}}})),updateInteractionMetrics:t=>n(i=>({metrics:{...i.metrics,interaction:{...i.metrics.interaction,...t}}})),updateAutomationMetrics:t=>n(i=>({metrics:{...i.metrics,automation:{...i.metrics.automation,...t}}})),setBridgeStatus:t=>n(i=>({bridge:{...i.bridge,syncStatus:t}})),addCommandToHistory:t=>n(i=>({bridge:{...i.bridge,lastCommand:t,commandHistory:[...i.bridge.commandHistory,t].slice(-100)}})),resetInteractions:()=>n(()=>({interaction:$e(),automation:Ke(),bridge:Ye(),config:{interaction:Qe(),automation:Xe()},metrics:{interaction:Je(),automation:Ze()}})),updateMouse:t=>n(i=>({interaction:{...i.interaction,mouse:{...i.interaction.mouse,...t}}})),updateKeyboard:t=>n(i=>({interaction:{...i.interaction,keyboard:{...i.interaction.keyboard,...t}}})),updateGamepad:t=>n(i=>({interaction:{...i.interaction,gamepad:{...i.interaction.gamepad,...t}}})),updateTouch:t=>n(i=>({interaction:{...i.interaction,touch:{...i.interaction.touch,...t}}})),setInteractionActive:t=>n(i=>({interaction:{...i.interaction,isActive:t}}))}),Bn=()=>({rideableId:"",isMoving:!1,isNotMoving:!0,isOnTheGround:!0,isOnMoving:!1,isRotated:!1,isRunning:!1,isJumping:!1,enableRiding:!1,isRiderOn:!1,isLanding:!1,isFalling:!1,isRiding:!1,canRide:!1,nearbyRideable:null,shouldEnterRideable:!1,shouldExitRideable:!1}),qn=n=>({states:Bn(),setStates:e=>n(t=>({states:{...t.states,...e}}))}),Hn=n=>({rideable:{},setRideable:(e,t)=>n(i=>({rideable:{...i.rideable,[e]:t}})),removeRideable:e=>n(t=>{const{[e]:i,...s}=t.rideable;return{rideable:s}})}),re={position:new y.Vector3,quaternion:new y.Quaternion,euler:new y.Euler,velocity:new y.Vector3,direction:new y.Vector3,dir:new y.Vector3,angular:new y.Vector3,isGround:!1},Wn=n=>({activeState:re,setActiveState:e=>n(()=>({activeState:{...re,...e}})),updateActiveState:e=>n(t=>({activeState:t.activeState?{...t.activeState,...e}:re})),resetActiveState:()=>n(()=>({activeState:re}))}),$n={render:{calls:0,triangles:0,points:0,lines:0},engine:{geometries:0,textures:0}},Kn=n=>({performance:$n,setPerformance:e=>n({performance:e})}),Yn=(n,e)=>({meshes:new Map,currentMeshId:null,addMesh:t=>{n(i=>{const s=new Map(i.meshes);return s.set(t.id,t),{meshes:s}})},removeMesh:t=>{n(i=>{const s=new Map(i.meshes);return s.delete(t),{meshes:s}})},updateMesh:(t,i)=>{n(s=>{const a=s.meshes.get(t);if(a){const o={...a,...i},c=new Map(s.meshes);return c.set(t,o),{meshes:c}}return s})},setCurrentMeshId:t=>{n({currentMeshId:t})},tiles:new Map,addTile:t=>{n(i=>{const s=new Map(i.tiles);return s.set(t.id,t),{tiles:s}})},removeTile:t=>{n(i=>{const s=new Map(i.tiles);return s.delete(t),{tiles:s}})},updateTile:(t,i)=>{n(s=>{const a=s.tiles.get(t);if(a){const o={...a,...i},c=new Map(s.tiles);return c.set(t,o),{tiles:c}}return s})},tileGroups:new Map,addTileGroup:t=>{n(i=>{const s=new Map(i.tileGroups);return s.set(t.id,t),{tileGroups:s}})},removeTileGroup:t=>{n(i=>{const s=new Map(i.tileGroups);s.delete(t);const a=new Map(i.tiles);return a.forEach(o=>{o.groupId===t&&a.set(o.id,{...o,groupId:void 0})}),{tileGroups:s,tiles:a}})},updateTileGroup:(t,i)=>{n(s=>{const a=s.tileGroups.get(t);if(a){const o={...a,...i},c=new Map(s.tileGroups);return c.set(t,o),{tileGroups:c}}return s})},addTileToGroup:(t,i)=>{n(s=>{const a=s.tiles.get(i);if(a&&s.tileGroups.has(t)){const o=new Map(s.tiles);return o.set(i,{...a,groupId:t}),{tiles:o}}return s})},removeTileFromGroup:t=>{n(i=>{const s=i.tiles.get(t);if(s!=null&&s.groupId){const a=new Map(i.tiles);return a.set(t,{...s,groupId:void 0}),{tiles:a}}return i})},walls:new Map,addWall:t=>{n(i=>{const s=new Map(i.walls);return s.set(t.id,t),{walls:s}})},removeWall:t=>{n(i=>{const s=new Map(i.walls);return s.delete(t),{walls:s}})},updateWall:(t,i)=>{n(s=>{const a=s.walls.get(t);if(a){const o={...a,...i},c=new Map(s.walls);return c.set(t,o),{walls:c}}return s})},wallGroups:new Map,addWallGroup:t=>{n(i=>{const s=new Map(i.wallGroups);return s.set(t.id,t),{wallGroups:s}})},removeWallGroup:t=>{n(i=>{const s=new Map(i.wallGroups);s.delete(t);const a=new Map(i.walls);return a.forEach(o=>{o.groupId===t&&a.set(o.id,{...o,groupId:void 0})}),{wallGroups:s,walls:a}})},updateWallGroup:(t,i)=>{n(s=>{const a=s.wallGroups.get(t);if(a){const o={...a,...i},c=new Map(s.wallGroups);return c.set(t,o),{wallGroups:c}}return s})},addWallToGroup:(t,i)=>{n(s=>{const a=s.walls.get(i);if(a&&s.wallGroups.has(t)){const o=new Map(s.walls);return o.set(i,{...a,groupId:t}),{walls:o}}return s})},removeWallFromGroup:t=>{n(i=>{const s=i.walls.get(t);if(s!=null&&s.groupId){const a=new Map(i.walls);return a.set(t,{...s,groupId:void 0}),{walls:a}}return i})},npcs:new Map,addNpc:t=>{n(i=>{const s=new Map(i.npcs);return s.set(t.id,t),{npcs:s}})},removeNpc:t=>{n(i=>{const s=new Map(i.npcs);return s.delete(t),{npcs:s}})},updateNpc:(t,i)=>{n(s=>{const a=s.npcs.get(t);if(a){const o={...a,...i},c=new Map(s.npcs);return c.set(t,o),{npcs:c}}return s})},interactableObjects:new Map,addInteractableObject:t=>{n(i=>{const s=new Map(i.interactableObjects);return s.set(t.id,t),{interactableObjects:s}})},removeInteractableObject:t=>{n(i=>{const s=new Map(i.interactableObjects);return s.delete(t),{interactableObjects:s}})},updateInteractableObject:(t,i)=>{n(s=>{const a=s.interactableObjects.get(t);if(a){const o={...a,...i},c=new Map(s.interactableObjects);return c.set(t,o),{interactableObjects:c}}return s})}}),C=it()(yn(bn((n,e,t)=>({...wn(n),...jn(n),...Mn(n),...ot(n),...ct(n),...Fn(n),..._n(n),...lt(n),...Un(n),...ut(n),...qn(n),...Hn(n),...Wn(n),...Kn(n),...Yn(n),updateState:i=>{n(s=>({...s,...i}))},initialize:i=>{const s=e();i.mode&&s.setMode(i.mode),i.urls&&s.setUrls(i.urls),i.cameraOption&&s.setCameraOption(i.cameraOption)}}))));class dt{constructor(){j(this,"state");j(this,"metrics");j(this,"callbacks");this.state={currentAnimation:"idle",animationMixer:null,actions:new Map,isPlaying:!1,currentWeight:1,blendDuration:.3},this.metrics={activeAnimations:0,totalActions:0,currentWeight:1,mixerTime:0,lastUpdate:0,blendProgress:0},this.callbacks=new Set}subscribe(e){return this.callbacks.add(e),()=>this.callbacks.delete(e)}notifyCallbacks(){this.callbacks.forEach(e=>e(this.getMetrics()))}initializeMixer(e){this.state.animationMixer=new y.AnimationMixer(e)}addAnimation(e,t){if(!this.state.animationMixer)return;const i=this.state.animationMixer.clipAction(t);this.state.actions.set(e,i),this.updateMetrics(),this.notifyCallbacks()}registerAction(e,t){this.state.actions.set(e,t),this.updateMetrics(),this.notifyCallbacks()}playAnimation(e,t=this.state.blendDuration){const i=this.state.actions.get(e);if(!i)return;const s=this.state.actions.get(this.state.currentAnimation);s&&s!==i&&s.fadeOut(t),i.reset().fadeIn(t).play(),this.state.currentAnimation=e,this.state.isPlaying=!0,this.updateMetrics(),this.notifyCallbacks()}stopAnimation(){const e=this.state.actions.get(this.state.currentAnimation);e&&e.stop(),this.state.isPlaying=!1,this.state.currentAnimation="idle",this.updateMetrics(),this.notifyCallbacks()}setWeight(e){const t=this.state.actions.get(this.state.currentAnimation);t&&(t.weight=e,this.state.currentWeight=e,this.updateMetrics(),this.notifyCallbacks())}setTimeScale(e){const t=this.state.actions.get(this.state.currentAnimation);t&&(t.timeScale=e,this.notifyCallbacks())}update(e){this.state.animationMixer&&(this.state.animationMixer.update(e),this.metrics.mixerTime+=e,this.metrics.lastUpdate=Date.now(),this.callbacks.size>0&&(this.updateMetrics(),this.notifyCallbacks()))}getCurrentAnimation(){return this.state.currentAnimation}getAnimationList(){return Array.from(this.state.actions.keys())}getMetrics(){return{...this.metrics}}getState(){return{...this.state}}updateMetrics(){this.metrics.activeAnimations=Array.from(this.state.actions.values()).filter(e=>e.isRunning()).length,this.metrics.totalActions=this.state.actions.size,this.metrics.currentWeight=this.state.currentWeight}dispose(){this.state.animationMixer&&(this.state.animationMixer.stopAllAction(),this.state.animationMixer=null),this.state.actions.clear(),this.callbacks.clear()}}class mt{constructor(){j(this,"engines");j(this,"eventListeners");j(this,"unsubscribeFunctions");this.engines=new Map,this.eventListeners=new Set,this.unsubscribeFunctions=new Map,["character","vehicle","airplane"].forEach(t=>{this.engines.set(t,new dt)}),this.setupEngineSubscriptions()}setupEngineSubscriptions(){this.engines.forEach((e,t)=>{const i=e.subscribe(()=>{this.notifyListeners(t)});this.unsubscribeFunctions.set(t,i)})}registerAnimationAction(e,t,i){const s=this.engines.get(e);s&&s.registerAction(t,i)}registerAnimations(e,t){const i=this.engines.get(e);i&&Object.entries(t).forEach(([s,a])=>{a&&i.registerAction(s,a)})}execute(e,t){const i=this.engines.get(e);if(i)switch(t.type){case"play":t.animation&&i.playAnimation(t.animation,t.duration);break;case"stop":i.stopAnimation();break;case"setWeight":t.weight!==void 0&&i.setWeight(t.weight);break;case"setSpeed":t.speed!==void 0&&i.setTimeScale(t.speed);break}}snapshot(e){const t=this.engines.get(e);if(!t)return this.getEmptySnapshot();const i=t.getState(),s=t.getMetrics();return{currentAnimation:i.currentAnimation,isPlaying:i.isPlaying,weight:i.currentWeight,speed:1,availableAnimations:t.getAnimationList(),metrics:{activeAnimations:s.activeAnimations,totalActions:s.totalActions,mixerTime:s.mixerTime,lastUpdate:s.lastUpdate}}}getMetrics(e){const t=this.engines.get(e);return t?t.getMetrics():null}subscribe(e){return this.eventListeners.add(e),()=>this.eventListeners.delete(e)}notifyListeners(e){if(this.eventListeners.size>0){const t=this.snapshot(e);this.eventListeners.forEach(i=>i(t,e))}}getEmptySnapshot(){return{currentAnimation:"idle",isPlaying:!1,weight:0,speed:1,availableAnimations:[],metrics:{activeAnimations:0,totalActions:0,mixerTime:0,lastUpdate:0}}}update(e,t){const i=this.engines.get(e);i&&i.update(t)}dispose(){this.unsubscribeFunctions.forEach(e=>e()),this.unsubscribeFunctions.clear(),this.engines.forEach(e=>e.dispose()),this.engines.clear(),this.eventListeners.clear()}}let xe=null;function Re(){return xe||(xe=new mt),xe}function te(){var l;const n=h.useRef(null),e=C(d=>d.mode),t=C(d=>d.animationState),i=C(d=>d.setAnimation);h.useEffect(()=>{const d=Re();n.current=d;const m=d.subscribe((p,M)=>{var b,f;const S=(f=(b=C.getState().animationState)==null?void 0:b[M])==null?void 0:f.current;p.currentAnimation!==S&&i(M,p.currentAnimation)});return()=>{m()}},[i]);const s=h.useCallback((d,m)=>{n.current&&n.current.execute(d,m)},[]),a=h.useCallback((d,m)=>{s(d,{type:"play",animation:m})},[s]),o=h.useCallback(d=>{s(d,{type:"stop"})},[s]),c=h.useCallback((d,m)=>{n.current&&n.current.registerAnimations(d,m)},[]),u=(e==null?void 0:e.type)||"character";return{bridge:n.current,playAnimation:a,stopAnimation:o,executeCommand:s,registerAnimations:c,currentType:u,currentAnimation:((l=t==null?void 0:t[u])==null?void 0:l.current)||"idle"}}function ne(n){const{playAnimation:e,currentType:t,currentAnimation:i}=te(),s=C(m=>{var p;return(p=m.interaction)==null?void 0:p.keyboard}),a=C(m=>{var p;return(p=m.interaction)==null?void 0:p.mouse}),o=C(m=>m.automation),c=C(m=>m.states),u=h.useMemo(()=>{const m=(s==null?void 0:s.forward)||(s==null?void 0:s.backward)||(s==null?void 0:s.leftward)||(s==null?void 0:s.rightward),p=(a==null?void 0:a.isActive)||!1;return{isMoving:m||p,isRunning:(s==null?void 0:s.shift)&&m||(a==null?void 0:a.shouldRun)&&p&&(o==null?void 0:o.queue.isRunning)}},[s,a,o]),l=h.useMemo(()=>c!=null&&c.isJumping?"jump":c!=null&&c.isFalling?"fall":c!=null&&c.isRiding?"ride":c!=null&&c.isLanding?"land":u.isRunning?"run":u.isMoving?"walk":"idle",[c,u]),d=h.useMemo(()=>["idle","walk","run","jump","fall","ride","land"],[]);h.useEffect(()=>{if(!n)return;l!=="idle"?l!==i&&e(t,l):d.includes(i)&&i!=="idle"&&e(t,"idle")},[n,l,i,e,t,d])}function Qn(n){return{playAnimation:(e,t=.2)=>{const i=n[e];i&&i!==null&&i.reset().fadeIn(t).play()},stopAnimation:(e,t=.2)=>{const i=n[e];i&&i!==null&&i.fadeOut(t)},crossFade:(e,t,i=.2)=>{const s=n[e],a=n[t];s&&s!==null&&s.fadeOut(i),a&&a!==null&&a.reset().fadeIn(i).play()}}}function ht(n={}){const{minHeight:e=.5,offsetY:t=.5}=n,{activeState:i}=C(),s=C(l=>l.updateMouse),a=!!(i!=null&&i.position),o=(l,d,m)=>{if(m!=="ground"||!(i!=null&&i.position))return!1;try{const p=i.position,M=H(l.point.x,l.point.y,l.point.z),S=Math.atan2(M.z-p.z,M.x-p.x),b=Math.max(M.y+t,e),f=H(M.x,b,M.z);return s({target:f,angle:S,position:new y.Vector2(f.x,f.z),isActive:!0,shouldRun:d}),!0}catch{return!1}};return{moveClicker:o,stopClicker:()=>{try{if(!a)return;s({isActive:!1,shouldRun:!1})}catch{}},onClick:l=>{o(l,!1,"ground")},isReady:a}}function Xn(){const n=C(a=>a.activeState),e=C(a=>a.mode),t=C(a=>a.animationState),i=C(a=>a.urls),s=e!=null&&e.type&&t?t[e.type].current:"idle";return{state:n||null,mode:e||null,urls:i,currentAnimation:s}}const Jn={KeyW:"forward",KeyA:"leftward",KeyS:"backward",KeyD:"rightward",ShiftLeft:"shift",Space:"space",KeyZ:"keyZ",KeyR:"keyR",KeyF:"keyF",KeyE:"keyE",Escape:"escape"},he=(n=!0,e=!0,t)=>{const i=C(m=>m.updateKeyboard),s=C(m=>m.automation),a=C(m=>m.stopAutomation),o=C(m=>m.updateMouse),c=h.useRef(new Set),u=h.useMemo(()=>({...Jn}),[]),l=h.useCallback((m,p)=>{try{return i({[m]:p}),p?c.current.add(m):c.current.delete(m),!0}catch(M){return console.error("Error updating keyboard state:",M),!1}},[i]),d=h.useCallback(()=>{c.current.clear(),i({forward:!1,backward:!1,leftward:!1,rightward:!1,shift:!1,space:!1,keyZ:!1,keyR:!1,keyF:!1,keyE:!1,escape:!1})},[i]);return h.useEffect(()=>{const m=(b,f)=>{const x=u[b.code];if(!x)return;const g=c.current.has(b.code);f&&!g?(c.current.add(b.code),b.code==="Space"&&b.preventDefault(),e&&b.code==="KeyS"&&(s!=null&&s.queue.isRunning)&&(a(),o({isActive:!1,shouldRun:!1})),i({[x]:!0})):!f&&g&&(c.current.delete(b.code),i({[x]:!1}))},p=b=>m(b,!0),M=b=>m(b,!1),S=()=>document.hidden&&d();return window.addEventListener("keydown",p),window.addEventListener("keyup",M),document.addEventListener("visibilitychange",S),()=>{window.removeEventListener("keydown",p),window.removeEventListener("keyup",M),document.removeEventListener("visibilitychange",S)}},[u,e,i,a,o,s,d]),{pressedKeys:Array.from(c.current),pushKey:l,isKeyPressed:m=>c.current.has(m),clearAllKeys:d}},Zn=5,ei=.5,ti=20,et=.1,ni=.01,A=200,ft=n=>{const e=C(E=>E.mode),t=C(E=>E.activeState),i=C(E=>E.minimap),{size:s=200,scale:a=Zn,zoom:o=2,blockRotate:c=!1,angle:u=0,updateInterval:l=33}=n,d=h.useRef(null),[m,p]=h.useState(a),M=h.useRef(null),S=h.useRef(null),b=!!(t.position&&n),f=h.useCallback(()=>{n.blockScale||p(E=>Math.min(ti,E+.1))},[n.blockScale]),x=h.useCallback(()=>{n.blockScale||p(E=>Math.max(ei,E-.1))},[n.blockScale]),g=h.useCallback(E=>{n.blockScale||(E.preventDefault(),E.deltaY<0?f():x())},[n.blockScale,f,x]),v=h.useCallback(()=>{const E=d.current;if(!E)return;const w=O=>{n.blockScale||(O.preventDefault(),O.deltaY<0?f():x())};return E.addEventListener("wheel",w,{passive:!1}),()=>{E.removeEventListener("wheel",w)}},[n.blockScale,f,x]),k=h.useCallback(()=>{const E=d.current;if(!E||!i)return;const w=E.getContext("2d");if(!w)return;const{position:O,euler:P}=t,z=P.y;w.clearRect(0,0,A,A),w.save(),w.beginPath(),w.arc(A/2,A/2,A/2,0,Math.PI*2),w.clip();const F=w.createRadialGradient(A/2,A/2,0,A/2,A/2,A/2);F.addColorStop(0,"rgba(20, 30, 40, 0.9)"),F.addColorStop(1,"rgba(10, 20, 30, 0.95)"),w.fillStyle=F,w.fillRect(0,0,A,A);const V=c||(e==null?void 0:e.control)==="normal"?180:z*180/Math.PI+180;w.translate(A/2,A/2),w.rotate(V*Math.PI/180),w.translate(-A/2,-A/2),w.save(),w.strokeStyle="rgba(255, 255, 255, 0.1)",w.lineWidth=1;for(let N=0;N<A;N+=20)w.beginPath(),w.moveTo(N,0),w.lineTo(N,A),w.moveTo(0,N),w.lineTo(A,N),w.stroke();w.restore(),w.save(),w.fillStyle="white",w.font="bold 16px sans-serif",w.shadowColor="rgba(0, 0, 0, 0.8)",w.shadowBlur=3,[{text:"N",x:A/2,y:25,color:"#ff6b6b"},{text:"S",x:A/2,y:A-25,color:"#4ecdc4"},{text:"E",x:A-25,y:A/2,color:"#45b7d1"},{text:"W",x:25,y:A/2,color:"#f9ca24"}].forEach(({text:N,x:B,y:Z,color:T})=>{w.save(),w.fillStyle=T,w.translate(B,Z),w.rotate(-V*Math.PI/180),w.textAlign="center",w.textBaseline="middle",w.fillText(N,0,0),w.restore()}),w.restore(),i&&i.props&&Object.values(i.props).forEach(N=>{if(!(N!=null&&N.center)||!(N!=null&&N.size))return;const{center:B,size:Z,text:T}=N,G=(B.x-O.x)*m,$=(B.z-O.z)*m;w.save();const K=Z.x*m,ie=Z.z*m,pe=A/2-G-K/2,ge=A/2-$-ie/2;w.shadowColor="rgba(0, 0, 0, 0.6)",w.shadowBlur=4,w.shadowOffsetX=2,w.shadowOffsetY=2,w.fillStyle="rgba(0,0,0,0.3)",w.fillRect(pe,ge,K,ie),w.shadowColor="transparent",w.strokeStyle="rgba(255, 255, 255, 0.3)",w.lineWidth=1,w.strokeRect(pe,ge,K,ie),T&&(w.save(),w.fillStyle="white",w.font="bold 12px sans-serif",w.shadowColor="rgba(0, 0, 0, 0.8)",w.shadowBlur=2,w.translate(pe+K/2,ge+ie/2),c||(e==null?void 0:e.control)==="normal"?w.rotate(Math.PI):w.rotate(-V*Math.PI/180),w.textAlign="center",w.textBaseline="middle",w.fillText(T,0,0),w.restore()),w.restore()}),w.save();const J=w.createRadialGradient(A/2,A/2,0,A/2,A/2,12);J.addColorStop(0,"#01fff7"),J.addColorStop(.7,"#01fff7"),J.addColorStop(1,"transparent"),w.fillStyle=J,w.beginPath(),w.arc(A/2,A/2,12,0,Math.PI*2),w.fill(),w.fillStyle="#01fff7",w.shadowColor="0 0 10px rgba(1,255,247,0.7)",w.shadowBlur=8,w.beginPath(),w.arc(A/2,A/2,6,0,Math.PI*2),w.fill(),w.shadowColor="transparent",w.strokeStyle="rgba(255, 255, 255, 0.8)",w.lineWidth=2,w.beginPath(),w.moveTo(A/2,A/2),w.lineTo(A/2,A/2-12),w.stroke(),w.restore(),w.restore()},[t,i,e,m,u,c]),R=h.useCallback(()=>{const{position:E,euler:w}=t,O=w.y,P=M.current,z=S.current;if(!P||z===null){k(),M.current=E.clone(),S.current=O;return}const F=Math.abs(E.x-P.x)>et||Math.abs(E.z-P.z)>et,V=Math.abs(O-z)>ni;(F||V)&&(k(),M.current=E.clone(),S.current=O)},[t,k]);return h.useEffect(()=>{k();const E=setInterval(R,l);return()=>{clearInterval(E)}},[k,R,l]),h.useEffect(()=>{k()},[m,k]),{canvasRef:d,scale:m,upscale:f,downscale:x,handleWheel:g,setupWheelListener:v,updateCanvas:k,isReady:b}},le=new Map,oe=new y.Vector3(1,1,1),ii=new y.Box3,si=n=>{const e=le.get(n);e&&--e.refCount<=0&&le.delete(n)},ri=n=>{try{return ii.setFromObject(n).getSize(me())}catch{return oe.clone()}},pt=({url:n})=>{const e=C(m=>m.sizes),t=C(m=>m.setSizes),i=n??"data:application/json,{}",s=!!(n!=null&&n.trim()),a=L.useGLTF(i),o=h.useRef(!1),c=h.useCallback(()=>s&&a.scene?ri(a.scene):oe.clone(),[a.scene,s]);h.useEffect(()=>{if(!n||!s)return;const m=le.get(n);return m?m.refCount++:le.set(n,{gltf:a,refCount:1,size:c()}),()=>si(n)},[n,s,a,c]),h.useEffect(()=>{if(o.current||!s||!n||!a.scene||e[n])return;o.current=!0;const m=c();t(p=>({...p,[n]:m}))},[n,a.scene,e,t,c,s]);const u=h.useMemo(()=>s&&n?e[n]??oe:oe,[e,n,s]),l=h.useCallback((m,p)=>{if(!s)return;const M=p??n;M&&Promise.resolve().then(()=>t(S=>({...S,[M]:m})))},[n,t,s]),d=h.useCallback(m=>{if(!s)return null;const p=m??n;return p?e[p]??null:null},[n,e,s]);return{gltf:a,size:u,setSize:l,getSize:d}},gt=()=>{const n=C(i=>i.sizes),e=h.useCallback(i=>{if(!i)return{};const s={};return Object.entries(i).forEach(([a,o])=>{typeof o=="string"?s[a]=n[o]??null:s[a]=null}),s},[n]),t=h.useCallback(i=>{console.log("GLTF 프리로딩이 비활성화되었습니다:",i)},[]);return{getSizesByUrls:e,preloadSizes:t}},yt={isRiderOn:!1,position:q.vec3(),rotation:q.euler(),offset:q.vec3(),visible:!0};function ai(){const n=C(g=>g.states),e=C(g=>g.rideable),t=C(g=>g.activeState),i=C(g=>g.urls),s=C(g=>g.setStates),a=C(g=>g.setMode),o=C(g=>g.setRideable),c=C(g=>g.setUrls),{getSizesByUrls:u}=gt(),l=h.useCallback(g=>{const v={};v.ridingUrl=g.ridingUrl??i.characterUrl,g.objectType==="vehicle"?(v.vehicleUrl=g.url??"",v.wheelUrl=g.wheelUrl??""):g.objectType==="airplane"&&(v.airplaneUrl=g.url??""),c(v)},[c,i]),d=h.useCallback(g=>{const v=e[g];if(!(v!=null&&v.position))return;const k=v.objectType,{vehicleUrl:R,airplaneUrl:E,characterUrl:w}=u(i);!(k==="vehicle"?R:E)||!w||(s({enableRiding:!1,isRiderOn:!1,rideableId:""}),o(g,{...v,visible:!0,position:t.position.clone()}))},[e,u,i,s,o,t.position]),m=h.useCallback(async()=>{if(n.canRide&&n.nearbyRideable&&!n.isRiding){const{objectkey:g,objectType:v}=n.nearbyRideable,k=e[g];if(!k)return;l(k),a({type:v}),s({rideableId:g,isRiding:!0,canRide:!1,nearbyRideable:null,enableRiding:k.enableRiding,isRiderOn:!0}),o(g,{...k,visible:!1})}},[n.canRide,n.nearbyRideable,n.isRiding,e,l,a,s,o]),p=h.useCallback(async()=>{n.isRiding&&n.rideableId&&(d(n.rideableId),a({type:"character"}),s({isRiding:!1,rideableId:""}))},[n.isRiding,n.rideableId,d,a,s]);h.useEffect(()=>{const g=v=>{v.code==="KeyF"&&(n.canRide&&n.nearbyRideable?m():n.isRiding&&p())};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[n.canRide,n.nearbyRideable,n.isRiding,m,p]),h.useEffect(()=>{n.shouldEnterRideable&&(m(),s({shouldEnterRideable:!1}))},[n.shouldEnterRideable,m,s]),h.useEffect(()=>{n.shouldExitRideable&&(p(),s({shouldExitRideable:!1}))},[n.shouldExitRideable,p,s]);const M=h.useCallback(g=>{o(g.objectkey,{...yt,...g})},[o]),S=h.useCallback(g=>{o(g.objectkey,g)},[o]),b=g=>e[g],f=h.useCallback(async(g,v)=>{if((g.other.rigidBodyObject&&g.other.rigidBodyObject.name==="character"||g.other.rigidBodyObject&&!g.other.rigidBodyObject.name||g.other.rigidBody)&&!n.isRiding){if(!v.objectType)return;s({nearbyRideable:{objectkey:v.objectkey,objectType:v.objectType,name:v.objectType==="vehicle"?"차량":"비행기",rideMessage:v.rideMessage,exitMessage:v.exitMessage,displayName:v.displayName},canRide:!0})}},[n.isRiding,s]),x=h.useCallback(async g=>{(g.other.rigidBodyObject&&g.other.rigidBodyObject.name==="character"||g.other.rigidBodyObject&&!g.other.rigidBodyObject.name||g.other.rigidBody)&&s({nearbyRideable:null,canRide:!1})},[s]);return{initRideable:M,updateRideable:S,getRideable:b,onRideableNear:f,onRideableLeave:x,enterRideable:m,exitRideable:p,landing:d}}function xt(){const n=C(s=>s.activeState),e=C(s=>s.setActiveState);return{teleport:s=>{if(!n)return!1;try{e({...n,position:s.clone(),velocity:new y.Vector3(0,0,0)});const a=new CustomEvent("gaesup:teleport",{detail:{position:s.clone(),timestamp:Date.now()}});return window.dispatchEvent(a),document.dispatchEvent(new CustomEvent("teleport-request",{detail:{position:s.clone()}})),!0}catch(a){return console.error("Teleport failed:",a),!1}},canTeleport:!!n}}const oi=()=>{const n=C();return{activeState:n.activeState,mode:n.mode,animationState:n.animationState,states:n.states,urls:n.urls,rideable:n.rideable,block:n.block,cameraOption:n.cameraOption,minimap:n.minimap}},ci=()=>{const[n,e]=h.useState(!1);L.useCursor(n);const t=h.useCallback(i=>{e(i)},[]);return{isHovered:n,setHovered:t}},li=100,je=1e3,be=10;function bt(){const n=new Map,e=Array.from({length:be},()=>new y.Vector3);return{getTempVector:t=>e[t%be].set(0,0,0),getCached:(t,i)=>(n.has(t)||(n.size>=li&&n.delete(n.keys().next().value),n.set(t,i())),n.get(t)),clear:()=>n.clear(),getStats:()=>({cacheSize:n.size,tempVectorCount:be})}}const _=new Map,Me=n=>{const e=Math.round(n*100)/100;return _.has(e)||(_.size>=je&&_.delete(_.keys().next().value),_.set(e,{sin:Math.sin(n),cos:Math.cos(n)})),_.get(e)},vt=()=>_.clear(),wt=()=>({size:_.size,maxSize:je,coverage:`${(_.size/je*100).toFixed(1)}%`}),ke=n=>{const e=2*Math.PI;for(;n>Math.PI;)n-=e;for(;n<-Math.PI;)n+=e;return n},Ee=(n,e,t=.01)=>Math.abs(n-e)>=t,ui=(n,e,t=.01)=>n.distanceTo(e)>=t,de=class de{constructor(){j(this,"vectorCaches",new Map)}static getInstance(){return this.instance??(this.instance=new de)}getVectorCache(e){return this.vectorCaches.get(e)??(this.vectorCaches.set(e,bt()),this.vectorCaches.get(e))}clearAll(){this.vectorCaches.forEach(e=>e.clear()),vt()}getStats(){return{vectorCaches:Array.from(this.vectorCaches.entries()).map(([e,t])=>({id:e,...t.getStats()})),trigCache:wt()}}};j(de,"instance");let ue=de;const di=n=>{var e,t;return(t=(e=n==null?void 0:n.name)==null?void 0:e.split("_"))==null?void 0:t[0]},mi=(n,e)=>{var t,i;return((i=(t=e==null?void 0:e.name)==null?void 0:t.split("_"))==null?void 0:i[0])===n},hi={get(n){if(typeof window<"u"){const e=localStorage.getItem(n);if(e)try{return JSON.parse(e)}catch(t){return console.error("Error parsing cached data:",t),null}}return null},set(n,e){if(typeof window<"u")try{const t=JSON.stringify(e);localStorage.setItem(n,t)}catch(t){console.error("Error serializing data for cache:",t)}},remove(n){typeof window<"u"&&localStorage.removeItem(n)}},Y=new y.Vector3,ve=new y.Vector3,fi=new y.Quaternion,X={tempVectors:{temp1:new y.Vector3,temp2:new y.Vector3,temp3:new y.Vector3},clampValue:(n,e,t)=>Math.max(e,Math.min(t,n)),frameRateIndependentLerpVector3:(n,e,t,i)=>{const s=1-Math.exp(-t*i);n.lerp(e,s)},smoothLookAt:(n,e,t,i)=>{Y.subVectors(e,n.position).normalize();const s=fi.setFromRotationMatrix(new y.Matrix4().lookAt(n.position,e,n.up)).normalize();n.quaternion.clone().normalize().dot(s)<0&&(s.x*=-1,s.y*=-1,s.z*=-1,s.w*=-1);const o=1-Math.exp(-t*i);n.quaternion.slerp(s,o).normalize()},preventCameraJitter:(n,e,t,i,s)=>{X.frameRateIndependentLerpVector3(n.position,e,i,s),X.smoothLookAt(n,t,i*.8,s)},improvedCollisionCheck:(n,e,t,i=.5)=>{const s=new y.Vector3().subVectors(e,n).normalize(),a=n.distanceTo(e),o=new y.Raycaster(n,s,0,a),c=[];if(t.traverse(d=>{var p;if(!(d instanceof y.Mesh)||d.userData.intangible||!((p=d.geometry)!=null&&p.boundingSphere))return;const m=o.intersectObject(d,!1);m.length>0&&c.push({object:d,distance:m[0].distance,point:m[0].point})}),c.length===0)return{safe:!0,position:e,obstacles:[]};const u=c.reduce((d,m)=>m.distance<d.distance?m:d);return{safe:!1,position:n.clone().add(s.multiplyScalar(Math.max(0,u.distance-i))),obstacles:c}},distanceSquared:(n,e)=>Y.subVectors(n,e).lengthSq(),safeNormalize:n=>{const e=n.length();return e>0?n.divideScalar(e):n.set(0,0,0)},smoothDamp:(n,e,t,i,s,a)=>{const o=2/i,c=o*s,u=1/(1+c+.48*c*c+.235*c*c*c);Y.subVectors(n,e);const l=a?a*i:1/0;Y.clampLength(0,l),ve.copy(t).addScaledVector(Y,o).multiplyScalar(s),t.copy(t).sub(ve).multiplyScalar(u),n.copy(e).add(Y.add(ve).multiplyScalar(u))},calculateBounds:(n,e,t)=>{if(!t)return n;const i=t.minX!==void 0?Math.max(t.minX,n.x):n.x,s=t.minY!==void 0?Math.max(t.minY,n.y):n.y,a=t.minZ!==void 0?Math.max(t.minZ,n.z):n.z,o=t.maxX!==void 0?Math.min(t.maxX,i):i,c=t.maxY!==void 0?Math.min(t.maxY,s):s,u=t.maxZ!==void 0?Math.min(t.maxZ,a):a;return Y.set(o,c,u)},fastAtan2:(n,e)=>e===0?n>0?Math.PI/2:n<0?-Math.PI/2:0:e>0?Math.atan(n/e):Math.atan(n/e)+(n>=0?Math.PI:-Math.PI),updateFOV:(n,e,t)=>{t&&t>0?n.fov=y.MathUtils.lerp(n.fov,e,t):n.fov=e,n.updateProjectionMatrix()},clampPosition:(n,e)=>(e&&(n.y=X.clampValue(n.y,e.minY||-1/0,e.maxY||1/0)),n),isPositionEqual:(n,e,t=.001)=>Math.abs(n.x-e.x)<t&&Math.abs(n.y-e.y)<t&&Math.abs(n.z-e.z)<t,pool:{vectors:[],getVector3:()=>X.pool.vectors.pop()||new y.Vector3,releaseVector3:n=>{n.set(0,0,0),X.pool.vectors.push(n)}},calculateSafeDistance:(n,e,t,i)=>{const s=n.distanceTo(e);return y.MathUtils.clamp(s,t,i)},isPositionValid:(n,e)=>e?n.y>=e.minY&&n.y<=e.maxY:!0},D={getPosition:n=>n!=null&&n.position?n.position instanceof y.Vector3?n.position:typeof n.position=="object"?new y.Vector3(n.position.x||0,n.position.y||0,n.position.z||0):new y.Vector3(0,0,0):new y.Vector3(0,0,0),getEuler:n=>n!=null&&n.euler?n.euler instanceof y.Euler?n.euler:typeof n.euler=="object"?new y.Euler(n.euler.x||0,n.euler.y||0,n.euler.z||0):new y.Euler(0,0,0):new y.Euler(0,0,0),getVelocity:n=>n!=null&&n.velocity?n.velocity instanceof y.Vector3?n.velocity:typeof n.velocity=="object"?new y.Vector3(n.velocity.x||0,n.velocity.y||0,n.velocity.z||0):new y.Vector3(0,0,0):new y.Vector3(0,0,0),calculateCameraOffset:(n,e)=>{const{xDistance:t=15,yDistance:i=8,zDistance:s=15,euler:a,mode:o="thirdPerson"}=e;switch(o){case"chase":return a?new y.Vector3(Math.sin(a.y),1,Math.cos(a.y)).normalize().multiply(new y.Vector3(-t,i,-s)):new y.Vector3(-t,i,-s);case"thirdPerson":default:return new y.Vector3(-t,i,-s)}},getCameraTarget:(n,e)=>{const t=D.getPosition(n);return e.target||t}};class W{calculateLookAt(e,t){return D.getPosition(e.activeState)}update(e,t){var u;const{camera:i,deltaTime:s,activeState:a}=e;if(!a)return;Object.assign(t.config,this.defaultConfig);const o=this.calculateTargetPosition(e,t),c=this.calculateLookAt(e,t);X.preventCameraJitter(i,o,c,8,s),t.config.fov&&i instanceof y.PerspectiveCamera&&X.updateFOV(i,t.config.fov,(u=t.config.smoothing)==null?void 0:u.fov)}}class St extends W{constructor(){super(...arguments);j(this,"name","thirdPerson");j(this,"defaultConfig",{distance:{x:15,y:8,z:15},smoothing:{position:.1,rotation:.1,fov:.1},enableCollision:!0})}calculateTargetPosition(t,i){const s=D.getPosition(t.activeState),a=D.calculateCameraOffset(s,{xDistance:i.config.distance.x,yDistance:i.config.distance.y,zDistance:i.config.distance.z,mode:"thirdPerson"});return s.clone().add(a)}}class Ct extends W{constructor(){super(...arguments);j(this,"name","firstPerson");j(this,"defaultConfig",{distance:{x:0,y:1.7,z:0},smoothing:{position:.2,rotation:.15,fov:.1},enableCollision:!1})}calculateTargetPosition(t,i){const s=D.getPosition(t.activeState),a=new y.Vector3(0,1.7,0);return s.clone().add(a)}calculateLookAt(t,i){const s=D.getPosition(t.activeState),a=D.getEuler(t.activeState),o=new y.Vector3(0,0,-1);return a&&o.applyEuler(a),s.clone().add(o)}}class jt extends W{constructor(){super(...arguments);j(this,"name","chase");j(this,"defaultConfig",{distance:{x:10,y:5,z:10},smoothing:{position:.15,rotation:.1,fov:.1},enableCollision:!0})}calculateTargetPosition(t,i){const s=D.getPosition(t.activeState),a=D.getEuler(t.activeState),o=D.calculateCameraOffset(s,{xDistance:i.config.distance.x,yDistance:i.config.distance.y,zDistance:i.config.distance.z,euler:a,mode:"chase"});return s.clone().add(o)}}class Mt extends W{constructor(){super(...arguments);j(this,"name","topDown");j(this,"defaultConfig",{distance:{x:0,y:20,z:0},smoothing:{position:.1,rotation:.1,fov:.1},enableCollision:!1})}calculateTargetPosition(t,i){const s=D.getPosition(t.activeState);return new y.Vector3(s.x,s.y+i.config.distance.y,s.z)}}class kt extends W{constructor(){super(...arguments);j(this,"name","isometric");j(this,"defaultConfig",{distance:{x:15,y:15,z:15},smoothing:{position:.1,rotation:.1,fov:.1},enableCollision:!1})}calculateTargetPosition(t,i){const s=D.getPosition(t.activeState),a=Math.PI/4,o=Math.sqrt(i.config.distance.x**2+i.config.distance.z**2);return new y.Vector3(s.x+Math.cos(a)*o,s.y+i.config.distance.y,s.z+Math.sin(a)*o)}}class Et extends W{constructor(){super(...arguments);j(this,"name","sideScroll");j(this,"defaultConfig",{distance:{x:0,y:5,z:10},smoothing:{position:.08,rotation:.1,fov:.1},enableCollision:!1})}calculateTargetPosition(t,i){const s=D.getPosition(t.activeState);return new y.Vector3(s.x+i.config.distance.x,s.y+i.config.distance.y,i.config.distance.z)}}class At extends W{constructor(){super(...arguments);j(this,"name","fixed");j(this,"defaultConfig",{distance:{x:0,y:0,z:0},smoothing:{position:0,rotation:0,fov:0},enableCollision:!1})}calculateTargetPosition(t,i){return i.config.fixedPosition||new y.Vector3(0,10,10)}calculateLookAt(t,i){return i.config.fixedLookAt||new y.Vector3(0,0,0)}}function pi(n){return{all:n=n||new Map,on:function(e,t){var i=n.get(e);i?i.push(t):n.set(e,[t])},off:function(e,t){var i=n.get(e);i&&(t?i.splice(i.indexOf(t)>>>0,1):n.set(e,[]))},emit:function(e,t){var i=n.get(e);i&&i.slice().map(function(s){s(t)}),(i=n.get("*"))&&i.slice().map(function(s){s(e,t)})}}}class Rt{constructor(e){j(this,"emitter");j(this,"config");j(this,"metrics",{frameCount:0,totalFrameTime:0,lastUpdateTime:0});this.emitter=pi(),this.config=e}updateConfig(e){const t={...this.config};this.config={...this.config,...e},Object.keys(e).forEach(i=>{this.emitter.emit("configChange",{key:i,value:e[i]})}),t.mode!==this.config.mode&&this.emitter.emit("modeChange",{from:t.mode,to:this.config.mode})}getConfig(){return{...this.config}}getState(){return{config:this.getConfig(),metrics:this.getMetrics()}}getMetrics(){return{frameCount:this.metrics.frameCount,averageFrameTime:this.metrics.frameCount>0?this.metrics.totalFrameTime/this.metrics.frameCount:0,lastUpdateTime:this.metrics.lastUpdateTime}}trackFrameMetrics(e){this.metrics.frameCount++,this.metrics.totalFrameTime+=e,this.metrics.lastUpdateTime=Date.now()}emitError(e,t){this.emitter.emit("error",{message:e,details:t})}destroy(){this.emitter.all.clear()}}class Nt extends Rt{constructor(t){super(t);j(this,"controllers",new Map);j(this,"state");this.state=this.createInitialState(),this.registerControllers()}createInitialState(){return{config:{mode:"thirdPerson",distance:{x:15,y:8,z:15},bounds:void 0,enableCollision:!0,smoothing:{position:.1,rotation:.1,fov:.1},fov:75,zoom:1},activeController:void 0}}registerController(t){this.controllers.set(t.name,t)}updateConfig(t){Object.assign(this.state.config,t),(t.xDistance!==void 0||t.yDistance!==void 0||t.zDistance!==void 0)&&(this.state.config.distance={x:t.xDistance||this.state.config.distance.x,y:t.yDistance||this.state.config.distance.y,z:t.zDistance||this.state.config.distance.z})}update(t){this.trackFrameMetrics(t)}calculate(t){try{const i=this.controllers.get(this.state.config.mode);if(!i)return;this.state.activeController=i,i.update(t,this.state)}catch(i){console.error("Camera calculation error:",i),this.emitError("Camera calculation failed",i)}}getState(){return this.state}registerControllers(){this.registerController(new St),this.registerController(new Ct),this.registerController(new jt),this.registerController(new Mt),this.registerController(new kt),this.registerController(new Et),this.registerController(new At)}}function It(n,e,t){const i=h.useRef(null);i.current||(i.current=new n(e));const s=i.current;U.useFrame((u,l)=>{s==null||s.update(l)}),h.useEffect(()=>{if(!t||!s)return;const u=[];return Object.entries(t).forEach(([l,d])=>{d&&(s.emitter.on(l,d),u.push(()=>{s.emitter.off(l,d)}))}),()=>{u.forEach(l=>l())}},[t,s]),h.useEffect(()=>()=>{s==null||s.destroy()},[s]);const a=h.useCallback(u=>{s==null||s.updateConfig(u)},[s]),o=h.useCallback(()=>s==null?void 0:s.getState(),[s]),c=h.useCallback(()=>s==null?void 0:s.getMetrics(),[s]);return{engine:s,updateConfig:a,getState:o,getMetrics:c}}function Tt(){const n=C(c=>c.block),e=C(c=>c.activeState),t=C(c=>c.cameraOption),i=C(c=>c.mode),s=h.useMemo(()=>({mode:(i==null?void 0:i.control)||"thirdPerson",enableMetrics:!0,autoUpdate:!0,...t}),[]),{engine:a,updateConfig:o}=It(Nt,s);return h.useEffect(()=>{o({mode:(i==null?void 0:i.control)||"thirdPerson",...t})},[t,i,o]),U.useFrame((c,u)=>{if(!a||n.camera)return;const l={camera:c.camera,scene:c.scene,deltaTime:u,activeState:e,clock:c.clock,excludeObjects:[]};a.calculate(l)}),{engine:a}}function Ot(){return Tt(),null}class gi{constructor(e){j(this,"isEnabled",!1);j(this,"positionHistory",[]);j(this,"debugInfo",[]);j(this,"maxHistoryLength",100);j(this,"cleanupInterval",null);j(this,"disposables",new Set);j(this,"debugLines",[]);j(this,"scene",null);this.scene=e||null}enable(e){this.isEnabled=!0,e&&(this.scene=e),this.setupCleanupInterval(),this.setupEventListeners()}disable(){this.isEnabled=!1,this.cleanup()}setupCleanupInterval(){this.cleanupInterval=window.setInterval(()=>{this.cleanupOldHistory()},5e3),this.disposables.add(()=>{this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null)})}setupEventListeners(){const e=()=>this.handleResize();window.addEventListener("resize",e),this.disposables.add(()=>window.removeEventListener("resize",e))}handleResize(){this.isEnabled&&(console.error("[CameraDebugger] Window resized, clearing debug info"),this.clearDebugInfo())}update(e,t,i){if(!this.isEnabled)return;const s=e.position.clone(),a=new y.Vector3;e.getWorldDirection(a),a.multiplyScalar(10).add(s),this.addPositionToHistory(s);const o={position:s.clone(),target:a.clone(),distance:s.length(),fov:e instanceof y.PerspectiveCamera?e.fov:0,state:i||"unknown",timestamp:Date.now()};this.addDebugInfo(o),this.updateDebugVisuals(e)}addPositionToHistory(e){this.positionHistory.push(e.clone()),this.positionHistory.length>this.maxHistoryLength&&this.positionHistory.shift()}addDebugInfo(e){this.debugInfo.push(e),this.debugInfo.length>this.maxHistoryLength&&this.debugInfo.shift()}updateDebugVisuals(e){if(this.scene&&(this.clearDebugLines(),this.positionHistory.length>1)){const t=new y.BufferGeometry,i=[];this.positionHistory.forEach(o=>{i.push(o.x,o.y,o.z)}),t.setAttribute("position",new y.Float32BufferAttribute(i,3));const s=new y.LineBasicMaterial({color:65280,transparent:!0,opacity:.6}),a=new y.Line(t,s);this.scene.add(a),this.debugLines.push(a),this.disposables.add(()=>{t.dispose(),s.dispose(),this.scene&&this.scene.remove(a)})}}clearDebugLines(){this.debugLines.forEach(e=>{e.geometry&&e.geometry.dispose(),e.material instanceof y.Material&&e.material.dispose(),this.scene&&this.scene.remove(e)}),this.debugLines.length=0}cleanupOldHistory(){const e=Date.now(),t=1e4;if(this.debugInfo=this.debugInfo.filter(i=>e-i.timestamp<t),this.positionHistory.length>this.maxHistoryLength*.8){const i=Math.floor(this.positionHistory.length*.2);this.positionHistory.splice(0,i)}}getDebugInfo(){return[...this.debugInfo]}getPositionHistory(){return[...this.positionHistory]}exportData(){const e={debugInfo:this.debugInfo,positionHistory:this.positionHistory.map(t=>({x:t.x,y:t.y,z:t.z})),timestamp:Date.now()};return JSON.stringify(e,null,2)}clearDebugInfo(){this.debugInfo.length=0,this.positionHistory.length=0,this.clearDebugLines()}cleanup(){this.clearDebugInfo(),this.clearDebugLines()}dispose(){this.disable(),this.disposables.forEach(e=>e()),this.disposables.clear(),this.cleanup()}}var Dt={exports:{}},fe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yi=h,xi=Symbol.for("react.element"),bi=Symbol.for("react.fragment"),vi=Object.prototype.hasOwnProperty,wi=yi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Si={key:!0,ref:!0,__self:!0,__source:!0};function Pt(n,e,t){var i,s={},a=null,o=null;t!==void 0&&(a=""+t),e.key!==void 0&&(a=""+e.key),e.ref!==void 0&&(o=e.ref);for(i in e)vi.call(e,i)&&!Si.hasOwnProperty(i)&&(s[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)s[i]===void 0&&(s[i]=e[i]);return{$$typeof:xi,type:n,key:a,ref:o,props:s,_owner:wi.current}}fe.Fragment=bi;fe.jsx=Pt;fe.jsxs=Pt;Dt.exports=fe;var r=Dt.exports;const Ci=[{value:"thirdPerson",label:"Third Person"},{value:"firstPerson",label:"First Person"},{value:"chase",label:"Chase"},{value:"topDown",label:"Top Down"},{value:"isometric",label:"Isometric"},{value:"side",label:"Side-Scroller"},{value:"fixed",label:"Fixed"}];function Ne(){const{mode:n,setMode:e}=C(),t=(n==null?void 0:n.control)||"thirdPerson";return r.jsx("div",{className:"cc-panel",children:r.jsx("div",{className:"cc-list",children:Ci.map(i=>r.jsx("button",{className:`cc-button ${t===i.value?"active":""}`,onClick:()=>e({control:i.value}),children:i.label},i.value))})})}const ji=[{key:"mode",label:"Mode",enabled:!0,format:"text"},{key:"position",label:"Position",enabled:!0,format:"vector3",precision:2},{key:"distance",label:"Distance",enabled:!0,format:"vector3",precision:2},{key:"fov",label:"FOV",enabled:!0,format:"angle",precision:1},{key:"velocity",label:"Velocity",enabled:!1,format:"vector3",precision:2},{key:"rotation",label:"Rotation",enabled:!1,format:"vector3",precision:2},{key:"zoom",label:"Zoom",enabled:!1,format:"number",precision:2},{key:"activeController",label:"Controller",enabled:!0,format:"text"}];function Ie(){const[n,e]=h.useState({}),{mode:t,cameraOption:i,activeState:s,characterPosition:a,characterVelocity:o,characterRotation:c}=C();h.useEffect(()=>{const l=setInterval(()=>{e({mode:t==null?void 0:t.control,distance:i==null?void 0:i.distance,fov:i==null?void 0:i.fov,position:a||(s==null?void 0:s.position),velocity:o,rotation:c,zoom:i==null?void 0:i.zoom})},100);return()=>clearInterval(l)},[t,i,s,a,o,c]);const u=(l,d=2)=>l==null?"N/A":typeof l=="object"&&l.x!==void 0?`X:${l.x.toFixed(d)} Y:${l.y.toFixed(d)} Z:${l.z.toFixed(d)}`:typeof l=="number"?l.toFixed(d):l.toString();return r.jsx("div",{className:"cd-panel",children:r.jsx("div",{className:"cd-grid",children:ji.map(l=>r.jsxs("div",{className:"cd-item",children:[r.jsx("span",{className:"cd-label",children:l.label}),r.jsx("span",{className:"cd-value",children:u(n[l.key])})]},l.key))})})}const Mi=[{id:"classic",name:"Classic",description:"A traditional third-person view.",config:{mode:"thirdPerson",distance:{x:0,y:8,z:10},fov:75,smoothing:{position:.1,rotation:.1,fov:.1}}},{id:"cinematic",name:"Cinematic",description:"Smooth, movie-like camera work.",config:{mode:"chase",distance:{x:2,y:7,z:8},fov:60,smoothing:{position:.05,rotation:.05,fov:.05}}},{id:"action",name:"Action",description:"Responsive camera for fast gameplay.",config:{mode:"thirdPerson",distance:{x:0,y:6,z:6},fov:85,smoothing:{position:.2,rotation:.2,fov:.2}}},{id:"strategy",name:"Strategy",description:"Top-down view for an overview.",config:{mode:"topDown",distance:{x:0,y:20,z:0},fov:45,smoothing:{position:.1,rotation:.1,fov:.1}}},{id:"retro",name:"Retro",description:"Classic side-scroller style.",config:{mode:"side",distance:{x:15,y:0,z:0},fov:75,smoothing:{position:.15,rotation:.15,fov:.15}}}];function Te(){const[n]=h.useState(Mi),{setMode:e,setCameraOption:t,mode:i,cameraOption:s}=C(),[a,o]=h.useState(null),c=u=>{e({control:u.config.mode});const l={...s,distance:u.config.distance,fov:u.config.fov,smoothing:u.config.smoothing||{position:.1,rotation:.1,fov:.1}};t(l)};return h.useEffect(()=>{const u=n.find(l=>l.config.mode===(i==null?void 0:i.control)&&JSON.stringify(l.config.distance)===JSON.stringify(s==null?void 0:s.distance));o(u?u.id:null)},[i,s,n]),r.jsx("div",{className:"cp-panel",children:r.jsx("div",{className:"cp-grid",children:n.map(u=>r.jsxs("button",{className:`cp-item ${a===u.id?"active":""}`,onClick:()=>c(u),children:[r.jsx("div",{className:"cp-name",children:u.name}),r.jsx("div",{className:"cp-description",children:u.description})]},u.id))})})}function ki({debugPanelProps:n,controllerProps:e,presetsProps:t}){return r.jsxs(r.Fragment,{children:[n&&r.jsx(Ie,{...n}),e&&r.jsx(Ne,{...e}),t&&r.jsx(Te,{...t})]})}const Ei=[{value:"idle",label:"Idle"},{value:"walk",label:"Walk"},{value:"run",label:"Run"},{value:"jump",label:"Jump"},{value:"fall",label:"Fall"},{value:"dance",label:"Dance"},{value:"wave",label:"Wave"}];function zt(){const{playAnimation:n,currentType:e,currentAnimation:t}=te(),i=s=>{n(e,s)};return r.jsx("div",{className:"ac-panel",children:r.jsx("div",{className:"ac-grid",children:Ei.map(s=>r.jsx("button",{className:`ac-button ${s.value===t?"active":""}`,onClick:()=>i(s.value),title:s.label,children:s.label},s.value))})})}const Ai=()=>r.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:r.jsx("path",{d:"M8 5v14l11-7z"})}),Ri=()=>r.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:r.jsx("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"})}),Ni=()=>r.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:r.jsx("path",{d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})}),Ii=()=>r.jsx("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:r.jsx("path",{d:"M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"})});function Vt(){const{bridge:n,playAnimation:e,stopAnimation:t,currentType:i,currentAnimation:s}=te(),[a,o]=h.useState(!1),[c,u]=h.useState([]),[l,d]=h.useState(30);h.useEffect(()=>{if(!n)return;const p=()=>{const S=n.snapshot(i);o(S.isPlaying),u(S.availableAnimations)};return p(),n.subscribe((S,b)=>{b===i&&p()})},[n,i]);const m=()=>{a?t(i):e(i,s)};return r.jsxs("div",{className:"ap-panel",children:[r.jsxs("div",{className:"ap-controls",children:[r.jsx("select",{className:"ap-select",value:s,onChange:p=>e(i,p.target.value),children:c.map(p=>r.jsx("option",{value:p,children:p},p))}),r.jsxs("div",{className:"ap-buttons",children:[r.jsx("button",{className:"ap-btn","aria-label":"previous animation",children:r.jsx(Ni,{})}),r.jsx("button",{className:"ap-btn-primary",onClick:m,"aria-label":a?"pause":"play",children:a?r.jsx(Ri,{}):r.jsx(Ai,{})}),r.jsx("button",{className:"ap-btn","aria-label":"next animation",children:r.jsx(Ii,{})})]})]}),r.jsxs("div",{className:"ap-timeline",children:[r.jsx("span",{className:"ap-time",children:"0:00"}),r.jsx("input",{type:"range",className:"ap-slider",min:"0",max:"100",value:l,onChange:p=>d(Number(p.target.value))}),r.jsx("span",{className:"ap-time",children:"1:30"})]})]})}const Ti=[{key:"currentAnimation",label:"현재 애니메이션",format:"text",enabled:!0},{key:"animationType",label:"애니메이션 타입",format:"text",enabled:!0},{key:"isPlaying",label:"재생 상태",format:"text",enabled:!0},{key:"weight",label:"가중치",format:"number",enabled:!0},{key:"speed",label:"속도",format:"number",enabled:!0},{key:"blendDuration",label:"블렌드 시간",format:"number",enabled:!1},{key:"activeActions",label:"활성 액션",format:"number",enabled:!0},{key:"availableAnimations",label:"사용 가능 애니메이션",format:"array",enabled:!1},{key:"frameCount",label:"프레임 카운트",format:"number",enabled:!1},{key:"averageFrameTime",label:"평균 프레임 시간",format:"number",enabled:!1}];function Gt(){const{bridge:n,currentType:e}=te(),[t,i]=h.useState({frameCount:0,averageFrameTime:0,lastUpdateTime:Date.now(),currentAnimation:"idle",animationType:"character",availableAnimations:[],isPlaying:!1,weight:1,speed:1,blendDuration:.3,activeActions:0});h.useEffect(()=>{if(!n)return;const o=()=>{const u=n.snapshot(e),l=n.getMetrics(e);i(d=>({...d,currentAnimation:u.currentAnimation,animationType:e,availableAnimations:u.availableAnimations,isPlaying:u.isPlaying,weight:u.weight,speed:u.speed,activeActions:u.metrics.activeAnimations,frameCount:(l==null?void 0:l.totalActions)||0,averageFrameTime:(l==null?void 0:l.mixerTime)||0,lastUpdateTime:Date.now()}))};return o(),n.subscribe((u,l)=>{l===e&&o()})},[n,e]);const s=(o,c,u=2)=>{if(o==null)return"N/A";switch(c){case"array":return Array.isArray(o)?`${o.length} animations`:String(o);case"boolean":return o?"Yes":"No";case"number":return typeof o=="number"?o.toFixed(u):String(o);default:return String(o)}},a=o=>t[o];return r.jsx("div",{className:"ad-panel",children:r.jsx("div",{className:"ad-content",children:Ti.filter(o=>o.enabled).map(o=>r.jsxs("div",{className:"ad-item",children:[r.jsx("span",{className:"ad-label",children:o.label}),r.jsx("span",{className:"ad-value",children:s(a(o.key),o.format)})]},o.key))})})}class Oi extends h.Component{constructor(){super(...arguments);j(this,"state",{hasError:!1,error:null,errorInfo:null})}static getDerivedStateFromError(t){return{hasError:!0,error:t,errorInfo:null}}componentDidCatch(t,i){var s,a;console.error("[Gaesup Error]",{error:t.toString(),stack:i.componentStack,timestamp:new Date().toISOString()}),this.reportError(t,i),(a=(s=this.props).onError)==null||a.call(s,t,i)}reportError(t,i){typeof window<"u"&&window.Sentry&&window.Sentry.captureException(t,{contexts:{react:{componentStack:i.componentStack}}})}render(){return this.state.hasError?this.props.fallback||r.jsx(Di,{error:this.state.error}):this.props.children}}function Di({error:n}){return console.error("ErrorBoundary caught error:",n),r.jsxs("div",{children:[r.jsx("h3",{children:"앱에서 오류가 발생했습니다"}),r.jsx("p",{children:"콘솔을 확인해주세요"})]})}function Lt(){const n=C(),e=C(l=>l.interaction),t=C(l=>l.updateKeyboard),i=C(l=>l.updateMouse),s=C(l=>l.urls),a=C(l=>l.activeState),o=C(l=>l.block),{getSizesByUrls:c}=gt(),u=!!(e&&s&&a);return{worldContext:n,activeState:a,input:{keyboard:e==null?void 0:e.keyboard,mouse:e==null?void 0:e.mouse},urls:s,setKeyboardInput:t,setMouseInput:i,getSizesByUrls:c,isReady:u,blockControl:o==null?void 0:o.control}}class Pi{constructor(){j(this,"memoManager",ue.getInstance());j(this,"vectorCache",this.memoManager.getVectorCache("direction"));j(this,"tempEuler",new y.Euler);j(this,"tempQuaternion",new y.Quaternion);j(this,"targetQuaternion",new y.Quaternion);j(this,"lastEulerY",{character:0,vehicle:0,airplane:0});j(this,"lastDirectionLength",0);j(this,"lastKeyboardState",{forward:!1,backward:!1,leftward:!1,rightward:!1})}updateDirection(e,t,i,s,a){const{modeType:o}=e;switch(o){case"character":this.updateCharacterDirection(e,t,i);break;case"vehicle":this.updateVehicleDirection(e,t);break;case"airplane":this.updateAirplaneDirection(e,s,a,t);break;default:this.updateCharacterDirection(e,t,i)}}updateCharacterDirection(e,t,i){const{activeState:s,keyboard:a,mouse:o,characterConfig:c}=e,u=this.lastKeyboardState.forward!==a.forward||this.lastKeyboardState.backward!==a.backward||this.lastKeyboardState.leftward!==a.leftward||this.lastKeyboardState.rightward!==a.rightward;o.isActive?this.handleMouseDirection(s,o,c,i):u&&((a.forward||a.backward||a.leftward||a.rightward)&&this.handleKeyboardDirection(s,a,c,t),this.lastKeyboardState={forward:a.forward,backward:a.backward,leftward:a.leftward,rightward:a.rightward}),this.emitRotationUpdate(s,"character")}updateVehicleDirection(e,t){const{activeState:i,keyboard:s}=e,{forward:a,backward:o,leftward:c,rightward:u}=s,l=Number(c)-Number(u),d=Number(a)-Number(o);l!==0&&(t==="chase"?i.euler.y+=l*(Math.PI/120):i.euler.y+=l*(Math.PI/64),this.emitRotationUpdate(i,"vehicle"));const{sin:m,cos:p}=Me(i.euler.y);i.direction.set(m*d,0,p*d),i.dir.copy(i.direction).normalize()}updateAirplaneDirection(e,t,i,s){const{activeState:a,keyboard:o,airplaneConfig:c}=e,{forward:u,backward:l,leftward:d,rightward:m,shift:p,space:M}=o,{angleDelta:S={x:0,y:0,z:0},maxAngle:b={x:0,y:0,z:0},accelRatio:f=1}=c||{};if(!(t!=null&&t.current))return;let x=1;p&&(x*=f),M&&(x*=1.5);const g=Number(l)-Number(u),v=Number(m)-Number(d);s==="chase"?a.euler.y+=-v*S.y*.5:a.euler.y+=-v*S.y,this.applyAirplaneRotation(t.current,g,v,b,a),a.direction.set(Math.sin(a.euler.y)*x,-g*x,Math.cos(a.euler.y)*x),a.dir.copy(a.direction).normalize(),C.getState().updateState({activeState:{...C.getState().activeState,euler:a.euler,direction:a.direction,dir:a.dir}})}applyAirplaneRotation(e,t,i,s,a){const o=s.x*t,c=s.z*i,u=e.rotation.x,l=e.rotation.z,d=s.x,m=s.z;let p=u+o,M=l+c;p<-d?p=-d:p>d&&(p=d),M<-m?M=-m:M>m&&(M=m),a.euler.x=p,a.euler.z=M,this.tempEuler.set(p,0,M),this.tempQuaternion.setFromEuler(e.rotation),this.targetQuaternion.setFromEuler(this.tempEuler),this.tempQuaternion.slerp(this.targetQuaternion,.2),e.setRotationFromQuaternion(this.tempQuaternion)}handleMouseDirection(e,t,i,s){const{automation:a}=s.worldContext||{};if(a!=null&&a.settings.trackProgress&&a.queue.actions&&a.queue.actions.length>0){const o=a.queue.actions.shift();if(o&&o.target){const c=s.body.translation(),u=o.target,l=new y.Vector3().subVectors(u,c).normalize();s.memo.direction=l.clone(),s.memo.directionTarget=u.clone(),a.settings.loop&&o&&a.queue.actions&&a.queue.actions.push(o)}}else{if(s!=null&&s.rigidBodyRef.current){const o=s.rigidBodyRef.current.translation(),c=this.vectorCache.getTempVector(0);if(c.set(o.x,o.y,o.z),st(c,t.target,!1)<1){this.handleClicker(s,o);return}}this.applyMouseRotation(e,t,i)}}handleClicker(e,t){var s,a;const{automation:i}=e.worldContext||{};if(i!=null&&i.settings.trackProgress&&i.queue.actions&&i.queue.actions.length>0){const o=i.queue.actions.shift();if(o&&o.target){const c=Math.atan2(o.target.z-t.z,o.target.x-t.x);(s=e.setMouseInput)==null||s.call(e,{target:o.target,angle:c,isActive:!0})}else if(o&&o.type==="wait"){const c=o.duration||1e3;e.state&&(e.state.clock.stop(),setTimeout(()=>{e.state&&e.state.clock.start()},c))}i.settings.loop&&o&&i.queue.actions&&i.queue.actions.push(o)}else(a=e.setMouseInput)==null||a.call(e,{isActive:!1,shouldRun:!1})}applyMouseRotation(e,t,i){const{turnSpeed:s=10}=i,a=Math.PI/2-t.angle;let o=ke(a-e.euler.y);const c=s*Math.PI/80,u=Math.sign(o)*Math.min(Math.abs(o),c);e.euler.y+=u;const{sin:l,cos:d}=Me(e.euler.y),m=this.vectorCache.getTempVector(2);m.set(-l,0,-d),e.direction.copy(m),e.dir.copy(m).normalize()}handleKeyboardDirection(e,t,i,s){const{forward:a,backward:o,leftward:c,rightward:u}=t,{turnSpeed:l=10}=i,d=Number(c)-Number(u),m=Number(a)-Number(o);if(d===0&&m===0)return;const p=this.vectorCache.getTempVector(5);p.set(d,0,m);const M=rt(p);let S=ke(M-e.euler.y);const b=l*Math.PI/160,f=Math.sign(S)*Math.min(Math.abs(S),b);e.euler.y+=f,e.dir.set(d,0,m),e.direction.copy(e.dir)}emitRotationUpdate(e,t){const i=e.dir.length(),s=Ee(e.euler.y,this.lastEulerY[t],.001),a=Ee(i,this.lastDirectionLength,.01);(s||a)&&(C.getState().updateState({activeState:{...C.getState().activeState,euler:e.euler,direction:e.direction,dir:e.dir}}),this.lastDirectionLength=i),this.lastEulerY[t]=e.euler.y}}class zi{applyImpulse(e,t){if(!e.current)return;const{modeType:i}=t;switch(i){case"character":this.applyCharacterImpulse(e,t);break;case"vehicle":this.applyVehicleImpulse(e,t);break;case"airplane":this.applyAirplaneImpulse(e,t);break;default:this.applyCharacterImpulse(e,t)}}applyCharacterImpulse(e,t){const{gameStates:{isMoving:i,isRunning:s,isOnTheGround:a,isJumping:o},activeState:c,characterConfig:u}=t,{walkSpeed:l=10,runSpeed:d=20,jumpSpeed:m=15}=u;if(o&&a){const p=e.current.linvel();e.current.setLinvel({x:p.x,y:m,z:p.z},!0),C.getState().setStates({isJumping:!1,isOnTheGround:!0})}if(i){const p=s?d:l,M=c.dir,S=c.velocity,b=e.current.mass(),f=-M.x*p,x=-M.z*p,g=f-S.x,v=x-S.z,k=g*b,R=v*b;e.current.applyImpulse({x:k,y:0,z:R},!0)}}applyVehicleImpulse(e,t){const{activeState:i,vehicleConfig:s}=t,{maxSpeed:a=10}=s,o=i.direction.clone().multiplyScalar(a);e.current.applyImpulse({x:o.x,y:0,z:o.z},!0)}applyAirplaneImpulse(e,t){const{activeState:i,airplaneConfig:s}=t,{maxSpeed:a=5}=s,o=i.direction.clone().multiplyScalar(a);e.current.applyImpulse({x:o.x,y:o.y,z:o.z},!0)}}class Vi{applyGravity(e,t){if(!e.current)return;const{modeType:i}=t;switch(i){case"character":this.applyCharacterGravity(e,t);break;case"airplane":this.applyAirplaneGravity(e,t);break;case"vehicle":break;default:this.applyCharacterGravity(e,t)}}applyCharacterGravity(e,t){const{gameStates:{isJumping:i,isFalling:s},characterConfig:{jumpGravityScale:a=1.5,normalGravityScale:o=1}}=t;i||s?e.current.setGravityScale(a,!1):e.current.setGravityScale(o,!1)}applyAirplaneGravity(e,t){const{airplaneConfig:{gravityScale:i=.3}={}}=t;e.current.setGravityScale(i,!1)}}class Gi{constructor(){j(this,"keyStateCache",new Map);j(this,"isCurrentlyJumping",!1);j(this,"lastMovingState",!1);j(this,"lastRunningState",!1)}checkAll(e,t){var s;const i=`physics-${((s=e.rigidBodyRef.current)==null?void 0:s.handle)||"unknown"}`;this.checkGround(e),this.checkMoving(e),this.checkRotate(e,t.activeState),this.checkRiding(e,i)}checkGround(e){const{rigidBodyRef:t,matchSizes:i}=e;if(!t.current){C.getState().setStates({isOnTheGround:!1,isFalling:!0});return}const s=t.current.linvel(),a=t.current.translation();let o=1;i&&i.characterUrl&&(o=i.characterUrl.y*.1);const c=a.y<=o,u=Math.abs(s.y)<.5,l=c&&u,d=!l&&s.y<-.1;l&&this.resetJumpState(),C.getState().setStates({isOnTheGround:l,isFalling:d}),C.getState().updateState({activeState:{...C.getState().activeState,position:new y.Vector3(a.x,a.y,a.z),velocity:new y.Vector3(s.x,s.y,s.z)}})}checkMoving(e){const{inputRef:t}=e;if(!t||!t.current)return;const i=t.current.keyboard,s=t.current.mouse,a=i.shift,o=i.space,c=i.forward,u=i.backward,l=i.leftward,d=i.rightward,m=s.isActive,p=s.shouldRun,M=c||u||l||d,S=M||m;let b=!1;(M&&a||m&&p)&&(b=!0),o&&!this.isCurrentlyJumping&&(this.isCurrentlyJumping=!0,C.getState().setStates({isJumping:!0,isOnTheGround:!0})),(this.lastMovingState!==S||this.lastRunningState!==b)&&(this.lastMovingState=S,this.lastRunningState=b,C.getState().setStates({isMoving:S,isRunning:b,isNotMoving:!S,isNotRunning:!b}))}checkRotate(e,t){const{outerGroupRef:i}=e;!t.isMoving||i!=null&&i.current}checkRiding(e,t="default"){const{inputRef:i}=e;if(!i||!i.current)return;this.keyStateCache.has(t)||this.keyStateCache.set(t,{lastKeyE:!1,lastKeyR:!1});const s=this.keyStateCache.get(t),a=i.current.keyboard.keyF,o=C.getState().states;a&&!s.lastKeyE&&(o.canRide&&!o.isRiding?C.getState().setStates({shouldEnterRideable:!0,shouldExitRideable:!1}):o.isRiding&&C.getState().setStates({shouldEnterRideable:!1,shouldExitRideable:!0})),s.lastKeyE=a,s.lastKeyR=!1}resetJumpState(){this.isCurrentlyJumping=!1}}class Ft{constructor(){j(this,"directionController",new Pi);j(this,"impulseController",new zi);j(this,"gravityController",new Vi);j(this,"stateChecker",new Gi)}calculate(e,t){if(!t||!e.rigidBodyRef.current)return;const i=e.rigidBodyRef.current.linvel();t.activeState.velocity.set(i.x,i.y,i.z),this.stateChecker.checkAll(e,t);const{rigidBodyRef:s,innerGroupRef:a,matchSizes:o}=e,{modeType:c="character"}=t;if(this.directionController.updateDirection(t,"normal",e,c==="airplane"?a:void 0,c==="airplane"?o:void 0),this.impulseController.applyImpulse(s,t),(c==="character"||c==="airplane")&&this.gravityController.applyGravity(s,t),(c==="vehicle"||c==="airplane")&&this.applyDamping(s,t),s!=null&&s.current){if(c==="character"&&(a!=null&&a.current)){const{gameStates:{isJumping:u,isFalling:l,isNotMoving:d},activeState:m,characterConfig:{linearDamping:p=.2,airDamping:M=.1,stopDamping:S=2}}=t;s.current.setLinearDamping(u||l?M:d?p*S:p),a.current.quaternion.setFromEuler(m.euler)}s.current.setEnabledRotations(!1,!1,!1,!1)}}applyDamping(e,t){if(!(e!=null&&e.current)||!t)return;const{modeType:i,vehicleConfig:s,airplaneConfig:a}=t;let o=0;i==="vehicle"?o=(s==null?void 0:s.linearDamping)||.9:i==="airplane"&&(o=(a==null?void 0:a.linearDamping)||.8),o>0&&e.current.setLinearDamping(o)}}class _t{constructor(e,t={}){j(this,"state");j(this,"config");j(this,"metrics");j(this,"type");this.type=e,this.state={position:new y.Vector3,velocity:new y.Vector3,rotation:new y.Euler,isGrounded:!1,isMoving:!1,speed:0,direction:new y.Vector3,lastUpdate:0},this.config={maxSpeed:10,acceleration:15,deceleration:10,turnSpeed:8,jumpForce:12,gravity:-30,linearDamping:.95,angularDamping:.85,...t},this.metrics={currentSpeed:0,averageSpeed:0,totalDistance:0,frameTime:0,physicsTime:0,lastPosition:new y.Vector3,isAccelerating:!1,groundContact:!1}}updatePosition(e){this.metrics.lastPosition.copy(this.state.position),this.state.position.copy(e),this.calculateSpeed()}updateVelocity(e){this.state.velocity.copy(e),this.state.speed=e.length(),this.state.isMoving=this.state.speed>.1}updateRotation(e){this.state.rotation.copy(e)}setGrounded(e){this.state.isGrounded=e,this.metrics.groundContact=e}applyForce(e,t){const i=t.linvel(),s=new y.Vector3(i.x+e.x,i.y+e.y,i.z+e.z);t.setLinvel(s,!0)}calculateMovement(e,t){const i=new y.Vector3,s=e.shift?2:1,a=this.config.maxSpeed*s;return e.forward&&(i.z-=1),e.backward&&(i.z+=1),e.leftward&&(i.x-=1),e.rightward&&(i.x+=1),i.length()>0&&(i.normalize(),i.multiplyScalar(a*t)),i}calculateJump(){return this.state.isGrounded?new y.Vector3(0,this.config.jumpForce,0):new y.Vector3}update(e){this.state.lastUpdate=Date.now(),this.metrics.frameTime=e,this.updateMetrics(e)}calculateSpeed(){const e=this.state.position.distanceTo(this.metrics.lastPosition);this.metrics.totalDistance+=e,this.metrics.currentSpeed=e/(this.metrics.frameTime||.016)}updateMetrics(e){this.metrics.isAccelerating=this.state.speed>this.metrics.currentSpeed,this.metrics.averageSpeed=this.metrics.totalDistance/(this.state.lastUpdate/1e3)}getState(){return{...this.state}}getMetrics(){return{...this.metrics}}getConfig(){return{...this.config}}updateConfig(e){this.config={...this.config,...e}}reset(){this.state.position.set(0,0,0),this.state.velocity.set(0,0,0),this.state.rotation.set(0,0,0),this.state.speed=0,this.state.isMoving=!1,this.state.isGrounded=!1,this.metrics.totalDistance=0,this.metrics.currentSpeed=0,this.metrics.averageSpeed=0}dispose(){this.reset()}}class Li{constructor(){j(this,"engines");j(this,"eventListeners");j(this,"rigidBodies");this.engines=new Map,this.eventListeners=new Set,this.rigidBodies=new Map}registerEntity(e,t,i){const s=new _t(t);this.engines.set(e,s),this.rigidBodies.set(e,i)}unregisterEntity(e){const t=this.engines.get(e);t&&(t.dispose(),this.engines.delete(e)),this.rigidBodies.delete(e)}execute(e,t){var a,o;const i=this.engines.get(e),s=this.rigidBodies.get(e);if(!(!i||!s)){switch(t.type){case"move":(a=t.data)!=null&&a.movement&&i.applyForce(t.data.movement,s);break;case"jump":const c=i.calculateJump();c.length()>0&&i.applyForce(c,s);break;case"stop":const u=s.linvel();s.setLinvel({x:0,y:u.y,z:0},!0);break;case"setConfig":(o=t.data)!=null&&o.config&&i.updateConfig(t.data.config);break;case"reset":i.reset(),s.setTranslation({x:0,y:0,z:0},!0),s.setLinvel({x:0,y:0,z:0},!0);break}this.notifyListeners(e)}}updateEntity(e,t){const i=this.engines.get(e),s=this.rigidBodies.get(e);if(!i||!s)return;const a=new y.Vector3().copy(s.translation()),o=new y.Vector3().copy(s.linvel()),c=new y.Euler().setFromQuaternion(new y.Quaternion().copy(s.rotation()));i.updatePosition(a),i.updateVelocity(o),i.updateRotation(c),i.update(t)}snapshot(e){const t=this.engines.get(e);if(!t)return null;const i=t.getState(),s=t.getMetrics(),a=t.getConfig();return{type:"character",position:i.position.clone(),velocity:i.velocity.clone(),rotation:i.rotation.clone(),isGrounded:i.isGrounded,isMoving:i.isMoving,speed:i.speed,metrics:{currentSpeed:s.currentSpeed,averageSpeed:s.averageSpeed,totalDistance:s.totalDistance,frameTime:s.frameTime,isAccelerating:s.isAccelerating},config:{maxSpeed:a.maxSpeed,acceleration:a.acceleration,jumpForce:a.jumpForce}}}getAllSnapshots(){const e=new Map;return this.engines.forEach((t,i)=>{const s=this.snapshot(i);s&&e.set(i,s)}),e}subscribe(e){return this.eventListeners.add(e),()=>this.eventListeners.delete(e)}notifyListeners(e){const t=this.snapshot(e);t&&this.eventListeners.forEach(i=>i(t))}getActiveEntities(){return Array.from(this.engines.keys())}dispose(){this.engines.forEach(e=>e.dispose()),this.engines.clear(),this.rigidBodies.clear(),this.eventListeners.clear()}}const Fi=[{id:"slow",name:"Slow",maxSpeed:5,acceleration:8},{id:"normal",name:"Normal",maxSpeed:10,acceleration:15},{id:"fast",name:"Fast",maxSpeed:20,acceleration:25},{id:"sprint",name:"Sprint",maxSpeed:35,acceleration:40}],_i=[{id:"eco",name:"Eco",maxSpeed:15,acceleration:10},{id:"comfort",name:"Comfort",maxSpeed:25,acceleration:20},{id:"sport",name:"Sport",maxSpeed:40,acceleration:35},{id:"turbo",name:"Turbo",maxSpeed:60,acceleration:50}];function Oe(){const{mode:n,motion:e,setCurrentPreset:t,setMotionType:i}=C(),s=(e==null?void 0:e.motionType)||(n==null?void 0:n.type)||"character",a=(e==null?void 0:e.currentPreset)||"normal",o=s==="vehicle"?_i:Fi,c=l=>{t(l)},u=l=>{const d=l.target.value;i(d),t(d==="vehicle"?"comfort":"normal")};return r.jsxs("div",{className:"mc-panel",children:[r.jsxs("div",{className:"mc-setting-row",children:[r.jsx("label",{htmlFor:"motion-type-select",className:"mc-label",children:"Motion Type"}),r.jsxs("select",{id:"motion-type-select",className:"mc-select",value:s,onChange:u,children:[r.jsx("option",{value:"character",children:"Character"}),r.jsx("option",{value:"vehicle",children:"Vehicle"})]})]}),r.jsxs("div",{className:"mc-setting-row",children:[r.jsx("label",{className:"mc-label",children:"Presets"}),r.jsx("div",{className:"mc-presets-grid",children:o.map(l=>r.jsx("button",{className:`mc-preset-btn ${l.id===a?"active":""}`,onClick:()=>c(l.id),title:`Max Speed: ${l.maxSpeed}, Accel: ${l.acceleration}`,children:l.name},l.id))})]})]})}const Ui=[{key:"motionType",label:"Motion Type",type:"text"},{key:"position",label:"Position",type:"vector3"},{key:"velocity",label:"Velocity",type:"vector3"},{key:"speed",label:"Speed",type:"number"},{key:"direction",label:"Direction",type:"vector3"},{key:"isGrounded",label:"Grounded",type:"text"},{key:"isMoving",label:"Moving",type:"text"},{key:"acceleration",label:"Acceleration",type:"number"},{key:"jumpForce",label:"Jump Force",type:"number"},{key:"maxSpeed",label:"Max Speed",type:"number"},{key:"totalDistance",label:"Total Distance",type:"number"},{key:"gameState",label:"Game State",type:"text"}];function De(){const{motion:n,metrics:e,config:t}=C(),i=(a,o,c=2)=>{if(o==null)return"N/A";switch(a.type){case"vector3":return o.x!==void 0?`X:${o.x.toFixed(c)} Y:${o.y.toFixed(c)} Z:${o.z.toFixed(c)}`:String(o);case"boolean":return typeof o=="boolean"?o?"Yes":"No":String(o);case"number":return typeof o=="number"?o.toFixed(c):String(o);default:return String(o)}},s=a=>{switch(a.key){case"motionType":return(n==null?void 0:n.type)||"character";case"position":return(n==null?void 0:n.position)||{x:0,y:0,z:0};case"velocity":return(n==null?void 0:n.velocity)||{x:0,y:0,z:0};case"speed":return(n==null?void 0:n.speed)||0;case"isGrounded":return n==null?void 0:n.grounded;case"isMoving":return n!=null&&n.velocity?Math.abs(n.velocity.x)+Math.abs(n.velocity.z)>.1:!1;default:return e[a.key]||t[a.key]||"N/A"}};return r.jsx("div",{className:"md-panel",children:r.jsx("div",{className:"md-content",children:Ui.map(a=>r.jsxs("div",{className:"md-item",children:[r.jsx("span",{className:"md-label",children:a.label}),r.jsx("span",{className:"md-value",children:i(a,s(a))})]},a.key))})})}function Bi({showController:n=!0,showDebugPanel:e=!0,controllerProps:t={},debugPanelProps:i={}}){return r.jsxs(r.Fragment,{children:[n&&r.jsx(Oe,{position:"bottom-left",showLabels:!0,compact:!1,...t}),e&&r.jsx(De,{position:"top-right",updateInterval:100,precision:2,compact:!1,...i})]})}function qi({text:n,position:e,teleportStyle:t}){const{teleport:i,canTeleport:s}=xt(),a=()=>{i(e)||console.warn("이동에 실패했습니다.")};return r.jsxs("div",{className:`teleport ${s?"":"teleport--disabled"}`,onClick:a,style:t,title:s?"Click to teleport":"Teleport not available",children:[n||"Teleport",!s&&r.jsx("span",{className:"teleport__cooldown",children:"⏱️"})]})}function Pe({nodes:n,color:e,skeleton:t,url:i}){const s=h.useMemo(()=>Object.keys(n).map((a,o)=>{const c=n[a];return c instanceof y.SkinnedMesh?{type:"skinnedMesh",material:Array.isArray(c.material)?c.material.map(l=>{const d=l.clone();return e&&"color"in d&&d.color instanceof y.Color&&d.color.set(e),d}):(()=>{const l=c.material.clone();return e&&"color"in l&&l.color instanceof y.Color&&l.color.set(e),l})(),geometry:c.geometry,skeleton:t||c.skeleton,key:`${i}-${a}-${o}`}:c instanceof y.Mesh?{type:"mesh",material:Array.isArray(c.material)?c.material.map(l=>{const d=l.clone();return e&&"color"in d&&d.color instanceof y.Color&&d.color.set(e),d}):(()=>{const l=c.material.clone();return e&&"color"in l&&l.color instanceof y.Color&&l.color.set(e),l})(),geometry:c.geometry,key:`${i}-${a}-${o}`}:null}).filter(Boolean),[n,e,t,i]);return r.jsx(r.Fragment,{children:s.map(a=>a?a.type==="skinnedMesh"?r.jsx("skinnedMesh",{castShadow:!0,receiveShadow:!0,material:a.material,geometry:a.geometry,skeleton:a.skeleton},a.key):r.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:a.material,geometry:a.geometry},a.key):null)})}function Hi({url:n,isActive:e,color:t,skeleton:i}){const{scene:s,animations:a}=L.useGLTF(n),{actions:o}=L.useAnimations(a),c=h.useMemo(()=>Ae.SkeletonUtils.clone(s),[s]),{nodes:u}=U.useGraph(c);return ne(o),r.jsx("group",{children:r.jsx(Pe,{nodes:u,color:t,skeleton:i,url:n})})}function Wi({url:n,children:e,offset:t=new y.Vector3(0,0,0)}){const{gltf:i}=pt({url:n}),{animations:s,scene:a}=i,{actions:o,ref:c}=L.useAnimations(s),u=h.useMemo(()=>Ae.SkeletonUtils.clone(a),[a]),{nodes:l}=U.useGraph(u),d=Object.values(l).find(m=>m.type==="Object3D");return ne(o),r.jsxs("group",{position:t,children:[d&&r.jsx("primitive",{object:d,visible:!1,receiveShadow:!0,castShadow:!0,ref:c}),r.jsx(Pe,{nodes:l,url:n}),e]})}const $i=h.forwardRef((n,e)=>(h.useEffect(()=>()=>{n.objectNode&&n.objectNode.traverse(t=>{var i;t instanceof y.Mesh&&((i=t.geometry)==null||i.dispose(),t.material&&(Array.isArray(t.material)?t.material.forEach(s=>s.dispose()):t.material.dispose()))})},[n.objectNode]),r.jsxs("group",{receiveShadow:!0,castShadow:!0,ref:e,userData:{intangible:!0},children:[n.isRiderOn&&n.enableRiding&&n.isActive&&n.ridingUrl&&r.jsx(Wi,{url:n.ridingUrl,offset:n.offset}),n.children,n.objectNode&&n.animationRef&&r.jsx("primitive",{object:n.objectNode,visible:!1,receiveShadow:!0,castShadow:!0,ref:n.animationRef}),r.jsx(Pe,{nodes:n.nodes,skeleton:n.skeleton,url:n.url||""})]})));function Ki(){return({groundRay:n,length:e,colliderRef:t})=>{if(!t.current||!n||!n.origin||!n.dir)return;const i=new y.Raycaster;i.set(n.origin,n.dir),i.far=e,i.intersectObjects([],!0).length>0&&t.current.setActiveEvents(1)}}function Yi({url:n,active:e=!1}){const{animations:t}=L.useGLTF(n),{actions:i}=L.useAnimations(t);return ne(e),null}const Qi=h.forwardRef((n,e)=>{const{size:t}=pt({url:n.url||""}),i=Ki(),{scene:s,animations:a}=L.useGLTF(n.url),{actions:o,ref:c}=L.useAnimations(a),u=h.useMemo(()=>Ae.SkeletonUtils.clone(s),[s]),l=h.useMemo(()=>{let v=null;return u.traverse(k=>{k instanceof y.SkinnedMesh&&(v=k.skeleton)}),v},[u]),d=C(v=>v.mode);h.useEffect(()=>{o&&(d!=null&&d.type)&&n.isActive&&Re().registerAnimations(d.type,o)},[o,d==null?void 0:d.type,n.isActive]);const m=h.useMemo(()=>!n.parts||n.parts.length===0?null:n.parts.map(({url:v,color:k},R)=>v?r.jsx(Hi,{url:v,isActive:!0,componentType:n.componentType,currentAnimation:n.currentAnimation,color:k,skeleton:l},`${n.componentType}-${v}-${k||"default"}-${R}`):null).filter(Boolean),[n.parts,n.componentType,n.currentAnimation,l]);h.useEffect(()=>()=>{u&&u.traverse(v=>{if(v instanceof y.Mesh){if(v.geometry.dispose(),Array.isArray(v.material))v.material.forEach(k=>{Object.keys(k).forEach(R=>{const E=k[R];E!=null&&E.isTexture&&E.dispose()}),k.dispose()});else if(v.material){const k=v.material;Object.keys(k).forEach(R=>{var E;(E=k[R])!=null&&E.isTexture&&k[R].dispose()}),k.dispose()}}}),l&&l.dispose(),o&&Object.values(o).forEach(v=>{v&&(v.stop(),v.getMixer().uncacheAction(v.getClip()))})},[u,l,o]),h.useEffect(()=>{n.groundRay&&n.colliderRef&&i({groundRay:n.groundRay,length:2,colliderRef:n.colliderRef})},[n.groundRay,n.colliderRef,i]),n.isActive&&es({outerGroupRef:n.outerGroupRef,innerGroupRef:n.innerGroupRef,rigidBodyRef:e,colliderRef:n.colliderRef,groundRay:n.groundRay});const p=C(v=>v.states.isRiding);ne(n.isActive&&!p),h.useEffect(()=>{!n.isActive&&o&&o.idle&&o.idle.reset().play()},[o,n.isActive]),n.onReady&&n.onReady(),n.onFrame&&n.onFrame(),n.onAnimate&&o&&n.onAnimate();const{nodes:M}=U.useGraph(u),S=Object.values(M).find(v=>v.type==="Object3D"),b=n.rotation instanceof y.Euler?n.rotation.y:0,f=async v=>{var k;n.onIntersectionEnter&&await n.onIntersectionEnter(v),(k=n.userData)!=null&&k.onNear&&await n.userData.onNear(v,n.userData)},x=async v=>{var k;n.onIntersectionExit&&await n.onIntersectionExit(v),(k=n.userData)!=null&&k.onLeave&&await n.userData.onLeave(v)},g=async v=>{var k;n.onCollisionEnter&&await n.onCollisionEnter(v),(k=n.userData)!=null&&k.onNear&&await n.userData.onNear(v,n.userData)};return r.jsxs("group",{ref:n.outerGroupRef,userData:{intangible:!0},children:[n.isActive&&r.jsx(Ot,{}),n.ridingUrl&&d.type!=="character"&&r.jsx(Yi,{url:n.ridingUrl,active:p}),r.jsxs(q.RigidBody,{canSleep:!1,ccd:!0,colliders:!1,ref:e,name:n.name||(n.isActive?"character":n.componentType),position:n.position,rotation:q.euler().set(0,b,0),userData:n.userData,type:n.rigidbodyType||(n.isActive?"dynamic":"fixed"),sensor:n.sensor,onIntersectionEnter:f,onIntersectionExit:x,onCollisionEnter:g,...n.rigidBodyProps,children:[!n.isNotColliding&&r.jsx(q.CapsuleCollider,{ref:n.colliderRef,args:[(t.y/2-t.x)*1.2,t.x*1.2],position:[0,t.x*1.2,0]}),r.jsxs($i,{objectNode:S,animationRef:c,nodes:M,ref:n.innerGroupRef,isActive:n.isActive,isRiderOn:n.isRiderOn,enableRiding:n.enableRiding,ridingUrl:n.ridingUrl,offset:n.offset,parts:n.parts,children:[n.children,m]})]})]})});function Xi(){const n=h.useRef(null),e=h.useRef(null),t=h.useRef(null),i=h.useRef(null);return{outerGroupRef:n,innerGroupRef:e,rigidBodyRef:t,colliderRef:i}}function Ji({props:n,children:e}){const t=C(b=>b.mode),i=C(b=>b.states),s=C(b=>b.rideable),a=C(b=>b.urls),o=C(b=>b.setRefs),c=Xi(),u=h.useRef(!1);if(h.useEffect(()=>{o&&!u.current&&(o({rigidBodyRef:c.rigidBodyRef,colliderRef:c.colliderRef,outerGroupRef:c.outerGroupRef,innerGroupRef:c.innerGroupRef}),u.current=!0)},[o,c]),!t||!i||!s||!a)return null;const{enableRiding:l,isRiderOn:d,rideableId:m}=i,p=h.useMemo(()=>m&&s[m]?s[m].offset:q.vec3(),[m,s]),S=(()=>{const b={isActive:!0,componentType:t.type,controllerOptions:n.controllerOptions,enableRiding:l,isRiderOn:d,groundRay:n.groundRay,offset:p,children:e,ref:c.rigidBodyRef,outerGroupRef:c.outerGroupRef,innerGroupRef:c.innerGroupRef,colliderRef:c.colliderRef,onAnimate:n.onAnimate||(()=>{}),onFrame:n.onFrame||(()=>{}),onReady:n.onReady||(()=>{}),onDestory:n.onDestory||(()=>{}),rigidBodyProps:n.rigidBodyProps,parts:(n.parts||[]).filter(x=>!!x.url).map(x=>({...x,url:x.url}))},f=d&&t.type!=="character"?{ridingUrl:a.ridingUrl}:{ridingUrl:void 0};switch(t.type){case"character":return{...b,url:a.characterUrl||""};case"vehicle":return{...b,...f,url:a.vehicleUrl||"",wheelUrl:a.wheelUrl};case"airplane":return{...b,...f,url:a.airplaneUrl||""};default:return{...b,url:a.characterUrl||""}}})();return r.jsx(Qi,{...S,groundRay:n.groundRay})}function Ut({props:n}){return r.jsx(Ji,{props:n,children:n.children})}const Zi=(n,e)=>{["forward","backward","leftward","rightward","shift","space","keyE","keyR"].forEach(s=>{n.keyboard[s]!==e.keyboard[s]&&(n.keyboard[s]=e.keyboard[s])}),n.mouse.target.equals(e.mouse.target)||n.mouse.target.copy(e.mouse.target),["angle","isActive","shouldRun"].forEach(s=>{n.mouse[s]!==e.mouse[s]&&(n.mouse[s]=e.mouse[s])})},es=n=>{const e=Lt(),t=h.useRef(null),i=h.useRef(new Ft),s=h.useRef(!1);h.useEffect(()=>{!s.current&&e.worldContext&&(s.current=!0)},[e.worldContext]),h.useEffect(()=>{const o=c=>{try{const{position:u}=c.detail;n.rigidBodyRef.current&&u&&(n.rigidBodyRef.current.setTranslation({x:u.x,y:u.y,z:u.z},!0),n.rigidBodyRef.current.setLinvel({x:0,y:0,z:0},!0),n.rigidBodyRef.current.setAngvel({x:0,y:0,z:0},!0))}catch(u){console.error("Teleport error:",u)}};return window.addEventListener("gaesup:teleport",o),document.addEventListener("teleport-request",o),()=>{window.removeEventListener("gaesup:teleport",o),document.removeEventListener("teleport-request",o)}},[n.rigidBodyRef]);const a=h.useCallback((o,c)=>{var u,l,d;try{if(!e.worldContext||!e.input)return;if(t.current)Zi(t.current,e.input),t.current&&(t.current.gameStates=e.worldContext.states);else{const p=((l=(u=e.worldContext)==null?void 0:u.mode)==null?void 0:l.type)||"character";t.current={activeState:e.activeState,gameStates:e.worldContext.states,keyboard:{...e.input.keyboard},mouse:{target:e.input.mouse.target.clone(),angle:e.input.mouse.angle,isActive:e.input.mouse.isActive,shouldRun:e.input.mouse.shouldRun},characterConfig:e.worldContext.character||{},vehicleConfig:e.worldContext.vehicle||{},airplaneConfig:e.worldContext.airplane||{},automation:e.worldContext.automation||{},modeType:p},(d=n.rigidBodyRef)!=null&&d.current&&e.activeState&&(n.rigidBodyRef.current.lockRotations(!1,!0),e.activeState.euler.set(0,0,0),n.rigidBodyRef.current.setTranslation({x:e.activeState.position.x,y:e.activeState.position.y+5,z:e.activeState.position.z},!0))}const m={...n,state:o,delta:c,worldContext:e.worldContext,dispatch:e.dispatch,matchSizes:e.getSizesByUrls(),inputRef:{current:e.input},setKeyboardInput:e.setKeyboardInput,setMouseInput:e.setMouseInput};i.current.calculate(m,t.current)}catch(m){console.error("Physics execution error:",m)}},[e,n]);U.useFrame((o,c)=>{var u,l,d,m;if(!(!e.isReady||!s.current)){if(e.blockControl){(l=(u=n.rigidBodyRef)==null?void 0:u.current)==null||l.resetForces(!1),(m=(d=n.rigidBodyRef)==null?void 0:d.current)==null||m.resetTorques(!1);return}a(o,c)}})};class Bt{constructor(){j(this,"state");j(this,"config");j(this,"metrics");j(this,"eventCallbacks");this.state=this.createDefaultState(),this.config=this.createDefaultConfig(),this.metrics=this.createDefaultMetrics(),this.eventCallbacks=new Map}createDefaultState(){return{keyboard:{forward:!1,backward:!1,leftward:!1,rightward:!1,shift:!1,space:!1,keyZ:!1,keyR:!1,keyF:!1,keyE:!1,escape:!1},mouse:{target:new y.Vector3,angle:0,isActive:!1,shouldRun:!1,buttons:{left:!1,right:!1,middle:!1},wheel:0,position:new y.Vector2},gamepad:{connected:!1,leftStick:new y.Vector2,rightStick:new y.Vector2,triggers:{left:0,right:0},buttons:{},vibration:{weak:0,strong:0}},touch:{touches:[],gestures:{pinch:1,rotation:0,pan:new y.Vector2}},lastUpdate:0,isActive:!0}}createDefaultConfig(){return{sensitivity:{mouse:1,gamepad:1,touch:1},deadzone:{gamepad:.1,touch:.05},smoothing:{mouse:.1,gamepad:.2},invertY:!1,enableVibration:!0}}createDefaultMetrics(){return{inputLatency:0,frameTime:0,eventCount:0,activeInputs:[],performanceScore:100}}updateKeyboard(e){Object.assign(this.state.keyboard,e),this.updateMetrics()}updateMouse(e){Object.assign(this.state.mouse,e),this.updateMetrics()}updateGamepad(e){Object.assign(this.state.gamepad,e),this.updateMetrics()}updateTouch(e){Object.assign(this.state.touch,e),this.updateMetrics()}setConfig(e){Object.assign(this.config,e)}getState(){return{...this.state}}getConfig(){return{...this.config}}getMetrics(){return{...this.metrics}}addEventListener(e,t){this.eventCallbacks.has(e)||this.eventCallbacks.set(e,[]),this.eventCallbacks.get(e).push(t)}removeEventListener(e,t){const i=this.eventCallbacks.get(e);if(i){const s=i.indexOf(t);s>-1&&i.splice(s,1)}}updateMetrics(){this.metrics.eventCount++,this.metrics.lastUpdate=Date.now(),this.metrics.activeInputs=this.getActiveInputs()}getActiveInputs(){const e=[];return Object.entries(this.state.keyboard).forEach(([t,i])=>{i&&e.push(`keyboard:${t}`)}),Object.entries(this.state.mouse.buttons).forEach(([t,i])=>{i&&e.push(`mouse:${t}`)}),this.state.gamepad.connected&&e.push("gamepad:connected"),this.state.touch.touches.length>0&&e.push(`touch:${this.state.touch.touches.length}`),e}reset(){this.state=this.createDefaultState(),this.metrics=this.createDefaultMetrics(),this.eventCallbacks.clear()}dispose(){this.reset()}}class qt{constructor(){j(this,"state");j(this,"config");j(this,"metrics");j(this,"executionTimer");j(this,"eventCallbacks");this.state=this.createDefaultState(),this.config=this.createDefaultConfig(),this.metrics=this.createDefaultMetrics(),this.executionTimer=null,this.eventCallbacks=new Map}createDefaultState(){return{isActive:!1,queue:{actions:[],currentIndex:0,isRunning:!1,isPaused:!1,loop:!1,maxRetries:3},currentAction:null,executionStats:{totalExecuted:0,successRate:100,averageTime:0,errors:[]},settings:{throttle:100,autoStart:!1,trackProgress:!0,showVisualCues:!0}}}createDefaultConfig(){return{maxConcurrentActions:1,defaultDelay:100,retryDelay:1e3,timeoutDuration:5e3,enableLogging:!0,visualCues:{showPath:!0,showTargets:!0,lineColor:"#00ff00",targetColor:"#ff0000"}}}createDefaultMetrics(){return{queueLength:0,executionTime:0,performance:100,memoryUsage:0,errorRate:0}}addAction(e){const t=`action_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={...e,id:t,timestamp:Date.now()};return this.state.queue.actions.push(i),this.updateMetrics(),this.emit("actionAdded",i),this.state.settings.autoStart&&!this.state.queue.isRunning&&this.start(),t}removeAction(e){const t=this.state.queue.actions.findIndex(i=>i.id===e);return t>-1?(this.state.queue.actions.splice(t,1),this.updateMetrics(),this.emit("actionRemoved",e),!0):!1}clearQueue(){this.state.queue.actions=[],this.state.queue.currentIndex=0,this.updateMetrics(),this.emit("queueCleared")}start(){this.state.queue.actions.length!==0&&(this.state.queue.isRunning=!0,this.state.queue.isPaused=!1,this.emit("automationStarted"),this.executeNext())}pause(){this.state.queue.isPaused=!0,this.executionTimer&&(clearTimeout(this.executionTimer),this.executionTimer=null),this.emit("automationPaused")}resume(){this.state.queue.isPaused&&(this.state.queue.isPaused=!1,this.emit("automationResumed"),this.executeNext())}stop(){this.state.queue.isRunning=!1,this.state.queue.isPaused=!1,this.state.currentAction=null,this.executionTimer&&(clearTimeout(this.executionTimer),this.executionTimer=null),this.emit("automationStopped")}async executeNext(){if(!this.state.queue.isRunning||this.state.queue.isPaused)return;if(this.state.queue.currentIndex>=this.state.queue.actions.length)if(this.state.queue.loop)this.state.queue.currentIndex=0;else{this.stop(),this.emit("automationCompleted");return}const e=this.state.queue.actions[this.state.queue.currentIndex];if(e){this.state.currentAction=e,this.emit("actionStarted",e);try{await this.executeAction(e),this.state.executionStats.totalExecuted++,this.state.queue.currentIndex++,this.emit("actionCompleted",e);const t=e.delay||this.state.settings.throttle;this.executionTimer=window.setTimeout(()=>this.executeNext(),t)}catch(t){this.handleExecutionError(e,t)}}}async executeAction(e){e.beforeCallback&&e.beforeCallback();const t=Date.now();switch(e.type){case"move":e.target&&this.emit("moveRequested",e.target);break;case"click":e.target&&this.emit("clickRequested",e.target);break;case"wait":await new Promise(s=>setTimeout(s,e.duration||1e3));break;case"key":e.key&&this.emit("keyRequested",e.key);break;case"custom":this.emit("customActionRequested",e.data);break}const i=Date.now()-t;this.updateExecutionStats(i),e.afterCallback&&e.afterCallback()}handleExecutionError(e,t){var s;this.state.executionStats.errors.push(`${e.id}: ${t.message}`),this.emit("actionError",{action:e,error:t});const i=((s=e.data)==null?void 0:s.retryCount)||0;i<this.state.queue.maxRetries?(e.data={...e.data,retryCount:i+1},this.executionTimer=window.setTimeout(()=>this.executeNext(),this.config.retryDelay)):(this.state.queue.currentIndex++,this.executionTimer=window.setTimeout(()=>this.executeNext(),this.state.settings.throttle))}updateExecutionStats(e){const t=this.state.executionStats;t.averageTime=(t.averageTime*t.totalExecuted+e)/(t.totalExecuted+1)}updateMetrics(){this.metrics.queueLength=this.state.queue.actions.length,this.metrics.errorRate=this.state.executionStats.errors.length/Math.max(this.state.executionStats.totalExecuted,1)*100}emit(e,t){const i=this.eventCallbacks.get(e);i&&i.forEach(s=>s(t))}addEventListener(e,t){this.eventCallbacks.has(e)||this.eventCallbacks.set(e,[]),this.eventCallbacks.get(e).push(t)}removeEventListener(e,t){const i=this.eventCallbacks.get(e);if(i){const s=i.indexOf(t);s>-1&&i.splice(s,1)}}getState(){return{...this.state}}getConfig(){return{...this.config}}getMetrics(){return{...this.metrics}}setConfig(e){Object.assign(this.config,e)}updateSettings(e){Object.assign(this.state.settings,e)}reset(){this.stop(),this.clearQueue(),this.state=this.createDefaultState(),this.metrics=this.createDefaultMetrics()}dispose(){this.stop(),this.eventCallbacks.clear()}}class ts{constructor(){j(this,"interactionEngine");j(this,"automationEngine");j(this,"state");j(this,"eventSubscribers");j(this,"eventQueue");j(this,"syncInterval");this.interactionEngine=new Bt,this.automationEngine=new qt,this.state={isActive:!0,lastCommand:null,commandHistory:[],syncStatus:"idle"},this.eventSubscribers=new Map,this.eventQueue=[],this.syncInterval=null,this.setupEngineListeners(),this.startSync()}setupEngineListeners(){this.automationEngine.addEventListener("moveRequested",e=>{this.executeCommand({type:"input",action:"moveTo",data:{target:e}})}),this.automationEngine.addEventListener("clickRequested",e=>{this.executeCommand({type:"input",action:"clickAt",data:{target:e}})}),this.automationEngine.addEventListener("keyRequested",e=>{this.executeCommand({type:"input",action:"keyPress",data:{key:e}})})}executeCommand(e){const t={...e,timestamp:Date.now()};switch(this.state.lastCommand=t,this.state.commandHistory.push(t),this.emitEvent({type:"sync",event:"commandExecuted",data:t,timestamp:Date.now()}),e.type){case"input":this.handleInputCommand(e);break;case"automation":this.handleAutomationCommand(e);break}}handleInputCommand(e){const{action:t,data:i}=e;switch(t){case"updateKeyboard":this.interactionEngine.updateKeyboard(i);break;case"updateMouse":this.interactionEngine.updateMouse(i);break;case"updateGamepad":this.interactionEngine.updateGamepad(i);break;case"updateTouch":this.interactionEngine.updateTouch(i);break;case"setConfig":this.interactionEngine.setConfig(i);break;case"moveTo":this.emitEvent({type:"input",event:"moveToRequested",data:i,timestamp:Date.now()});break;case"clickAt":this.emitEvent({type:"input",event:"clickAtRequested",data:i,timestamp:Date.now()});break;case"keyPress":this.emitEvent({type:"input",event:"keyPressRequested",data:i,timestamp:Date.now()});break}}handleAutomationCommand(e){const{action:t,data:i}=e;switch(t){case"addAction":this.automationEngine.addAction(i);break;case"removeAction":this.automationEngine.removeAction(i);break;case"start":this.automationEngine.start();break;case"pause":this.automationEngine.pause();break;case"resume":this.automationEngine.resume();break;case"stop":this.automationEngine.stop();break;case"clearQueue":this.automationEngine.clearQueue();break;case"updateSettings":this.automationEngine.updateSettings(i);break}}snapshot(){return{interaction:{state:this.interactionEngine.getState(),config:this.interactionEngine.getConfig(),metrics:this.interactionEngine.getMetrics()},automation:{state:this.automationEngine.getState(),config:this.automationEngine.getConfig(),metrics:this.automationEngine.getMetrics()},bridge:{...this.state}}}subscribe(e,t){this.eventSubscribers.has(e)||this.eventSubscribers.set(e,[]),this.eventSubscribers.get(e).push(t)}unsubscribe(e,t){const i=this.eventSubscribers.get(e);if(i){const s=i.indexOf(t);s>-1&&i.splice(s,1)}}emitEvent(e){this.eventQueue.push(e);const t=this.eventSubscribers.get(e.event);t&&t.forEach(s=>s(e));const i=this.eventSubscribers.get("*");i&&i.forEach(s=>s(e))}startSync(){this.syncInterval=window.setInterval(()=>{this.state.syncStatus="syncing",this.processEventQueue(),this.updateMetrics(),this.state.syncStatus="idle"},16)}processEventQueue(){const t=this.eventQueue.splice(0,10);t.length>0&&this.emitEvent({type:"sync",event:"batchProcessed",data:{count:t.length},timestamp:Date.now()})}updateMetrics(){const e=this.interactionEngine.getMetrics(),t=this.automationEngine.getMetrics();this.emitEvent({type:"sync",event:"metricsUpdated",data:{interaction:e,automation:t},timestamp:Date.now()})}getInteractionEngine(){return this.interactionEngine}getAutomationEngine(){return this.automationEngine}reset(){this.interactionEngine.reset(),this.automationEngine.reset(),this.state.commandHistory=[],this.state.lastCommand=null,this.eventQueue=[]}dispose(){this.syncInterval&&(clearInterval(this.syncInterval),this.syncInterval=null),this.interactionEngine.dispose(),this.automationEngine.dispose(),this.eventSubscribers.clear(),this.eventQueue=[]}}function ns({value:n,name:e,gamePadButtonStyle:t}){const[i,s]=h.useState(!1),{pushKey:a}=he(),o=()=>{a(n,!0),s(!0)},c=()=>{a(n,!1),s(!1)};return r.jsx("button",{className:`pad-button ${i?"is-clicked":""}`,onMouseDown:o,onMouseUp:c,onMouseLeave:c,onContextMenu:u=>{u.preventDefault(),c()},onPointerDown:o,onPointerUp:c,style:t,children:e})}const is={on:!0};function ss(n){var c;const{gamePadStyle:e,gamePadButtonStyle:t,label:i}=n,s=C(u=>{var l;return(l=u.interaction)==null?void 0:l.keyboard}),{mode:a}=C();he();const o=Object.keys(s||{}).map(u=>{const l=(i==null?void 0:i[u])||u;return u==="forward"||u==="backward"||u==="leftward"||u==="rightward"?{key:u,name:l,type:"direction",active:(s==null?void 0:s[u])||!1}:{key:u,name:l,type:"action",active:(s==null?void 0:s[u])||!1}}).filter(Boolean);return r.jsx("div",{className:"gamepad-container",style:{...e,display:(c=a==null?void 0:a.gamepad)!=null&&c.on?"flex":"none"},children:o.map(u=>r.jsx(ns,{name:u.name,type:u.type,active:u.active,style:t},u.key))})}const rs=h.memo(()=>r.jsxs("group",{children:[r.jsxs("mesh",{children:[r.jsx("sphereGeometry",{args:[.2,16,16]}),r.jsx("meshStandardMaterial",{color:"#00ff88",emissive:"#00ff88",emissiveIntensity:.5,transparent:!0,opacity:.9})]}),r.jsxs("mesh",{rotation:[Math.PI/2,0,0],children:[r.jsx("ringGeometry",{args:[.3,.5,8]}),r.jsx("meshStandardMaterial",{color:"#00ff88",transparent:!0,opacity:.6,side:y.DoubleSide})]})]})),as=h.memo(({points:n,color:e})=>n.length<2?null:r.jsx(L.Line,{points:n,color:e,lineWidth:2,dashed:!1}));function os(){var l;const n=C(d=>d.interaction),e=C(d=>d.automation),t=((l=n==null?void 0:n.mouse)==null?void 0:l.position)||new y.Vector2,i=(e==null?void 0:e.queue)||{actions:[],currentIndex:0},s=i.actions||[],a=i.currentIndex||0,o=new y.Vector3(t.x,.5,t.y),c=s.map(d=>d.type==="move"&&d.target?new y.Vector3(d.target.x,d.target.y,d.target.z):o).filter(Boolean),u=[o,...c];return r.jsxs("group",{children:[r.jsx("group",{position:[t.x,.5,t.y],children:r.jsx(rs,{})}),u.length>1&&r.jsx(as,{points:u,color:a>=0?"#00ff88":"#ffaa00"}),s.map((d,m)=>{if(d.type==="move"&&d.target){const p=m===a,M=m<a;return r.jsx("group",{position:[d.target.x,d.target.y,d.target.z],children:r.jsxs("mesh",{children:[r.jsx("sphereGeometry",{args:[.1,8,8]}),r.jsx("meshStandardMaterial",{color:M?"#888":p?"#ff4444":"#ffaa00",transparent:!0,opacity:M?.3:.8})]})},`action-${m}`)}return null})]})}function Ht({children:n,...e}){return he(),r.jsx(Ut,{props:{children:n,...e}})}class cs{constructor(e=10){j(this,"cellSize");j(this,"cells",new Map);this.cellSize=e}getCellKey(e,t){const i=Math.floor(e/this.cellSize),s=Math.floor(t/this.cellSize);return`${i},${s}`}addObject(e,t){const i=this.getCellKey(t.x,t.z);this.cells.has(i)||this.cells.set(i,new Set),this.cells.get(i).add(e)}removeObject(e,t){const i=this.getCellKey(t.x,t.z),s=this.cells.get(i);s&&(s.delete(e),s.size===0&&this.cells.delete(i))}getNearbyObjects(e,t=1){const i=new Set,s=Math.ceil(t/this.cellSize),a=Math.floor(e.x/this.cellSize),o=Math.floor(e.z/this.cellSize);for(let c=a-s;c<=a+s;c++)for(let u=o-s;u<=o+s;u++){const l=`${c},${u}`,d=this.cells.get(l);d&&d.forEach(m=>i.add(m))}return Array.from(i)}clear(){this.cells.clear()}}class Wt{constructor(){j(this,"objects",new Map);j(this,"interactionEvents",[]);j(this,"spatial",new cs(10))}addObject(e){this.objects.set(e.id,e),this.spatial.addObject(e.id,e.position)}removeObject(e){var t;return this.spatial.removeObject(e,(t=this.objects.get(e))==null?void 0:t.position),this.objects.delete(e)}getObject(e){return this.objects.get(e)}getAllObjects(){return Array.from(this.objects.values())}getObjectsByType(e){return this.getAllObjects().filter(t=>t.type===e)}updateObject(e,t){const i=this.objects.get(e);return i?(Object.assign(i,t),this.spatial.removeObject(e,i.position),this.spatial.addObject(e,i.position),!0):!1}getObjectsInRadius(e,t){return this.spatial.getNearbyObjects(e,t).map(s=>this.objects.get(s)).filter(s=>s!==void 0)}checkCollisions(e){const t=this.objects.get(e);return!t||!t.boundingBox?[]:this.spatial.getNearbyObjects(t.position,t.boundingBox.max.distanceTo(t.boundingBox.min)).map(s=>this.objects.get(s)).filter(s=>s.id!==e&&s.boundingBox&&t.boundingBox.intersectsBox(s.boundingBox))}processInteraction(e){this.interactionEvents.push(e),this.interactionEvents.length>1e3&&(this.interactionEvents=this.interactionEvents.slice(-500))}getRecentEvents(e=1e3){const t=Date.now();return this.interactionEvents.filter(i=>t-i.timestamp<=e)}raycast(e,t,i=100){const s=new y.Raycaster(e,t,0,i),a=this.spatial.getNearbyObjects(e,i);for(const o of a){const c=this.objects.get(o);if(c&&c.boundingBox){const u=s.ray.intersectBox(c.boundingBox,new y.Vector3);if(u)return{object:c,distance:e.distanceTo(u),point:u}}}return null}cleanup(){this.objects.clear(),this.interactionEvents.length=0,this.spatial.clear()}}class $t{constructor(){j(this,"engine");j(this,"state");j(this,"stateUpdateCallback");this.engine=new Wt,this.state={objects:[],interactionMode:"view",showDebugInfo:!1,events:[]}}setStateUpdateCallback(e){this.stateUpdateCallback=e}addObject(e){const t=this.generateId(),i={...e,id:t};return this.engine.addObject(i),this.updateState(),t}removeObject(e){const t=this.engine.removeObject(e);return t&&(this.state.selectedObjectId===e&&(this.state.selectedObjectId=void 0),this.updateState()),t}updateObject(e,t){const i=this.engine.updateObject(e,t);return i&&this.updateState(),i}selectObject(e){this.state.selectedObjectId=e,this.updateState()}setInteractionMode(e){this.state.interactionMode=e,this.updateState()}toggleDebugInfo(){this.state.showDebugInfo=!this.state.showDebugInfo,this.updateState()}interact(e,t){const i=this.engine.getObject(e);if(!i||!i.canInteract)return;const s={type:"interact",objectId:e,position:i.position.clone(),timestamp:Date.now()};this.engine.processInteraction(s),this.updateState()}raycast(e,t){const i=this.engine.raycast(e,t);return(i==null?void 0:i.object)||null}getObjectsInRadius(e,t){return this.engine.getObjectsInRadius(e,t)}getObjectsByType(e){return this.engine.getObjectsByType(e)}getState(){return{...this.state}}cleanup(){this.engine.cleanup(),this.state={objects:[],interactionMode:"view",showDebugInfo:!1,events:[]},this.updateState()}updateState(){this.state.objects=this.engine.getAllObjects(),this.state.events=this.engine.getRecentEvents(),this.stateUpdateCallback&&this.stateUpdateCallback({...this.state})}generateId(){return`world_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}}const Q=new $t,ls=(n,e)=>(Q.setStateUpdateCallback(t=>{n({objects:t.objects,selectedObjectId:t.selectedObjectId,interactionMode:t.interactionMode,showDebugInfo:t.showDebugInfo,events:t.events})}),{objects:[],selectedObjectId:void 0,interactionMode:"view",showDebugInfo:!1,events:[],loading:!1,error:void 0,addObject:t=>{n({loading:!0,error:void 0});try{const i=Q.addObject(t);return n({loading:!1}),i}catch(i){return n({loading:!1,error:i instanceof Error?i.message:"Unknown error"}),""}},removeObject:t=>{n({loading:!0,error:void 0});try{const i=Q.removeObject(t);return n({loading:!1}),i}catch(i){return n({loading:!1,error:i instanceof Error?i.message:"Unknown error"}),!1}},updateObject:(t,i)=>{n({loading:!0,error:void 0});try{const s=Q.updateObject(t,i);return n({loading:!1}),s}catch(s){return n({loading:!1,error:s instanceof Error?s.message:"Unknown error"}),!1}},selectObject:t=>{Q.selectObject(t)},setInteractionMode:t=>{Q.setInteractionMode(t)},toggleDebugInfo:()=>{Q.toggleDebugInfo()},setLoading:t=>{n({loading:t})},setError:t=>{n({error:t})},clearEvents:()=>{n({events:[]})}});function Kt({object:n,selected:e=!1,onSelect:t,showDebugInfo:i=!1}){return r.jsxs("group",{position:[n.position.x,n.position.y,n.position.z],rotation:[n.rotation.x,n.rotation.y,n.rotation.z],scale:[n.scale.x,n.scale.y,n.scale.z],onClick:()=>t==null?void 0:t(n.id),children:[r.jsxs("mesh",{children:[r.jsx("boxGeometry",{args:[2,1,4]}),r.jsx("meshStandardMaterial",{color:e?"#ff4444":"#4488ff",wireframe:i})]}),r.jsxs("mesh",{position:[0,.5,1.5],children:[r.jsx("boxGeometry",{args:[1.8,.8,.5]}),r.jsx("meshStandardMaterial",{color:e?"#ff2222":"#3366dd",wireframe:i})]}),r.jsxs("mesh",{position:[-.8,-.3,1],children:[r.jsx("cylinderGeometry",{args:[.3,.3,.2,8]}),r.jsx("meshStandardMaterial",{color:"#333333"})]}),r.jsxs("mesh",{position:[.8,-.3,1],children:[r.jsx("cylinderGeometry",{args:[.3,.3,.2,8]}),r.jsx("meshStandardMaterial",{color:"#333333"})]}),r.jsxs("mesh",{position:[-.8,-.3,-1],children:[r.jsx("cylinderGeometry",{args:[.3,.3,.2,8]}),r.jsx("meshStandardMaterial",{color:"#333333"})]}),r.jsxs("mesh",{position:[.8,-.3,-1],children:[r.jsx("cylinderGeometry",{args:[.3,.3,.2,8]}),r.jsx("meshStandardMaterial",{color:"#333333"})]}),i&&r.jsxs(r.Fragment,{children:[r.jsx("axesHelper",{args:[2]}),n.boundingBox&&r.jsx("boxHelper",{args:[n.boundingBox],color:"#00ff00"})]})]})}function Yt({object:n,selected:e=!1,onSelect:t,showDebugInfo:i=!1}){return r.jsxs("group",{position:[n.position.x,n.position.y,n.position.z],rotation:[n.rotation.x,n.rotation.y,n.rotation.z],scale:[n.scale.x,n.scale.y,n.scale.z],onClick:()=>t==null?void 0:t(n.id),children:[r.jsxs("mesh",{children:[r.jsx("boxGeometry",{args:[1,.8,6]}),r.jsx("meshStandardMaterial",{color:e?"#ff4444":"#88ccff",wireframe:i})]}),r.jsxs("mesh",{position:[0,0,2],children:[r.jsx("coneGeometry",{args:[.3,1,8]}),r.jsx("meshStandardMaterial",{color:e?"#ff2222":"#66aadd",wireframe:i})]}),r.jsxs("mesh",{position:[-3,0,0],rotation:[0,0,Math.PI/6],children:[r.jsx("boxGeometry",{args:[.2,.1,3]}),r.jsx("meshStandardMaterial",{color:"#666666"})]}),r.jsxs("mesh",{position:[3,0,0],rotation:[0,0,-Math.PI/6],children:[r.jsx("boxGeometry",{args:[.2,.1,3]}),r.jsx("meshStandardMaterial",{color:"#666666"})]}),r.jsxs("mesh",{position:[0,1,-2],rotation:[Math.PI/4,0,0],children:[r.jsx("boxGeometry",{args:[.1,.1,1.5]}),r.jsx("meshStandardMaterial",{color:"#444444"})]}),i&&r.jsxs(r.Fragment,{children:[r.jsx("axesHelper",{args:[3]}),n.boundingBox&&r.jsx("boxHelper",{args:[n.boundingBox],color:"#00ff00"})]})]})}function Qt({object:n,selected:e=!1,onSelect:t,showDebugInfo:i=!1}){return r.jsxs("group",{position:[n.position.x,n.position.y,n.position.z],rotation:[n.rotation.x,n.rotation.y,n.rotation.z],scale:[n.scale.x,n.scale.y,n.scale.z],onClick:()=>t==null?void 0:t(n.id),children:[r.jsxs("mesh",{position:[0,.5,0],children:[r.jsx("sphereGeometry",{args:[.3,8,6]}),r.jsx("meshStandardMaterial",{color:e?"#ff4444":"#ffcc88",wireframe:i})]}),r.jsxs("mesh",{position:[0,-.2,0],children:[r.jsx("boxGeometry",{args:[.6,.8,.4]}),r.jsx("meshStandardMaterial",{color:e?"#ff2222":"#4488ff",wireframe:i})]}),r.jsxs("mesh",{position:[-.35,-.1,0],children:[r.jsx("boxGeometry",{args:[.15,.6,.15]}),r.jsx("meshStandardMaterial",{color:"#ffcc88"})]}),r.jsxs("mesh",{position:[.35,-.1,0],children:[r.jsx("boxGeometry",{args:[.15,.6,.15]}),r.jsx("meshStandardMaterial",{color:"#ffcc88"})]}),r.jsxs("mesh",{position:[-.25,-.8,0],children:[r.jsx("boxGeometry",{args:[.2,.6,.2]}),r.jsx("meshStandardMaterial",{color:"#ffcc88"})]}),r.jsxs("mesh",{position:[.25,-.8,0],children:[r.jsx("boxGeometry",{args:[.2,.6,.2]}),r.jsx("meshStandardMaterial",{color:"#ffcc88"})]}),r.jsxs("mesh",{position:[-.25,-1.3,.1],children:[r.jsx("boxGeometry",{args:[.3,.1,.4]}),r.jsx("meshStandardMaterial",{color:"#333333"})]}),r.jsxs("mesh",{position:[.25,-1.3,.1],children:[r.jsx("boxGeometry",{args:[.3,.1,.4]}),r.jsx("meshStandardMaterial",{color:"#333333"})]}),i&&r.jsxs(r.Fragment,{children:[r.jsx("axesHelper",{args:[1]}),n.boundingBox&&r.jsx("boxHelper",{args:[n.boundingBox],color:"#00ff00"})]})]})}function Xt({objects:n,selectedId:e,onSelect:t,showDebugInfo:i=!1}){return r.jsx("group",{name:"active-objects",children:n.map(s=>{const a=s.id===e;switch(s.type){case"vehicle":return r.jsx(Kt,{object:s,selected:a,onSelect:t,showDebugInfo:i},s.id);case"airplane":return r.jsx(Yt,{object:s,selected:a,onSelect:t,showDebugInfo:i},s.id);case"character":return r.jsx(Qt,{object:s,selected:a,onSelect:t,showDebugInfo:i},s.id);default:return r.jsxs("mesh",{position:[s.position.x,s.position.y,s.position.z],rotation:[s.rotation.x,s.rotation.y,s.rotation.z],scale:[s.scale.x,s.scale.y,s.scale.z],onClick:()=>t==null?void 0:t(s.id),children:[r.jsx("boxGeometry",{args:[1,1,1]}),r.jsx("meshStandardMaterial",{color:a?"#ff4444":"#4444ff",wireframe:i})]},s.id)}})})}function Jt({objects:n,selectedId:e,onSelect:t,showDebugInfo:i=!1,enableInteraction:s=!0}){return r.jsx("group",{name:"passive-objects",children:n.map(a=>{var c,u,l,d;const o=a.id===e;return r.jsxs("group",{position:[a.position.x,a.position.y,a.position.z],rotation:[a.rotation.x,a.rotation.y,a.rotation.z],scale:[a.scale.x,a.scale.y,a.scale.z],children:[r.jsxs("mesh",{onClick:()=>s&&(t==null?void 0:t(a.id)),onPointerEnter:m=>{s&&(m.stopPropagation(),document.body.style.cursor="pointer")},onPointerLeave:()=>{document.body.style.cursor="default"},children:[a.type==="building"&&r.jsx("boxGeometry",{args:[2,3,2]}),a.type==="tree"&&r.jsxs(r.Fragment,{children:[r.jsx("cylinderGeometry",{args:[.2,.3,2,8]}),r.jsxs("mesh",{position:[0,2,0],children:[r.jsx("sphereGeometry",{args:[1.5,8,6]}),r.jsx("meshStandardMaterial",{color:"#228833"})]})]}),a.type==="rock"&&r.jsx("sphereGeometry",{args:[.8,6,4]}),a.type==="item"&&r.jsx("boxGeometry",{args:[.5,.5,.5]}),r.jsx("meshStandardMaterial",{color:o?"#ff4444":((c=a.metadata)==null?void 0:c.color)||"#888888",wireframe:i,transparent:((u=a.metadata)==null?void 0:u.opacity)!==void 0,opacity:((l=a.metadata)==null?void 0:l.opacity)||1})]}),i&&r.jsxs(r.Fragment,{children:[r.jsx("axesHelper",{args:[1]}),a.boundingBox&&r.jsx("boxHelper",{args:[a.boundingBox],color:o?"#ff0000":"#00ff00"})]}),((d=a.metadata)==null?void 0:d.label)&&r.jsx("group",{position:[0,2,0],children:r.jsx("sprite",{children:r.jsx("spriteMaterial",{color:"#ffffff"})})})]},a.id)})})}function us({states:n}){var i,s;if(!n||!n.canRide&&!n.isRiding)return null;const e=((i=n.nearbyRideable)==null?void 0:i.rideMessage)??"Press R to ride";return r.jsxs("div",{className:"rideable-ui",children:[n.canRide&&!n.isRiding&&r.jsxs("div",{className:"rideable-prompt",children:[r.jsx("div",{className:"rideable-prompt__message",children:e}),r.jsx("div",{className:"rideable-prompt__key",children:"R"})]}),n.isRiding&&r.jsxs("div",{className:"rideable-controls",children:[r.jsxs("div",{className:"rideable-controls__exit",children:[r.jsx("div",{className:"rideable-controls__message",children:"Press R to exit"}),r.jsx("div",{className:"rideable-controls__key",children:"R"})]}),n.currentRideable&&r.jsx("div",{className:"rideable-controls__info",children:r.jsxs("div",{className:"rideable-info",children:[r.jsx("div",{className:"rideable-info__name",children:((s=n.currentRideable.metadata)==null?void 0:s.name)||"Vehicle"}),r.jsxs("div",{className:"rideable-info__stats",children:[r.jsxs("div",{className:"stat",children:[r.jsx("span",{className:"stat__label",children:"Speed:"}),r.jsx("span",{className:"stat__value",children:Math.round(n.currentRideable.speed||0)})]}),r.jsxs("div",{className:"stat",children:[r.jsx("span",{className:"stat__label",children:"Max:"}),r.jsx("span",{className:"stat__value",children:Math.round(n.currentRideable.maxSpeed||0)})]})]})]})})]})]})}function Zt({objects:n,onRide:e,onExit:t,showDebugInfo:i=!1}){return r.jsx("group",{name:"rideable-objects",children:n.map(s=>{const a=s.isOccupied;return r.jsxs("group",{position:[s.position.x,s.position.y,s.position.z],rotation:[s.rotation.x,s.rotation.y,s.rotation.z],scale:[s.scale.x,s.scale.y,s.scale.z],children:[r.jsxs("mesh",{onClick:()=>!a&&(e==null?void 0:e(s.id)),onPointerEnter:o=>{a||(o.stopPropagation(),document.body.style.cursor="pointer")},onPointerLeave:()=>{document.body.style.cursor="default"},children:[r.jsx("boxGeometry",{args:[2,1,4]}),r.jsx("meshStandardMaterial",{color:a?"#666666":"#4488ff",wireframe:i,transparent:!0,opacity:a?.5:1})]}),i&&r.jsxs(r.Fragment,{children:[r.jsx("axesHelper",{args:[2]}),s.boundingBox&&r.jsx("boxHelper",{args:[s.boundingBox],color:a?"#ff0000":"#00ff00"})]}),!a&&r.jsx("group",{position:[0,2,0],children:r.jsx("sprite",{scale:[2,.5,1],children:r.jsx("spriteMaterial",{color:"#ffffff",opacity:.8})})})]},s.id)})})}function ds(){const{gl:n}=U.useThree(),e=C(t=>t.setPerformance);return U.useFrame(()=>{e({render:{calls:n.info.render.calls,triangles:n.info.render.triangles,points:n.info.render.points,lines:n.info.render.lines},engine:{geometries:n.info.memory.geometries,textures:n.info.memory.textures}})}),null}function ms(){return r.jsxs("group",{children:[r.jsxs("mesh",{position:[0,1,0],children:[r.jsx("boxGeometry",{args:[2,.1,2]}),r.jsx("meshBasicMaterial",{color:"#444444"})]}),r.jsxs("mesh",{position:[0,1.1,0],children:[r.jsx("boxGeometry",{args:[1.8,.05,1.8]}),r.jsx("meshBasicMaterial",{color:"#666666"})]})]})}function en(n){var l,d,m;const e=C(p=>p.setMode),t=C(p=>p.setUrls),i=C(p=>p.setCameraOption),s=C(p=>p.world),{debug:a}=C(p=>p.mode);h.useEffect(()=>{n.mode&&e(n.mode)},[n.mode,e]),h.useEffect(()=>{if(n.urls){const p=Object.fromEntries(Object.entries(n.urls).filter(([,M])=>M!==void 0));Object.keys(p).length>0&&t(p)}},[n.urls,t]),h.useEffect(()=>{n.cameraOption&&i(n.cameraOption)},[n.cameraOption,i]);const o=((l=s==null?void 0:s.objects)==null?void 0:l.filter(p=>p.type==="active"))||[],c=((d=s==null?void 0:s.objects)==null?void 0:d.filter(p=>p.type==="passive"))||[],u=((m=s==null?void 0:s.objects)==null?void 0:m.filter(p=>p.type==="rideable"))||[];return r.jsx(h.Suspense,{fallback:r.jsx(ms,{}),children:r.jsxs("group",{name:"gaesup-world",children:[a&&r.jsx(ds,{}),n.showGrid&&r.jsx("gridHelper",{args:[100,100,"#888888","#444444"]}),n.showAxes&&r.jsx("axesHelper",{args:[10]}),r.jsx(Xt,{objects:o,selectedId:s==null?void 0:s.selectedObjectId,onSelect:s==null?void 0:s.selectObject,showDebugInfo:s==null?void 0:s.showDebugInfo}),r.jsx(Jt,{objects:c,selectedId:s==null?void 0:s.selectedObjectId,onSelect:s==null?void 0:s.selectObject,showDebugInfo:s==null?void 0:s.showDebugInfo}),r.jsx(Zt,{objects:u,showDebugInfo:s==null?void 0:s.showDebugInfo}),n.children]})})}function tn({type:n="normal",text:e,position:t,children:i,interactive:s=!0,showMinimap:a=!0}){const o=h.useRef(null),c=C(l=>l.addMinimapMarker),u=ht();return h.useEffect(()=>{if(a&&o.current&&t){const l={id:`prop-${Date.now()}`,position:q.vec3(t),type:n,label:e||"Prop"};c(l)}},[c,t,n,e,a]),r.jsxs("group",{ref:o,position:t,onClick:l=>{s&&(l.stopPropagation(),u.onClick(l))},children:[i,e&&r.jsx("group",{position:[0,2,0],children:r.jsx("sprite",{scale:[2,.5,1],children:r.jsx("spriteMaterial",{color:"#ffffff",transparent:!0,opacity:.8})})})]})}const we=200;function hs({scale:n=5,minScale:e=.5,maxScale:t=20,blockScale:i=!1,blockScaleControl:s=!1,blockRotate:a=!1,angle:o=0,minimapStyle:c,scaleStyle:u,plusMinusStyle:l,position:d="top-right",showZoom:m=!0,showCompass:p=!0,markers:M=[]}){const{canvasRef:S,scale:b,upscale:f,downscale:x,handleWheel:g,setupWheelListener:v,isReady:k}=ft({size:we,blockScale:i,blockRotate:a,angle:o});h.useEffect(()=>{if(!s)return v()},[s,v]);const R=d?`minimap--${d}`:"";return r.jsxs("div",{className:`minimap-container ${R}`,style:c,children:[r.jsxs("div",{className:"minimap-wrapper",children:[r.jsx("canvas",{ref:S,className:"minimap-canvas",width:we,height:we,onWheel:g}),p&&r.jsx("div",{className:"minimap-compass",children:r.jsx("div",{className:"compass-needle",style:{transform:`rotate(${o}deg)`},children:"↑"})}),M.map((E,w)=>r.jsx("div",{className:`minimap-marker minimap-marker--${E.type}`,style:{left:`${E.x}%`,top:`${E.y}%`,transform:"translate(-50%, -50%)"},title:E.label,children:E.icon||"●"},E.id||w))]}),m&&!s&&r.jsxs("div",{className:"minimap-controls",style:u,children:[r.jsx("button",{className:"minimap-button",onClick:f,disabled:b>=t,style:l,children:"+"}),r.jsxs("span",{className:"minimap-scale",children:[b.toFixed(1),"x"]}),r.jsx("button",{className:"minimap-button",onClick:x,disabled:b<=e,style:l,children:"-"})]})]})}function nn({id:n,position:e,size:t=[2,2,2],text:i="",type:s="normal",children:a}){const o=C(u=>u.addMinimapMarker),c=C(u=>u.removeMinimapMarker);return h.useEffect(()=>{const u=Array.isArray(e)?e:[e.x,e.y,e.z],l=Array.isArray(t)?t:[t.x,t.y,t.z];return o(n,{type:s,text:i||"",center:new y.Vector3(u[0],u[1],u[2]),size:new y.Vector3(l[0],l[1],l[2])}),()=>{c(n)}},[n,e,t,s,i,o,c]),r.jsx(r.Fragment,{children:a})}function fs({id:n,position:e,size:t,label:i,children:s}){return r.jsx(nn,{id:n,position:e,size:t,text:i,type:"ground",children:s})}function ps({id:n,position:e,emoji:t,size:i=[3,3,3],children:s}){return r.jsx(nn,{id:n,position:e,size:i,text:t,type:"special",children:s})}function gs(n=120){const[e,t]=h.useState(null),i=h.useRef([]),s=h.useRef([]),a=h.useRef(performance.now()),o=h.useRef(0),c=h.useRef(0),u=h.useCallback(()=>{const S=performance.now(),b=performance.now();for(;performance.now()-b<1;);return{mainThread:performance.now()-S,worker:0,idle:Math.max(0,16.67-(performance.now()-S))}},[]),l=h.useCallback(()=>{const S=performance;if(S.memory){const b=S.memory.usedJSHeapSize/1048576,f=S.memory.totalJSHeapSize/1048576,x=S.memory.jsHeapSizeLimit/1048576,g=(e==null?void 0:e.memory.used)||0;return b<g*.9&&c.current++,{used:Math.round(b*100)/100,total:Math.round(f*100)/100,limit:Math.round(x*100)/100,percentage:Math.round(b/x*100),gcEvents:c.current}}return{used:0,total:0,limit:0,percentage:0,gcEvents:0}},[e]),d=h.useCallback(()=>{const S=document.createElement("canvas"),b=S.getContext("webgl2")||S.getContext("webgl");if(b){const f=b.getExtension("WEBGL_debug_renderer_info"),x=b.getExtension("WEBGL_memory_info_webgl");return{vendor:f?b.getParameter(f.UNMASKED_VENDOR_WEBGL):"Unknown",renderer:f?b.getParameter(f.UNMASKED_RENDERER_WEBGL):"Unknown",memory:x?b.getParameter(x.MEMORY_INFO_DEDICATED_VIDMEM_WEBGL):void 0,textureMemory:x?b.getParameter(x.MEMORY_INFO_CURRENT_AVAILABLE_VIDMEM_WEBGL):void 0}}return{vendor:"Unknown",renderer:"Unknown"}},[]),m=h.useCallback(()=>{const S=navigator.connection;return S?{rtt:S.rtt||0,bandwidth:S.downlink||0,effectiveType:S.effectiveType||"unknown"}:{rtt:0,bandwidth:0,effectiveType:"unknown"}},[]),p=h.useCallback((S,b)=>{const f=[...S].sort((g,v)=>g-v),x=Math.ceil(b/100*f.length)-1;return f[x]||0},[]);U.useFrame(()=>{o.current++;const S=performance.now(),b=S-a.current;i.current.push(b),i.current.length>n&&i.current.shift();const f=Math.round(1e3/b);s.current.push(f),s.current.length>n&&s.current.shift(),a.current=S}),h.useEffect(()=>{const S=setInterval(()=>{if(i.current.length===0||s.current.length===0)return;const b=i.current.reduce((g,v)=>g+v,0)/i.current.length,f=s.current.reduce((g,v)=>g+v,0)/s.current.length,x={fps:{current:s.current[s.current.length-1]||0,average:Math.round(f*10)/10,min:Math.min(...s.current),max:Math.max(...s.current),history:[...s.current]},frameTime:{current:i.current[i.current.length-1]||0,average:Math.round(b*100)/100,p95:p(i.current,95),p99:p(i.current,99),history:[...i.current]},memory:l(),cpu:u(),gpu:d(),network:m()};t(x)},1e3);return()=>clearInterval(S)},[p,u,l,d,m]);const M=h.useCallback(()=>{if(!e)return;const S={metrics:e,timestamp:new Date().toISOString(),userAgent:navigator.userAgent,screen:{width:screen.width,height:screen.height,devicePixelRatio:window.devicePixelRatio}},b=new Blob([JSON.stringify(S,null,2)],{type:"application/json"}),f=URL.createObjectURL(b),x=document.createElement("a");x.href=f,x.download=`performance-metrics-${Date.now()}.json`,x.click(),URL.revokeObjectURL(f)},[e]);return{metrics:e,exportData:M}}const ys=n=>({selectedObjectIds:[],setSelectedObjectIds:e=>n({selectedObjectIds:e}),layoutConfig:null,setLayoutConfig:e=>n({layoutConfig:e}),activeNodeGraph:null,setActiveNodeGraph:e=>n({activeNodeGraph:e}),clipboard:null,setClipboard:e=>n({clipboard:e})}),ze=it(ys),xs=[{id:"world",name:"World",children:[{id:"lights",name:"Lights",children:[{id:"directional",name:"Directional Light",children:[]},{id:"ambient",name:"Ambient Light",children:[]}]},{id:"environment",name:"Environment",children:[{id:"ground",name:"Ground",children:[]},{id:"skybox",name:"Skybox",children:[]}]},{id:"actors",name:"Actors",children:[{id:"player",name:"PlayerCharacter",children:[]},{id:"npc1",name:"NPC_Guard",children:[]}]}]}],sn=({node:n,level:e,selectedIds:t,onSelect:i})=>{const[s,a]=h.useState(!0),o=t.includes(n.id),c=l=>{l.stopPropagation(),i(n.id,l.ctrlKey||l.metaKey)},u=l=>{l.stopPropagation(),a(!s)};return r.jsxs("div",{children:[r.jsxs("div",{className:`hierarchy-item ${o?"selected":""}`,style:{paddingLeft:`${12+e*16}px`},onClick:c,children:[n.children.length>0&&r.jsx("span",{className:"hierarchy-toggle",onClick:u,children:s?"▼":"▶"}),r.jsx("span",{className:"hierarchy-name",children:n.name})]}),s&&n.children.map(l=>r.jsx(sn,{node:l,level:e+1,selectedIds:t,onSelect:i},l.id))]})};function bs(){const{selectedObjectIds:n,setSelectedObjectIds:e}=ze(),t=(i,s)=>{e(a=>s?a.includes(i)?a.filter(o=>o!==i):[...a,i]:[i])};return r.jsx("div",{className:"hierarchy-panel",children:xs.map(i=>r.jsx(sn,{node:i,level:0,selectedIds:n,onSelect:t},i.id))})}const Se=({label:n,value:e})=>r.jsxs("div",{className:"prop-item",children:[r.jsx("label",{className:"prop-label",children:n}),r.jsxs("div",{className:"prop-value vector-input",children:[r.jsx("span",{children:"X"}),r.jsx("input",{type:"number",defaultValue:e.x.toFixed(2)}),r.jsx("span",{children:"Y"}),r.jsx("input",{type:"number",defaultValue:e.y.toFixed(2)}),r.jsx("span",{children:"Z"}),r.jsx("input",{type:"number",defaultValue:e.z.toFixed(2)})]})]}),ae=({label:n,value:e})=>r.jsxs("div",{className:"prop-item",children:[r.jsx("label",{className:"prop-label",children:n}),r.jsx("div",{className:"prop-value",children:r.jsx("input",{type:"number",defaultValue:e.toFixed(2)})})]}),tt={player:{transform:{position:{x:10.5,y:0,z:5.2},rotation:{x:0,y:90,z:0},scale:{x:1,y:1,z:1}},rigidbody:{mass:70,friction:.8,restitution:.1}},npc1:{transform:{position:{x:-5,y:0,z:12.8},rotation:{x:0,y:-45,z:0},scale:{x:1,y:1,z:1}},ai:{state:"Patrolling",speed:2.5}},directional:{light:{intensity:1.5,color:"#FFFFFF",castShadow:!0},transform:{position:{x:50,y:100,z:25},rotation:{x:-45,y:20,z:0},scale:{x:1,y:1,z:1}}}};function vs(){const{selectedObjectIds:n}=ze(),[e,t]=h.useState(null);return h.useEffect(()=>{const i=n[0];i&&tt[i]?t({id:i,...tt[i]}):t(null)},[n]),e?r.jsxs("div",{className:"inspector-panel",children:[r.jsxs("div",{className:"inspector-header",children:[r.jsx("h3",{children:e.id}),r.jsx("span",{className:"object-tag",children:"TAG_EXAMPLE"})]}),e.transform&&r.jsxs("div",{className:"prop-group",children:[r.jsx("h4",{className:"prop-group-title",children:"Transform"}),r.jsx(Se,{label:"Position",value:e.transform.position}),r.jsx(Se,{label:"Rotation",value:e.transform.rotation}),r.jsx(Se,{label:"Scale",value:e.transform.scale})]}),e.rigidbody&&r.jsxs("div",{className:"prop-group",children:[r.jsx("h4",{className:"prop-group-title",children:"Rigidbody"}),r.jsx(ae,{label:"Mass",value:e.rigidbody.mass}),r.jsx(ae,{label:"Friction",value:e.rigidbody.friction}),r.jsx(ae,{label:"Restitution",value:e.rigidbody.restitution})]}),e.light&&r.jsxs("div",{className:"prop-group",children:[r.jsx("h4",{className:"prop-group-title",children:"Light"}),r.jsx(ae,{label:"Intensity",value:e.light.intensity})]})]}):r.jsx("div",{className:"inspector-panel empty",children:r.jsx("span",{children:"No object selected"})})}const ws=[{id:"1",label:"Start State",position:{x:250,y:25}},{id:"2",label:"Idle State",position:{x:100,y:125}},{id:"3",label:"Moving State",position:{x:400,y:125}}],Ss=()=>{const[n]=h.useState(ws),[e,t]=h.useState(null);return r.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[r.jsx("h3",{className:"editor-title",children:"🔗 Node Editor (FSM)"}),r.jsxs("div",{className:"editor-scrollbar",style:{flex:1,overflow:"auto",padding:"8px"},children:[r.jsx("div",{className:"editor-text",style:{marginBottom:"10px",fontWeight:"bold"},children:"State Machine Nodes:"}),n.map(i=>r.jsxs("div",{onClick:()=>t(i.id),style:{padding:"8px 12px",margin:"4px 0",background:e===i.id?"rgba(0, 120, 212, 0.3)":"rgba(255, 255, 255, 0.05)",border:e===i.id?"1px solid rgba(0, 120, 212, 0.5)":"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"6px",cursor:"pointer",transition:"all 0.2s ease"},children:[r.jsx("div",{className:"editor-text",style:{fontWeight:"bold"},children:i.label}),r.jsxs("div",{className:"editor-text-small",children:["Position: (",i.position.x,", ",i.position.y,")"]})]},i.id)),r.jsxs("div",{style:{marginTop:"20px",padding:"10px",background:"rgba(0, 0, 0, 0.2)",border:"1px solid rgba(255, 255, 255, 0.1)",borderRadius:"6px"},children:[r.jsx("div",{className:"editor-text",style:{fontWeight:"bold",marginBottom:"8px"},children:"FSM Graph Preview"}),r.jsx("div",{className:"editor-text-small",style:{marginBottom:"6px"},children:"Start → Idle ↔ Moving"}),r.jsx("div",{className:"editor-text-small",style:{opacity:.7},children:"Note: React Flow integration will be added once package issues are resolved."})]})]})]})},Cs=()=>r.jsx("svg",{width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:"M4 7V17C4 18.1046 4.89543 19 6 19H18C19.1046 19 20 18.1046 20 17V7M4 7C4 5.89543 4.89543 5 6 5H9.58579C9.851 5 10.1054 5.10536 10.2929 5.29289L11.7071 6.70711C11.8946 6.89464 12.149 7 12.4142 7H18C19.1046 7 20 7.89543 20 9V7",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),js=()=>r.jsx("svg",{width:"60",height:"60",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:r.jsx("path",{d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z",stroke:"rgba(255, 255, 255, 0.6)",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})}),Ms=[{id:"folder1",name:"Characters",type:"folder"},{id:"folder2",name:"Environments",type:"folder"},{id:"folder3",name:"Props",type:"folder"},{id:"model1",name:"Player.gltf",type:"model"},{id:"tex1",name:"Grass_d.png",type:"texture"},{id:"tex2",name:"Rock_n.png",type:"texture"},{id:"mat1",name:"Ground.mat",type:"material"}];function ks(){const[n,e]=h.useState(null);return r.jsxs("div",{className:"asset-browser-panel",children:[r.jsx("div",{className:"asset-grid editor-scrollbar",children:Ms.map(t=>r.jsxs("div",{className:`asset-item ${n===t.id?"selected":""}`,onClick:()=>e(t.id),children:[r.jsx("div",{className:"asset-preview",children:t.type==="folder"?r.jsx(Cs,{}):r.jsx(js,{})}),r.jsx("div",{className:"asset-info",children:r.jsx("div",{className:"asset-name",children:t.name})})]},t.id))}),r.jsxs("div",{className:"asset-footer",children:[r.jsx("span",{className:"asset-path",children:"Content / Characters /"}),r.jsx("div",{className:"asset-actions",children:r.jsx("button",{className:"editor-glass-button",children:"Import"})})]})]})}function Es(){const{compileFSM:n}=ze(),e=[{label:"Load Asset",action:()=>console.log("Load asset")},{label:"Save Scene",action:()=>console.log("Save scene")},{label:"Build Project",action:()=>console.log("Build project")},{label:"Export Package",action:()=>console.log("Export package")}];return r.jsxs("div",{className:"quick-actions-panel",children:[r.jsx("h3",{className:"editor-title",children:"Quick Actions"}),r.jsx("div",{className:"actions-grid",children:e.map((t,i)=>r.jsx("button",{className:"editor-glass-button action-button",onClick:t.action,children:t.label},i))})]})}function As(){const[n,e]=h.useState("Controller"),t=()=>{switch(n){case"Controller":return r.jsx(Ne,{});case"Presets":return r.jsx(Te,{});case"Debug":return r.jsx(Ie,{});default:return null}};return r.jsxs("div",{className:"tabbed-panel",children:[r.jsxs("div",{className:"panel-tabs",children:[r.jsx("button",{className:`panel-tab ${n==="Controller"?"active":""}`,onClick:()=>e("Controller"),children:"Controller"}),r.jsx("button",{className:`panel-tab ${n==="Presets"?"active":""}`,onClick:()=>e("Presets"),children:"Presets"}),r.jsx("button",{className:`panel-tab ${n==="Debug"?"active":""}`,onClick:()=>e("Debug"),children:"Debug"})]}),r.jsx("div",{className:"panel-tab-content",children:t()})]})}function Rs(){const[n,e]=h.useState("Player"),t=()=>{switch(n){case"Player":return r.jsx("div",{className:"panel-content-wrapper",children:r.jsx(Vt,{})});case"Controller":return r.jsx("div",{className:"panel-content-wrapper",children:r.jsx(zt,{})});case"Debug":return r.jsx("div",{className:"panel-content-wrapper",children:r.jsx(Gt,{})});default:return null}};return r.jsxs("div",{className:"tabbed-panel",children:[r.jsxs("div",{className:"panel-tabs",children:[r.jsx("button",{className:`panel-tab ${n==="Player"?"active":""}`,onClick:()=>e("Player"),children:"Player"}),r.jsx("button",{className:`panel-tab ${n==="Controller"?"active":""}`,onClick:()=>e("Controller"),children:"Controller"}),r.jsx("button",{className:`panel-tab ${n==="Debug"?"active":""}`,onClick:()=>e("Debug"),children:"Debug"})]}),r.jsx("div",{className:"panel-tab-content",children:t()})]})}function Ns(){const[n,e]=h.useState("Controller"),t=()=>{switch(n){case"Controller":return r.jsx("div",{className:"panel-content-wrapper",children:r.jsx(Oe,{})});case"Debug":return r.jsx("div",{className:"panel-content-wrapper",children:r.jsx(De,{})});default:return null}};return r.jsxs("div",{className:"tabbed-panel",children:[r.jsxs("div",{className:"panel-tabs",children:[r.jsx("button",{className:`panel-tab ${n==="Controller"?"active":""}`,onClick:()=>e("Controller"),children:"Controller"}),r.jsx("button",{className:`panel-tab ${n==="Debug"?"active":""}`,onClick:()=>e("Debug"),children:"Debug"})]}),r.jsx("div",{className:"panel-tab-content",children:t()})]})}const nt=({data:n,color:e,max:t})=>{const s=n.filter(c=>isFinite(c));if(s.length<2)return null;const a=Math.max(1,t),o=s.map((c,u)=>{const l=u/(s.length-1)*100,d=40-c/a*40;return`${u===0?"M":"L"}${l.toFixed(2)},${d.toFixed(2)}`}).join(" ");return r.jsx("div",{className:"perf-chart",children:r.jsx("svg",{width:"100%",height:40,preserveAspectRatio:"none",viewBox:"0 0 100 40",children:r.jsx("path",{d:o,fill:"none",stroke:e,strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round"})})})};function Is(){const n=C(S=>S.performance),[e,t]=h.useState({current:0,min:1/0,max:0,avg:0,history:Array(50).fill(0)}),[i,s]=h.useState({used:0,limit:0,history:Array(50).fill(0)}),[a,o]=h.useState(0),c=h.useRef(0),u=h.useRef(0),l=h.useRef(0),d=h.useRef([]),m=h.useRef();h.useEffect(()=>{const S=window.performance.now();c.current=S,u.current=S;const b=f=>{const x=f-u.current;u.current=f,d.current.push(x),d.current.length>30&&d.current.shift();const g=d.current.reduce((v,k)=>v+k,0)/d.current.length;if(o(g),l.current++,f-c.current>=500){const v=l.current*1e3/(f-c.current);t(R=>{const E=[...R.history.slice(1),v],w=Math.min(R.min===1/0?v:R.min,v),O=Math.max(R.max,v),P=E.reduce((z,F)=>z+F,0)/E.length;return{current:v,min:w,max:O,avg:P,history:E}});const k=window.performance.memory;k&&s(R=>{const E=Math.round(k.usedJSHeapSize/1048576),w=Math.round(k.jsHeapSizeLimit/1048576),O=[...R.history.slice(1),E];return{used:E,limit:w,history:O}}),c.current=f,l.current=0}m.current=requestAnimationFrame(b)};return m.current=requestAnimationFrame(b),()=>{m.current&&cancelAnimationFrame(m.current)}},[]);const p=S=>S>=55?"#4ade80":S>=30?"#facc15":"#f87171",M=(S,b)=>{const f=b>0?S/b*100:0;return f<60?"#4ade80":f<80?"#facc15":"#f87171"};return r.jsxs("div",{className:"perf-panel",children:[r.jsxs("div",{className:"perf-stat-group",children:[r.jsxs("div",{className:"perf-header",children:[r.jsx("h4",{className:"perf-title",children:"Frame Rate (FPS)"}),r.jsx("span",{className:"perf-current",style:{color:p(e.current)},children:e.current.toFixed(0)})]}),r.jsxs("div",{className:"perf-details-grid",children:[r.jsxs("div",{children:[r.jsx("span",{className:"perf-label",children:"Avg"}),e.avg.toFixed(1)]}),r.jsxs("div",{children:[r.jsx("span",{className:"perf-label",children:"Min"}),isFinite(e.min)?e.min.toFixed(1):"..."]}),r.jsxs("div",{children:[r.jsx("span",{className:"perf-label",children:"Max"}),e.max.toFixed(1)]}),r.jsxs("div",{children:[r.jsx("span",{className:"perf-label",children:"Time"}),a.toFixed(1)," ms"]})]}),r.jsx(nt,{data:e.history,color:p(e.current),max:90})]}),r.jsxs("div",{className:"perf-stat-group",children:[r.jsxs("div",{className:"perf-header",children:[r.jsx("h4",{className:"perf-title",children:"Memory (MB)"}),r.jsx("span",{className:"perf-current",style:{color:M(i.used,i.limit)},children:i.used})]}),r.jsxs("div",{className:"perf-details-grid",children:[r.jsxs("div",{children:[r.jsx("span",{className:"perf-label",children:"Limit"}),i.limit]}),r.jsxs("div",{children:[r.jsx("span",{className:"perf-label",children:"Usage"}),i.limit>0?(i.used/i.limit*100).toFixed(0):0,"%"]})]}),r.jsx(nt,{data:i.history,color:M(i.used,i.limit),max:i.limit||1})]}),r.jsxs("div",{className:"perf-stat-group",children:[r.jsx("div",{className:"perf-header",children:r.jsx("h4",{className:"perf-title",children:"Rendering"})}),r.jsxs("div",{className:"perf-details-grid",children:[r.jsxs("div",{children:[r.jsx("span",{className:"perf-label",children:"Draws"}),n.render.calls]}),r.jsxs("div",{children:[r.jsx("span",{className:"perf-label",children:"Tris"}),(n.render.triangles/1e3).toFixed(1),"K"]}),r.jsxs("div",{children:[r.jsx("span",{className:"perf-label",children:"Geometries"}),n.engine.geometries]}),r.jsxs("div",{children:[r.jsx("span",{className:"perf-label",children:"Textures"}),n.engine.textures]})]})]})]})}const Ts=()=>r.jsx("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:r.jsx("line",{x1:"5",y1:"12",x2:"19",y2:"12"})}),Os=()=>r.jsxs("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),r.jsx("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]}),ce=({children:n,title:e,initialWidth:t=280,initialHeight:i=400,minWidth:s=200,minHeight:a=150,maxWidth:o=600,maxHeight:c=800,resizeHandles:u=["right"],className:l="",style:d={},onClose:m,onMinimize:p,draggable:M=!0,icon:S,onDrop:b})=>{const[f,x]=h.useState({width:t,height:i}),[g,v]=h.useState({x:0,y:0}),[k,R]=h.useState(!1),[E,w]=h.useState(!1),[O,P]=h.useState(""),[z,F]=h.useState({x:0,y:0}),V=h.useRef(null),Ve=h.useRef(null),J=h.useCallback(T=>G=>{G.preventDefault(),R(!0),P(T)},[]),N=h.useCallback(T=>{if(V.current)if(k){const G=V.current.getBoundingClientRect();let $=f.width,K=f.height;O.includes("right")&&($=Math.min(o,Math.max(s,T.clientX-G.left))),O.includes("bottom")&&(K=Math.min(c,Math.max(a,T.clientY-G.top))),x({width:$,height:K})}else E&&v({x:T.clientX-z.x,y:T.clientY-z.y})},[k,E,O,f,s,o,a,c,z]),B=h.useCallback(()=>{E&&b&&b(g.x,g.y),R(!1),w(!1),P("")},[E,b,g]),Z=h.useCallback(T=>{var $;if(!M||k)return;T.preventDefault(),w(!0);const G=($=V.current)==null?void 0:$.getBoundingClientRect();G&&F({x:T.clientX-G.left,y:T.clientY-G.top})},[M,k]);return h.useEffect(()=>{if(k||E)return document.addEventListener("mousemove",N),document.addEventListener("mouseup",B),()=>{document.removeEventListener("mousemove",N),document.removeEventListener("mouseup",B)}},[k,E,N,B]),r.jsxs("div",{ref:V,className:`rp-panel ${l} ${E?"dragging":""}`,style:{width:`${f.width}px`,height:`${f.height}px`,...E?{position:"fixed",left:`${g.x}px`,top:`${g.y}px`,zIndex:10003}:{},...d},children:[r.jsxs("div",{ref:Ve,className:"rp-header",onMouseDown:Z,children:[r.jsx("h3",{className:"rp-title",children:e}),r.jsxs("div",{className:"rp-controls",children:[p&&r.jsx("button",{className:"rp-btn",onClick:p,title:"Minimize",children:r.jsx(Ts,{})}),m&&r.jsx("button",{className:"rp-btn",onClick:m,title:"Close",children:r.jsx(Os,{})})]})]}),r.jsx("div",{className:"rp-content",children:n}),u.map(T=>r.jsx("div",{className:`rp-resize-handle handle-${T}`,onMouseDown:J(T.replace("corner","right bottom"))},T))]})},rn=({children:n})=>{const[e,t]=h.useState(["hierarchy","performance"]),[i,s]=h.useState([]),[a,o]=h.useState([]),c=[{id:"hierarchy",title:"Hierarchy",component:r.jsx(bs,{}),defaultSide:"left"},{id:"inspector",title:"Inspector",component:r.jsx(vs,{}),defaultSide:"right"},{id:"camera",title:"Camera",component:r.jsx(As,{}),defaultSide:"right"},{id:"animation",title:"Animation",component:r.jsx(Rs,{}),defaultSide:"left"},{id:"motion",title:"Motion",component:r.jsx(Ns,{}),defaultSide:"right"},{id:"performance",title:"Performance",component:r.jsx(Is,{}),defaultSide:"right"},{id:"nodes",title:"Node Editor",component:r.jsx(Ss,{}),defaultSide:"floating"},{id:"assets",title:"Assets",component:r.jsx(ks,{}),defaultSide:"right"},{id:"actions",title:"Quick Actions",component:r.jsx(Es,{}),defaultSide:"right"}],u=f=>{t(x=>x.includes(f)?x.filter(g=>g!==f):[...x,f]),o(x=>x.filter(g=>g!==f))},l=f=>{t(x=>x.filter(g=>g!==f)),s(x=>x.filter(g=>g.id!==f)),o(x=>x.filter(g=>g!==f))},d=f=>{o(x=>[...x,f]),t(x=>x.filter(g=>g!==f)),s(x=>x.filter(g=>g.id!==f))},m=f=>{o(x=>x.filter(g=>g!==f)),t(x=>[...x,f])},p=(f,x,g)=>{const v=i.find(k=>k.id===f);s(v?k=>k.map(R=>R.id===f?{...R,x,y:g}:R):k=>[...k,{id:f,x,y:g,width:300,height:400}])},M=()=>c.filter(f=>e.includes(f.id)&&f.defaultSide==="left"&&!i.some(x=>x.id===f.id)),S=()=>c.filter(f=>e.includes(f.id)&&f.defaultSide==="right"&&!i.some(x=>x.id===f.id)),b=()=>i.filter(f=>e.includes(f.id));return r.jsxs("div",{className:"editor-root",children:[r.jsx("div",{className:"editor-panel-bar",children:c.map(f=>r.jsx("button",{onClick:()=>u(f.id),className:`editor-panel-toggle ${e.includes(f.id)?"active":""}`,title:f.title,children:f.title},f.id))}),M().length>0&&r.jsx("div",{className:"editor-left-stack",children:M().map((f,x)=>r.jsx(ce,{title:f.title,initialWidth:280,initialHeight:Math.max(300,(window.innerHeight-120)/M().length),minWidth:200,maxWidth:500,resizeHandles:["right"],className:"editor-glass-panel",style:{marginBottom:x<M().length-1?"8px":"0"},onClose:()=>l(f.id),onMinimize:()=>d(f.id),onDrop:(g,v)=>p(f.id,g,v),children:f.component},f.id))}),S().length>0&&r.jsx("div",{className:"editor-right-stack",children:S().map((f,x)=>r.jsx(ce,{title:f.title,initialWidth:320,initialHeight:Math.max(300,(window.innerHeight-120)/S().length),minWidth:200,maxWidth:500,resizeHandles:["corner"],className:"editor-glass-panel",style:{marginBottom:x<S().length-1?"8px":"0"},onClose:()=>l(f.id),onMinimize:()=>d(f.id),onDrop:(g,v)=>p(f.id,g,v),children:f.component},f.id))}),b().map(f=>{const x=c.find(g=>g.id===f.id);return x?r.jsx(ce,{title:x.title,initialWidth:f.width,initialHeight:f.height,minWidth:200,maxWidth:800,resizeHandles:["right","bottom","corner"],className:"editor-glass-panel",style:{position:"fixed",left:`${f.x}px`,top:`${f.y}px`,zIndex:1001},onClose:()=>l(x.id),onMinimize:()=>d(x.id),onDrop:(g,v)=>p(x.id,g,v),children:x.component},f.id):null}),a.length>0&&r.jsx("div",{className:"editor-minimized-dock",children:a.map(f=>{const x=c.find(g=>g.id===f);return x?r.jsx("button",{onClick:()=>m(f),className:"editor-minimized-item",title:`Restore ${x.title}`,children:x.title},f):null})}),n]})},Ds=({children:n,className:e="",style:t={}})=>r.jsx("div",{className:`gaesup-editor ${e}`,style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",pointerEvents:"none",zIndex:1e3,...t},children:r.jsx(rn,{children:n})});exports.ActiveObjects=Xt;exports.Airplane=Yt;exports.AnimationBridge=mt;exports.AnimationController=zt;exports.AnimationDebugPanel=Gt;exports.AnimationEngine=dt;exports.AnimationPlayer=Vt;exports.AutomationEngine=qt;exports.BaseCameraEngine=Rt;exports.BaseController=W;exports.Camera=Ot;exports.CameraController=Ne;exports.CameraDebugPanel=Ie;exports.CameraDebugger=gi;exports.CameraEngine=Nt;exports.CameraPresets=Te;exports.CameraUI=ki;exports.Character=Qt;exports.ChaseController=jt;exports.Clicker=os;exports.ControllerWrapper=Ht;exports.Editor=Ds;exports.EditorLayout=rn;exports.Elr=at;exports.EntityWrapper=Ut;exports.FirstPersonController=Ct;exports.FixedController=At;exports.GaeSupProps=tn;exports.GaesupController=Ht;exports.GaesupErrorBoundary=Oi;exports.GaesupWorld=en;exports.GamePad=ss;exports.InteractionBridge=ts;exports.InteractionEngine=Bt;exports.IsometricController=kt;exports.MemoizationManager=ue;exports.MiniMap=hs;exports.MinimapObject=ps;exports.MinimapPlatform=fs;exports.MotionBridge=Li;exports.MotionController=Oe;exports.MotionDebugPanel=De;exports.MotionEngine=_t;exports.MotionUI=Bi;exports.PassiveObjects=Jt;exports.PhysicsEngine=Ft;exports.Qt=Pn;exports.ResizablePanel=ce;exports.RideableObjects=Zt;exports.RideableUI=us;exports.SideScrollController=Et;exports.Teleport=qi;exports.ThirdPersonController=St;exports.TopDownController=Mt;exports.V3=H;exports.V30=zn;exports.V31=Vn;exports.Vehicle=Kt;exports.WorldBridge=$t;exports.WorldContainer=en;exports.WorldEngine=Wt;exports.WorldProps=tn;exports.cache=hi;exports.calcAngleByVector=rt;exports.calcNorm=st;exports.clearTrigCache=vt;exports.convertElr=Dn;exports.convertN3=Tn;exports.convertV3=On;exports.createAnimationController=Qn;exports.createAnimationSlice=lt;exports.createCameraOptionSlice=ot;exports.createCameraSlice=ct;exports.createInteractionSlice=ut;exports.createVectorCache=bt;exports.createWorldSlice=ls;exports.gamepadDefault=is;exports.getCachedTrig=Me;exports.getGlobalAnimationBridge=Re;exports.getPooledVector=me;exports.getTag=di;exports.getTrigCacheStats=wt;exports.isEqualTag=mi;exports.isValidOrOne=In;exports.isValidOrZero=Nn;exports.isVectorNonZero=Rn;exports.normalizeAngle=ke;exports.releaseVector=An;exports.rideableDefault=yt;exports.shouldUpdate=Ee;exports.shouldUpdateVector3=ui;exports.useAnimationBridge=te;exports.useAnimationPlayer=ne;exports.useCamera=Tt;exports.useCameraBridge=It;exports.useClicker=ht;exports.useCursorState=ci;exports.useGaesupContext=oi;exports.useGaesupController=Xn;exports.useGaesupStore=C;exports.useKeyboard=he;exports.useMinimap=ft;exports.usePerformanceMonitor=gs;exports.usePhysics=Lt;exports.useRideable=ai;exports.useTeleport=xt;
