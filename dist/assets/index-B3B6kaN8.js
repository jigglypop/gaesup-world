var We=Object.defineProperty;var Xe=(e,t,n)=>t in e?We(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ie=(e,t,n)=>Xe(e,typeof t!="symbol"?t+"":t,n);import{R as z,r as l,j as a,a as Q,f as Ne,C as Ze}from"./three-fiber-BZljtFsf.js";import{u as ae,a as se,S as Ae,b as He,L as Ke,H as Je,G as Ye,E as Qe,T as et,c as tt}from"./three-drei-enWTNQzH.js";import{v as b,e as I,q as N,u as De,R as Ee,C as nt,P as rt}from"./three-rapier-DEjDsxOq.js";import{d as A,ar as Ie,ab as ee,M as Te,a7 as ot,R as ye,v as it}from"./three-core-Bc71Y2F5.js";import"./physics-engine-CmnDU9Yz.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var Fe={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},be=z.createContext&&z.createContext(Fe),at=["attr","size","title"];function st(e,t){if(e==null)return{};var n=ct(e,t),r,o;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function ct(e,t){if(e==null)return{};var n={};for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){if(t.indexOf(r)>=0)continue;n[r]=e[r]}return n}function Z(){return Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Z.apply(this,arguments)}function pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function H(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pe(Object(n),!0).forEach(function(r){lt(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pe(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function lt(e,t,n){return t=ut(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ut(e){var t=dt(e,"string");return typeof t=="symbol"?t:t+""}function dt(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ge(e){return e&&e.map((t,n)=>z.createElement(t.tag,H({key:n},t.attr),Ge(t.child)))}function ft(e){return t=>z.createElement(mt,Z({attr:H({},e.attr)},t),Ge(e.child))}function mt(e){var t=n=>{var{attr:r,size:o,title:i}=e,c=st(e,at),s=o||n.size||"1em",u;return n.className&&(u=n.className),e.className&&(u=(u?u+" ":"")+e.className),z.createElement("svg",Z({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,r,c,{className:u,style:H(H({color:e.color||n.color},n.style),e.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),i&&z.createElement("title",null,i),e.children)};return be!==void 0?z.createElement(be.Consumer,null,n=>t(n)):t(Fe)}function ve(e){return ft({attr:{viewBox:"0 0 384 512"},child:[{tag:"path",attr:{d:"M172.268 501.67C26.97 291.031 0 269.413 0 192 0 85.961 85.961 0 192 0s192 85.961 192 192c0 77.413-26.97 99.031-172.268 309.67-9.535 13.774-29.93 13.773-39.464 0zM192 272c44.183 0 80-35.817 80-80s-35.817-80-80-80-80 35.817-80 80 35.817 80 80 80z"},child:[]}]})(e)}function we(e,t,n){return Math.sqrt(Math.pow(e.x-t.x,2)+n+Math.pow(e.z-t.z,2))}function ht(e){const t=v(0,0,1),n=Math.acos(e.dot(t)/e.length()),r=e.cross(t),o=Math.sin(r.y)||1;return Math.PI-n*o}const v=(e=0,t=0,n=0)=>new A(e,t,n),O={activeState:{position:v(0,5,5),impulse:b(),velocity:b(),acceleration:b(),quat:N(),euler:I(),rotation:I(),dir:b(),direction:b()},mode:{},urls:{characterUrl:null,vehicleUrl:null,airplaneUrl:null,wheelUrl:null,ridingUrl:null},states:{rideableId:null,isMoving:!1,isNotMoving:!1,isOnTheGround:!1,isOnMoving:!1,isRotated:!1,isRunning:!1,isJumping:!1,enableRiding:!1,isRiderOn:!1,isLanding:!1,isFalling:!1,isRiding:!1,isPush:{forward:!1,backward:!1,leftward:!1,rightward:!1}},minimap:{props:{}},clicker:{point:v(0,0,0),angle:Math.PI/2,isOn:!1,isRun:!1},control:{forward:!1,backward:!1,leftward:!1,rightward:!1},animationState:{character:{current:"idle",default:"idle",store:{}},vehicle:{current:"idle",default:"idle",store:{}},airplane:{current:"idle",default:"idle",store:{}}},cameraOption:{offset:v(-10,-10,-10),maxDistance:-7,distance:-1,XDistance:20,YDistance:10,ZDistance:20,zoom:1,target:b(),position:b(),focus:!1},rideable:{},sizes:{},block:{camera:!1,control:!1,animation:!1,scroll:!0},clickerOption:{isRun:!0,throttle:100,autoStart:!1,track:!1,loop:!1,queue:[],line:!1}},C=l.createContext(null),k=l.createContext(null),ce=l.forwardRef(({children:e},t)=>a.jsx("group",{ref:t,userData:{intangible:!0},children:e}));function K({type:e}){const{animationState:t}=l.useContext(C),n=l.useContext(k),r=l.useCallback(()=>{let s=t[e].default;const u=t[e].store;for(const d of Object.keys(u)){const m=u[d];if(m!=null&&m.condition()){s=m.animationName||d;break}}return t[e].current!==s&&(t[e].current=s,n({type:"update",payload:{animationState:{...t,[e]:{...t[e],current:s}}}})),s},[t,e,n]),o=l.useCallback(s=>{delete t[e].store[s],n({type:"update",payload:{animationState:{...t,[e]:{...t[e],store:{...t[e].store}}}}})},[t,e,n]),i=l.useCallback(({tag:s,condition:u,action:d,animationName:m,key:f})=>{const x=t[e].store[s],h={tag:s,condition:u,action:d||(()=>{}),animationName:m||s,key:f||s};x&&x.tag===s&&x.animationName===m||(t[e].store[s]=h,n({type:"update",payload:{animationState:{...t,[e]:{...t[e],store:{...t[e].store,[s]:h}}}}}))},[t,e,n]),c=l.useCallback(s=>{const u=[],d={...t[e].store};let m=!1;return s.forEach(f=>{const x=d[f.tag],h={tag:f.tag,condition:f.condition,action:f.action,animationName:f.animationName,key:f.key};(!x||x.animationName!==f.animationName||x.tag!==f.tag)&&(d[f.tag]=h,m=!0),u.push(f.tag)}),m&&n({type:"update",payload:{animationState:{...t,[e]:{...t[e],store:d}}}}),()=>{const f={...t[e].store};u.forEach(x=>{delete f[x]}),n({type:"update",payload:{animationState:{...t,[e]:{...t[e],store:f}}}})}},[t,e,n]);return{subscribe:i,subscribeAll:c,store:t==null?void 0:t[e].store,unsubscribe:o,notify:r}}function gt({type:e}){const{states:t}=l.useContext(C),{subscribeAll:n}=K({type:e});l.useEffect(()=>{n([{tag:"walk",condition:()=>!t.isRunning&&t.isMoving,action:()=>{},animationName:"walk",key:"walk"},{tag:"run",condition:()=>t.isRunning,action:()=>{},animationName:"run",key:"run"},{tag:"jump",condition:()=>t.isJumping,action:()=>{},animationName:"jump",key:"jump"},{tag:"ride",condition:()=>t.isPush.keyR,action:()=>{},animationName:"ride",key:"ride"},{tag:"land",condition:()=>t.isLanding,action:()=>{},animationName:"land",key:"land"},{tag:"fall",condition:()=>t.isFalling,action:()=>{},animationName:"fall",key:"fall"}])},[])}function le({type:e,actions:t,animationRef:n,currentAnimation:r,isActive:o}){var x,h;const{mode:i,animationState:c,block:s}=l.useContext(C),u=l.useContext(k),{notify:d,store:m}=K({type:e});o&&(r=(x=c==null?void 0:c[e])==null?void 0:x.current);const f=y=>{c[e].current=y;const p=m[y];p!=null&&p.action&&p.action(),u({type:"update",payload:{animationState:{...c}}})};return l.useEffect(()=>{var w;let y="idle";s.animation?y="idle":r?y=r:c[e].current&&(y=c[e].current);const p=(w=t[y])==null?void 0:w.reset().fadeIn(.2).play();return()=>{p==null||p.fadeOut(.2)}},[r,i.type,s.animation,e]),Q(()=>{if(o){const y=d();f(y)}}),{animationRef:n,currentAnimation:(h=c==null?void 0:c[e])==null?void 0:h.current}}class xt{constructor(){ie(this,"subscriptions",new Map);ie(this,"isRunning",!1)}subscribe(t,n,r=0){this.subscriptions.set(t,{id:t,callback:n,priority:r})}unsubscribe(t){this.subscriptions.delete(t)}executeFrame(t,n){if(!this.isRunning){this.isRunning=!0;try{const r=Array.from(this.subscriptions.values()).sort((o,i)=>o.priority-i.priority);for(const o of r)try{o.callback(t,n)}catch(i){console.error(`Frame callback error for ${o.id}:`,i)}}finally{this.isRunning=!1}}}getSubscriptionCount(){return this.subscriptions.size}}const X=new xt;function te(e,t,n=0,r=!0){const o=l.useRef(t);o.current=t;const i=l.useCallback((u,d)=>{r&&o.current(u,d)},[r]),c=l.useCallback(()=>{X.subscribe(e,i,n)},[e,i,n]),s=l.useCallback(()=>{X.unsubscribe(e)},[e]);return l.useEffect(()=>(c(),s),[c,s]),{subscriptionCount:X.getSubscriptionCount()}}function yt(){Q((e,t)=>{X.executeFrame(e,t)})}const bt=(e,t)=>{const{XDistance:n,YDistance:r,ZDistance:o}=t;return e.position.clone().add(v(n,r,o))};function pt(e){const{state:t,worldContext:{cameraOption:n},controllerOptions:{lerp:r}}=e;!t||!t.camera||(t.camera.position.lerp(n.position.clone(),r.cameraPosition),t.camera.lookAt(n.target))}const vt=(e,t)=>{const{XDistance:n,YDistance:r,ZDistance:o}=t;return e.position.clone().add(v(Math.sin(e.euler.y),1,Math.cos(e.euler.y)).normalize().clone().multiply(v(-n,r,-o)))};function wt(e){const{state:t,worldContext:{activeState:n,cameraOption:r},controllerOptions:{lerp:o}}=e;if(!t||!t.camera)return;const i=vt(n,r);t.camera.position.lerp(i.clone(),o.cameraTurn),t.camera.quaternion.copy(n.quat.clone().multiply(N().setFromAxisAngle(v(0,1,0),Math.PI))),t.camera.rotation.copy(n.euler),t.camera.lookAt(n.position.clone())}function jt(e){te(`camera-${e.worldContext.mode.control}`,t=>{e.state=t,e.worldContext.block.camera||(e.worldContext.mode.control==="orbit"?wt(e):e.worldContext.mode.control==="normal"&&pt(e)),e.worldContext.cameraOption.focus||(e.worldContext.cameraOption.target=e.worldContext.activeState.position,e.worldContext.cameraOption.position=bt(e.worldContext.activeState,e.worldContext.cameraOption))},1,!e.worldContext.block.camera)}const L={airplane:{angleDelta:v(Math.PI/256,Math.PI/256,Math.PI/256),maxAngle:v(Math.PI/8,Math.PI/8,Math.PI/8),maxSpeed:60,accelRatio:2,brakeRatio:5,buoyancy:.2,linearDamping:1},vehicle:{maxSpeed:60,accelRatio:2,brakeRatio:5,wheelOffset:.1,linearDamping:.5},character:{walkSpeed:10,runSpeed:20,turnSpeed:10,jumpSpeed:1,linearDamping:1},callbacks:{onReady:()=>{},onFrame:()=>{},onDestory:()=>{},onAnimate:()=>{}},refs:{colliderRef:null,rigidBodyRef:null,outerGroupRef:null,innerGroupRef:null,characterInnerRef:null},controllerOptions:{lerp:{cameraTurn:1,cameraPosition:1}}},J=l.createContext({...L}),Ct=l.createContext(null);function Rt({props:e,actions:t,componentType:n}){const{animationState:r}=l.useContext(C),o=l.useContext(k),{store:i}=K({type:n}),{activeState:c,states:s,control:u}=l.useContext(C),{subscribe:d}=K({type:n}),m=l.useCallback((h,y)=>{if(y in u&&u[y]&&r[n]&&r[n].current!==h){r[n].current=h;const w=i[h];w!=null&&w.action&&w.action(),o({type:"update",payload:{animationState:{...r,[n]:{...r[n],current:h}}}})}},[u,r,n,i,o]),f=l.useMemo(()=>({activeState:c,control:u,states:s,subscribe:d}),[c,u,s,d]);l.useEffect(()=>(e.onReady&&e.onReady(f),()=>{e.onDestory&&e.onDestory(f)}),[e.onReady,e.onDestory,f]);const x=l.useMemo(()=>({...f,actions:t,animationState:r,playAnimation:m}),[f,t,r,m]);return te(`callback-${n}`,h=>{e.onFrame&&e.onFrame({...f,...h}),e.onAnimate&&e.onAnimate({...x,...h})},2,!!(e.onFrame||e.onAnimate)),{subscribe:d,playAnimation:m,dispatch:o}}const Ue=({url:e})=>{const{sizes:t}=l.useContext(C),n=l.useContext(k),r=ae(e),{scene:o}=r,i=()=>new Ie().setFromObject(o).getSize(new A),c=u=>{const d=u||e;return d in t?t[d]:null},s=(u,d)=>{const m=d||e;return m in t||(t[m]=u||i(),n({type:"update",payload:{sizes:{...t}}})),t[m]};return{gltf:r,size:s(),setSize:s,getSize:c}},Ot=()=>{const{sizes:e}=l.useContext(C);return{getSizesByUrls:n=>{const r={};return n&&Object.keys(n).forEach(o=>{const i=n[o];i in e?r[o]=e[i]:r[o]=null}),r}}};function Mt(e){const{rigidBodyRef:t,controllerContext:{airplane:n}}=e,{linearDamping:r}=n;t.current.setLinearDamping(r)}function kt(e){const{innerGroupRef:t,worldContext:{activeState:n,control:r},controllerContext:{airplane:o},matchSizes:i}=e,{forward:c,backward:s,leftward:u,rightward:d,shift:m,space:f}=r,{angleDelta:x,maxAngle:h,accelRatio:y}=o;if(!i||!i.airplaneUrl)return null;let p=0;p=f?Number(m):Number(m)*y;const w=Number(s)-Number(c),M=Number(d)-Number(u),S=v().set(p,p,p);n.euler.y+=-M*x.y;const P=h.x*w,F=h.z*M,_=t.current.rotation.x,G=t.current.rotation.z,D=h.x,U=h.z,R=t.current.clone();_<-D?R.rotation.x=-D+P:_>D?R.rotation.x=D+P:R.rotateX(P),G<-U?R.rotation.z=-U+F:G>U?R.rotation.z=U+F:R.rotateZ(F),n.euler.x=R.rotation.x,n.euler.z=R.rotation.z,R.rotation.y=0,t.current.setRotationFromQuaternion(N().setFromEuler(t.current.rotation.clone()).slerp(N().setFromEuler(R.rotation.clone()),.2)),n.rotation=R.rotation,n.direction=S.multiply(v(Math.sin(n.euler.y),-w,Math.cos(n.euler.y))),n.dir=n.direction.normalize()}function Pt(e){const{rigidBodyRef:t,worldContext:{activeState:n}}=e;t.current.setGravityScale(n.position.y<10?(1-.1)/-10*n.position.y+1:.1,!1)}function St(e){const{rigidBodyRef:t,worldContext:{activeState:n},controllerContext:{airplane:r}}=e,{maxSpeed:o}=r,i=t.current.linvel();if(b(i).length()<o){const s=t.current.mass();t.current.applyImpulse(b({x:n.direction.x,y:n.direction.y,z:n.direction.z}).multiplyScalar(s),!1)}}function zt(e){const{rigidBodyRef:t,worldContext:{activeState:n},dispatch:r}=e;n.position=b(t.current.translation()),n.velocity=b(t.current.linvel());const o=n.euler.clone();o.x=0,o.z=0,t.current.setRotation(N().setFromEuler(o),!0),r({type:"update",payload:{activeState:{...n}}})}function Nt(e){const{worldContext:{states:t,rideable:n,mode:r},dispatch:o}=e,{isRiding:i}=t;i&&(n.objectType=null,n.key=null,r.type="character",t.isRiding=!1,t.enableRiding=!1),o({type:"update",payload:{mode:{...r},rideable:{...n}}})}function At(e){kt(e),St(e),Mt(e),Pt(e),Nt(e),zt(e)}function Dt({activeState:e,control:t,mode:n,clicker:r}){const{forward:o,backward:i,leftward:c,rightward:s}=t,u=Number(c)-Number(s),d=Number(o)-Number(i);let m=0;if(n.controller==="clicker")e.euler.y=Math.PI/2-r.angle,m=1;else{if(u===0&&d===0)return;e.euler.y+=u*Math.PI/32,m=d}const f=v(m,0,m);e.direction=f.multiply(v(-Math.sin(e.euler.y),0,-Math.cos(e.euler.y))),e.dir=e.direction.normalize()}function Et({activeState:e,control:t,mode:n,clicker:r}){const{forward:o,backward:i,leftward:c,rightward:s}=t;if(n.controller==="clicker")e.euler.y=Math.PI/2-r.angle,e.dir.set(-Math.sin(e.euler.y),0,-Math.cos(e.euler.y));else{const u=Number(c)-Number(s),d=Number(o)-Number(i);if(u===0&&d===0)return;const m=v(u,0,d),f=ht(m);e.euler.y=f,e.dir.set(u,0,d)}}function It(e){const{worldContext:t}=e;t.mode.control==="normal"?Et(t):t.mode.control==="orbit"&&Dt(t)}function Tt(e){const{rigidBodyRef:t,worldContext:{states:n,activeState:r}}=e,{isMoving:o,isRunning:i}=n,{controllerContext:{character:{walkSpeed:c,runSpeed:s,jumpSpeed:u}}}=e,{isOnTheGround:d,isJumping:m}=n,f=b();if(m&&d&&f.setY(u*t.current.mass()),o){const x=i?s:c,h=b().addScalar(x).multiply(r.dir.clone().normalize().negate()),y=t.current.mass(),w=h.clone().sub(r.velocity).multiplyScalar(y);f.setX(w.x),f.setZ(w.z)}t.current.applyImpulse(f,!0),r.position=b(t.current.translation()),r.velocity=b(t.current.linvel())}function Ft(e){const{rigidBodyRef:t,innerGroupRef:n,controllerContext:{character:{linearDamping:r}},worldContext:{activeState:o,states:i,block:c},delta:s}=e;i.isJumping||t.current.linvel().y<0?t.current.setLinearDamping(r):t.current.setLinearDamping(i.isNotMoving?r*5:r),t.current.setEnabledRotations(!1,!1,!1,!1),n.current.quaternion.rotateTowards(N().setFromEuler(o.euler),10*s)}function Gt(e){var m;const{rigidBodyRef:t,state:n,worldContext:{clicker:r,mode:o,clickerOption:i,block:c},dispatch:s}=e,u=b((m=t.current)==null?void 0:m.translation());let d=we(u,r.point,!1);if(i.autoStart&&i.queue[0]instanceof A){const f=b(i.queue[0]),x=Math.atan2(f.z-u.z,f.x-u.x);s({type:"update",payload:{clicker:{...r,isOn:!0,angle:x}}}),d=we(u,i.queue[0],!1)}if(d<1&&o.controller==="clicker")if(i.track&&i.queue.length!==0){const f=i.queue.shift();if(f instanceof A){const x=b(f),h=Math.atan2(x.z-u.z,x.x-u.x);s({type:"update",payload:{clicker:{...r,point:f,angle:h}}})}else{const{action:x,beforeCB:h,afterCB:y,time:p}=f;x==="stop"&&(n.clock.stop(),h(n),console.log(),setTimeout(()=>{n.clock.start(),y(n)},p))}i.loop&&i.queue.push(f)}else s({type:"update",payload:{clicker:{...r,isOn:!1,isRun:!1}}})}function Ut(e){const{worldContext:{control:t,clicker:n,mode:r},dispatch:o}=e,{keyS:i}=t;i&&r.controller==="clicker"&&o({type:"update",payload:{clicker:{...n,isOn:!1,isRun:!1}}})}function je(e){It(e),Tt(e),Ft(e),Ut(e),Gt(e)}function Lt(e){const{colliderRef:t,groundRay:n,worldContext:{states:r,activeState:o}}=e;if(n.origin.addVectors(o.position,b(n.offset)),(!n.hit||!n.rayCast||!t.current)&&(r.isOnTheGround=!1),n.hit){const i=n.length*2,c=n.length*.8;n.hit.toi>=i?(r.isFalling=!0,r.isOnTheGround=!1):c<=n.hit.toi&&n.hit.toi<i?r.isFalling=!0:n.hit.toi<c&&(r.isFalling=!1,r.isOnTheGround=!0)}}function _t(e){const{worldContext:{states:t,mode:n,control:r,clicker:o,clickerOption:i}}=e,{shift:c,space:s}=r;n.controller==="clicker"&&(t.isMoving=o.isOn,t.isNotMoving=!o.isOn,t.isRunning=(c||o.isRun)&&t.isMoving&&i.isRun,t.isJumping=s)}function Bt(e){const{worldContext:{states:t,control:n}}=e;Object.keys(n).forEach(r=>{t.isPush[r]=n[r]})}function Vt(e){const{worldContext:{states:t}}=e,{isRiderOn:n}=t;n&&t.isPush.keyR&&(t.isRiding=!0)}function qt(e){const{outerGroupRef:t,worldContext:{states:n,activeState:r}}=e;n.isMoving&&t&&t.current&&(n.isRotated=Math.sin(t.current.rotation.y).toFixed(3)===Math.sin(r.euler.y).toFixed(3))}function $t(e){Lt(e),_t(e),qt(e),Bt(e),Vt(e)}function Wt(e){const{rigidBodyRef:t,worldContext:{control:n},controllerContext:{vehicle:r}}=e,{space:o}=n,{brakeRatio:i,linearDamping:c}=r;t.current.setLinearDamping(o?i:c)}function Xt(e){const{worldContext:{activeState:t,control:n}}=e,{forward:r,backward:o,leftward:i,rightward:c}=n,s=Number(i)-Number(c),u=Number(r)-Number(o),d=b().set(u,0,u);return t.euler.y+=s*(Math.PI/64),d}function Zt(e){const{worldContext:{mode:t,activeState:n}}=e,r=b();r.copy(Xt(e)),n.direction=r.multiply(v(Math.sin(n.euler.y),0,Math.cos(n.euler.y))),n.dir=n.direction.normalize()}function Ht(e){const{rigidBodyRef:t,worldContext:{activeState:n,control:r},controllerContext:{vehicle:o}}=e,{shift:i}=r,{maxSpeed:c,accelRatio:s}=o,u=t.current.linvel();if(b(u).length()<c){const m=t.current.mass();let f=i?s:1;t.current.applyImpulse(b().addScalar(f).multiply(n.dir.clone().normalize()).multiplyScalar(m),!1)}}function Kt(e){const{rigidBodyRef:t,worldContext:{activeState:n}}=e;n.position=b(t.current.translation()),n.velocity=b(t.current.linvel()),t.current.setRotation(N().setFromEuler(n.euler.clone()),!1)}function Jt(e){const{worldContext:{states:t,rideable:n,mode:r},dispatch:o}=e,{isRiding:i}=t;i&&(n.objectType=null,n.key=null,r.type="character",t.isRiding=!1,t.enableRiding=!1),o({type:"update",payload:{mode:{...r},rideable:{...n}}})}function Yt(e){Zt(e),Ht(e),Wt(e),Jt(e),Kt(e)}function Qt({groundRay:e,rigidBodyRef:t,outerGroupRef:n,innerGroupRef:r,colliderRef:o}){var p;const i=l.useContext(C),c=l.useContext(J),s=l.useContext(k),{mode:u,activeState:d,block:m}=i,{getSizesByUrls:f}=Ot();l.useEffect(()=>{!t||!r||t.current&&r.current&&(t.current.lockRotations(!1,!0),d.euler.set(0,0,0),t.current.setTranslation(d.position.clone().add(v(0,5,0)),!0))},[u.type,t,r,d]),l.useEffect(()=>{t!=null&&t.current&&m.control&&(t.current.resetForces(!1),t.current.resetTorques(!1))},[m.control]);const x=l.useMemo(()=>(t==null?void 0:t.current)&&(n==null?void 0:n.current)&&(r==null?void 0:r.current),[t==null?void 0:t.current,n==null?void 0:n.current,r==null?void 0:r.current]),h=l.useMemo(()=>f(i==null?void 0:i.urls),[f,i==null?void 0:i.urls]),y=l.useMemo(()=>{switch(u.type){case"vehicle":return Yt;case"character":return je;case"airplane":return At;default:return je}},[u.type]);te(`physics-${((p=t==null?void 0:t.current)==null?void 0:p.handle)||"unknown"}`,(w,M)=>{if(!x||m.control)return;const S={rigidBodyRef:t,outerGroupRef:n,innerGroupRef:r,colliderRef:o,groundRay:e,state:w,delta:M,worldContext:i,controllerContext:c,dispatch:s,matchSizes:h};y(S),$t(S)},0,x&&!m.control)}function en({url:e,children:t,offset:n,currentAnimation:r}){const{gltf:o}=Ue({url:e}),{animations:i,scene:c}=o,{actions:s,ref:u}=se(i),d=l.useMemo(()=>Ae.clone(c),[c]),{nodes:m}=Ne(d),f=Object.values(m).find(x=>x.type==="Object3D");return le({type:"character",currentAnimation:r||"ride",actions:s,animationRef:u,isActive:!1}),a.jsx(a.Fragment,{children:a.jsxs("group",{position:n,children:[f&&a.jsx("primitive",{object:f,visible:!1,receiveShadow:!0,castShadow:!0,ref:u}),Object.keys(m).map((x,h)=>{const y=m[x];if(y instanceof ee)return a.jsx("skinnedMesh",{castShadow:!0,receiveShadow:!0,material:y.material,geometry:y.geometry,skeleton:y.skeleton},h);if(y instanceof Te)return a.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:y.material,geometry:y.geometry},h)}),t]})})}const tn=l.forwardRef((e,t)=>a.jsxs("group",{receiveShadow:!0,castShadow:!0,ref:t,userData:{intangible:!0},children:[e.isRiderOn&&e.enableRiding&&e.isActive&&e.ridingUrl&&a.jsx(en,{url:e.ridingUrl,offset:e.offset}),e.children,e.objectNode&&e.animationRef&&a.jsx("primitive",{object:e.objectNode,visible:!1,receiveShadow:!0,castShadow:!0,ref:e.animationRef}),Object.keys(e.nodes).map((n,r)=>{const o=e.nodes[n];if(o instanceof ee)return a.jsx("skinnedMesh",{castShadow:!0,receiveShadow:!0,material:o.material,geometry:o.geometry,skeleton:o.skeleton},r);if(o instanceof Te)return a.jsx("mesh",{castShadow:!0,receiveShadow:!0,material:o.material,geometry:o.geometry},r)})]})),nn=({url:e,isActive:t,componentType:n,currentAnimation:r,color:o,skeleton:i})=>{const{scene:c,animations:s}=ae(e),{actions:u,ref:d}=se(s),m=l.useMemo(()=>{const f=[];return c.traverse(x=>{if(x instanceof ee){const h=x.clone();h.skeleton=i,h.bind(i,h.bindMatrix),f.push(h)}}),f},[c,i]);return le({type:n,actions:u,animationRef:d,currentAnimation:t?void 0:r,isActive:t}),a.jsx(a.Fragment,{children:m.map((f,x)=>a.jsx("skinnedMesh",{castShadow:!0,receiveShadow:!0,geometry:f.geometry,skeleton:i,material:f.name==="color"&&o?new ot({color:o}):f.material},x))})};function rn(){const e=De();return l.useCallback(({ray:n,ref:r})=>e.world.castRay(n.rayCast,n.length,!0,void 0,void 0,r.current,void 0),[e])}function on(){const{rapier:e}=De(),t=rn();return({groundRay:r,length:o,colliderRef:i})=>{var c;r.length=o,r.rayCast=new e.Ray(r.origin,r.dir),r.hit=t({ray:r,ref:i}),r.parent=(c=r.hit)==null?void 0:c.collider.parent()}}const ue=l.forwardRef((e,t)=>{var h;const{size:n}=Ue({url:e.url}),r=on();l.useEffect(()=>{e.groundRay&&e.colliderRef&&r({groundRay:e.groundRay,length:.5,colliderRef:e.colliderRef})},[e.groundRay,e.colliderRef,r]);const{scene:o,animations:i}=ae(e.url),{actions:c,ref:s}=se(i),u=l.useContext(C);l.useContext(J);const d=l.useMemo(()=>Ae.clone(o),[o]),m=l.useMemo(()=>{let y=null;return d.traverse(p=>{p instanceof ee&&(y=p.skeleton)}),y},[d]);if(e.isActive){gt({type:e.componentType,groundRay:e.groundRay});const y={state:null,worldContext:u,controllerOptions:e.controllerOptions};jt(y),Qt({outerGroupRef:e.outerGroupRef,innerGroupRef:e.innerGroupRef,rigidBodyRef:t,colliderRef:e.colliderRef,groundRay:e.groundRay})}le({type:e.componentType,actions:c,animationRef:s,currentAnimation:e.isActive?void 0:e.currentAnimation,isActive:e.isActive}),Rt({props:e,actions:c,componentType:e.componentType});const{nodes:f}=Ne(d),x=Object.values(f).find(y=>y.type==="Object3D");return a.jsxs(Ee,{colliders:!1,ref:t,name:e.name,rotation:I().set(0,((h=e.rotation)==null?void 0:h.clone().y)||0,0).clone(),userData:e.userData,type:e.rigidbodyType||(e.isActive?"dynamic":"fixed"),sensor:e.sensor,onIntersectionEnter:e.onIntersectionEnter,onCollisionEnter:e.onCollisionEnter,...e.rigidBodyProps,children:[!e.isNotColliding&&a.jsx(nt,{ref:e.colliderRef,args:[(n.y/2-n.x)*1.2,n.x*1.2],position:[0,(n.y/2+n.x/2)*1.2,0]}),a.jsxs(tn,{objectNode:x,animationRef:s,nodes:f,ref:e.innerGroupRef,isActive:e.isActive,isRiderOn:e.isRiderOn,enableRiding:e.enableRiding,ridingUrl:e.ridingUrl,offset:e.offset,parts:e.parts,children:[e.children,e.parts&&e.parts.length>0&&e.parts.map(({url:y,color:p},w)=>y?a.jsx(nn,{url:y,isActive:e.isActive,componentType:e.componentType,currentAnimation:e.currentAnimation,color:p,skeleton:m},w+y):null)]})]})});function Le(e){const{rigidBodyRef:t,outerGroupRef:n}=e;return a.jsx(ce,{ref:n,children:a.jsx(ue,{ref:t,name:e.name,componentType:"airplane",ridingUrl:e.ridingUrl,...e,children:e.children})})}function an(e){return a.jsx(Le,{name:"airplane",isActive:!0,currentAnimation:"idle",componentType:"airplane",ridingUrl:e.ridingUrl,...e,children:e.children})}function _e(e){const{outerGroupRef:t}=e;return a.jsx(ce,{ref:t,children:a.jsx(ue,{name:"character",url:e.url,controllerOptions:e.controllerOptions,ref:e.rigidBodyRef,groundRay:e.groundRay,isNotColliding:e.isNotColliding,...e,children:e.children})})}function sn({children:e,props:t,refs:n,urls:r}){return a.jsx(_e,{url:r.characterUrl,isActive:!0,componentType:"character",rigidbodyType:"dynamic",controllerOptions:t.controllerOptions,groundRay:t.groundRay,onAnimate:t.onAnimate,onFrame:t.onFrame,onReady:t.onReady,onDestory:t.onDestory,rigidBodyProps:t.rigidBodyProps,parts:t.parts,...n,children:e})}function Be(e){const{rigidBodyRef:t,outerGroupRef:n}=e;return a.jsx(ce,{ref:n,children:a.jsx(ue,{ref:t,name:e.name,componentType:"vehicle",ridingUrl:e.ridingUrl,...e,children:e.children})})}function cn(e){return a.jsx(Be,{name:"vehicle",isActive:!0,currentAnimation:"idle",componentType:"vehicle",ridingUrl:e.ridingUrl,...e,children:e.children})}function ln({props:e,refs:t}){const{mode:n,states:r,rideable:o,urls:i}=l.useContext(C),{enableRiding:c,isRiderOn:s,rideableId:u}=r,d=l.useMemo(()=>u&&o[u]?o[u].offset:b(),[u,o]),m=l.useMemo(()=>({controllerOptions:e.controllerOptions,enableRiding:c,isRiderOn:s,groundRay:e.groundRay,offset:d,...t,children:e.children}),[e.controllerOptions,c,s,e.groundRay,d,t,e.children]);switch(n.type){case"character":return a.jsx(sn,{props:e,refs:t,urls:i,children:e.children});case"vehicle":return a.jsx(cn,{...m,url:i.vehicleUrl,wheelUrl:i.wheelUrl,ridingUrl:i.ridingUrl});case"airplane":return a.jsx(an,{...m,url:i.airplaneUrl,ridingUrl:i.ridingUrl});default:return null}}function de(){const e=l.useRef(null),t=l.useRef(null),n=l.useRef(null),r=l.useRef(null);return{rigidBodyRef:e,outerGroupRef:t,innerGroupRef:n,colliderRef:r}}function un(e){const{rigidBodyRef:t,outerGroupRef:n,innerGroupRef:r,colliderRef:o}=de(),i=l.useMemo(()=>e.position.y<10?(1-.1)/-10*e.position.y+1:.1,[e.position.y]),c=l.useMemo(()=>{const u=e.rotation.clone();return u.y=0,u},[e.rotation]);te(`passive-airplane-${e.name||"unnamed"}`,()=>{r.current&&r.current.setRotationFromQuaternion(N().setFromEuler(r.current.rotation.clone()).slerp(N().setFromEuler(c),.2)),t.current&&t.current.setGravityScale(i,!1)},3,!!(r.current||t.current));const s={rigidBodyRef:t,outerGroupRef:n,innerGroupRef:r,colliderRef:o};return a.jsx(Le,{isActive:!1,componentType:"airplane",name:"airplane",...e,...s,children:e.children})}function dn(e){const t=de();return l.useEffect(()=>{t.rigidBodyRef&&t.rigidBodyRef.current&&t.rigidBodyRef.current.setEnabledRotations(!1,!1,!1,!1)},[t.rigidBodyRef]),a.jsx(_e,{isActive:!1,componentType:"character",controllerOptions:e.controllerOptions||{lerp:{cameraTurn:1,cameraPosition:1}},position:e.position,rotation:e.rotation,groundRay:e.groundRay,currentAnimation:e.currentAnimation,...t,...e,children:e.children})}function fn(e){const{rigidBodyRef:t,outerGroupRef:n,innerGroupRef:r,colliderRef:o}=de(),i={rigidBodyRef:t,outerGroupRef:n,innerGroupRef:r,colliderRef:o};return a.jsx(Be,{isActive:!1,componentType:"vehicle",name:"vehicle",...e,...i,children:e.children})}function mn(e,t){switch(t.type){case"init":return{...e};case"update":return{...e,...t.payload}}}const hn=(e,t)=>{t({type:"update",payload:e})};function gn(e){const t=l.useContext(C),n=l.useContext(k),r=l.useMemo(()=>t!=null&&t.control?t.mode.controller==="clicker"?t.mode.isButton?{...t.control}:{}:{...t.control}:null,[t==null?void 0:t.mode.controller,t==null?void 0:t.mode.isButton,t==null?void 0:t.control]);l.useEffect(()=>{r&&n({type:"update",payload:{control:r}})},[r,n]);const o=l.useMemo(()=>({origin:b(),dir:b({x:0,y:-1,z:0}),offset:b({x:0,y:-1,z:0}),hit:null,parent:null,rayCast:null,length:10}),[]),i=l.useMemo(()=>({origin:b(),hit:new ye,rayCast:new ye(b(),b(),0,-7),dir:b(),position:b(),length:-t.cameraOption.maxDistance,detected:[],intersects:[],intersectObjectMap:{}}),[t.cameraOption.maxDistance]),c=l.useCallback(s=>{hn({refs:{...s}},n)},[n]);return l.useEffect(()=>{e.refs&&c(e.refs)},[e.refs,c]),{groundRay:o,cameraRay:i}}function xn(e){return a.jsx(yn,{...e,children:e.children})}function yn(e){yt();const t=l.useRef(null),n=l.useRef(null),r=l.useRef(null),o=l.useRef(null),i=l.useRef(null),c=l.useRef(null),[s,u]=l.useReducer(mn,{airplane:{...L.airplane,...e.airplane},vehicle:{...L.vehicle,...e.vehicle},character:{...L.character,...e.character},callbacks:{...L.callbacks,onReady:e.onReady,onFrame:e.onFrame,onDestory:e.onDestory,onAnimate:e.onAnimate},refs:{colliderRef:t,rigidBodyRef:n,outerGroupRef:r,innerGroupRef:o,characterInnerRef:i},controllerOptions:{...L.controllerOptions,...e.controllerOptions}}),d=l.useMemo(()=>({value:s,dispatch:u}),[s]),m=l.useMemo(()=>({colliderRef:t,rigidBodyRef:n,outerGroupRef:r,innerGroupRef:o,characterInnerRef:i,passiveRigidBodyRef:c}),[t,n,r,o,i,c]),f={...gn({refs:m}),children:e.children,groupProps:e.groupProps,rigidBodyProps:e.rigidBodyProps,controllerOptions:d.value.controllerOptions,parts:e.parts,...d.value.callbacks,...m},x=He(C,J);return a.jsx(x,{children:a.jsx(J.Provider,{value:d.value,children:a.jsx(Ct.Provider,{value:d.dispatch,children:a.jsx(ln,{props:f,refs:m})})})})}function bn(){const{activeState:e,mode:t,clicker:n}=l.useContext(C),r=l.useContext(k);return{moveClicker:(i,c,s)=>{if(t.controller!=="clicker"||s!=="ground")return;const u=e.position,d=v(i.point.x,i.point.y,i.point.z),m=Math.atan2(d.z-u.z,d.x-u.x);r({type:"update",payload:{clicker:{...n,point:v(d.x,0,d.z),angle:m,isOn:!0,isRun:c}}})}}}function pn({type:e="normal",text:t,position:n,children:r}){const o=l.useRef(null),{minimap:i}=l.useContext(C),c=l.useContext(k),{moveClicker:s}=bn();return l.useEffect(()=>{if(o.current){const u=new Ie().setFromObject(o.current),d=b(u.getSize(new A)).clone(),m=b(u.getCenter(new A)).clone(),f={type:e||"normal",text:t,size:d,center:m};i.props[t]=f,c({type:"update",payload:{minimap:{...i}}})}},[]),a.jsx("group",{ref:o,position:n,onPointerDown:u=>{u.srcElement instanceof HTMLDivElement||s(u,!1,e)},children:r})}function vn({onMarker:e,runMarker:t}){const{clicker:n,mode:r,clickerOption:o}=l.useContext(C),i=[];for(let c=0;c<o.queue.length;c++)o.queue[c]instanceof A&&i.push(o.queue[c]);return a.jsxs(a.Fragment,{children:[r.controller==="clicker"&&a.jsxs("group",{position:n.point,children:[n.isOn&&e,n.isOn&&o.isRun&&n.isRun&&t]}),o.line&&i.map((c,s)=>{if(c instanceof A){const u=s,d=s===0?i.length-1:s-1;return a.jsxs("group",{position:[0,1,0],children:[a.jsx(Ke,{worldUnits:!0,points:[i[d],i[u]],color:"turquoise",transparent:!0,opacity:.5,lineWidth:.4}),a.jsxs("mesh",{position:c,children:[a.jsx("sphereGeometry",{args:[.6,30,.6]}),a.jsx("meshStandardMaterial",{color:"turquoise",transparent:!0,opacity:.8})]},s)]},s)}})]})}function wn(){const{control:e}=l.useContext(C),t=l.useContext(k);return{pushKey:(r,o)=>{e[r]=o,t({type:"update",payload:{control:{...e}}})}}}var jn="_14e7l20",Cn="_14e7l21 _14ssv4f1 _14ssv4f0",Rn="_14e7l22";function On({value:e,name:t,gamePadButtonStyle:n}){const[r,o]=l.useState(!1),{pushKey:i}=wn(),c=()=>{i(e,!0),o(!0)},s=()=>{i(e,!1),o(!1)};return a.jsx("button",{className:`${Cn} ${r?Rn:""}`,onMouseDown:c,onMouseUp:s,onMouseLeave:s,onContextMenu:u=>{u.preventDefault(),s()},onPointerDown:c,onPointerUp:s,style:n,children:t})}function Mn(e){const{gamePadStyle:t,gamePadButtonStyle:n,label:r}=e,{control:o,mode:i}=l.useContext(C),c=Object.keys(o).map(s=>{const u=(r==null?void 0:r[s])||s;if(s!=="forward"&&s!=="backward"&&s!=="leftward"&&s!=="rightward")return{tag:s,value:s,name:u}}).filter(s=>s!==void 0).filter(s=>s.tag!=="run");return a.jsx(a.Fragment,{children:i.controller==="clicker"&&a.jsx("div",{className:jn,style:t,children:c.map((s,u)=>a.jsx(On,{value:s.value,name:s.name,gamePadButtonStyle:n},u))})})}var q={minimap:{position:"absolute",bottom:"20px",left:"20px",width:"200px",height:"200px",zIndex:100,cursor:"pointer"},scale:{position:"absolute",bottom:"20px",left:"230px",zIndex:101,display:"flex",alignItems:"center",gap:"0.5rem",color:"white",fontSize:"1rem",background:"rgba(0,0,0,0.5)",padding:"0.5rem 1rem",borderRadius:"1rem"},plusMinus:{cursor:"pointer",width:"2rem",height:"2rem",display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"50%",background:"rgba(0,0,0,0.5)",transition:"all 0.2s",":hover":{background:"rgba(0,0,0,0.7)"}}},Ce={color:"white",fontSize:"1.5rem"},kn={background:"rgba(0,0,0,0.3)"},Re={background:"#01fff7",boxShadow:"0 0 10px rgba(1,255,247,0.7)"},Oe={color:"white",fontSize:"1rem"},j=200;const Pn=.5,Sn=.1,zn=2;function Nn({scale:e=Pn,minScale:t=Sn,maxScale:n=zn,blockScale:r=!1,blockScaleControl:o=!1,blockRotate:i=!1,angle:c=0,minimapStyle:s,minimapInnerStyle:u,textStyle:d,minimapObjectStyle:m,avatarStyle:f,scaleStyle:x,directionStyle:h,plusMinusStyle:y,imageStyle:p}){const{minimap:w,activeState:M,mode:S}=l.useContext(C),[P,F]=z.useState(e),_=l.useRef(null),G=l.useCallback(()=>{r||F(E=>Math.min(n,E+.1))},[r,n]),D=l.useCallback(()=>{r||F(E=>Math.max(t,E-.1))},[r,t]),U=l.useCallback(E=>{r||(E.deltaY<0?G():D())},[r,G,D]),R=l.useCallback(()=>i||S.control==="normal"?180:M.euler.y*180/Math.PI+180,[i,S.control,M.euler.y]);return l.useEffect(()=>{const E=_.current;if(!E||!(M!=null&&M.position)||!(w!=null&&w.props))return;const g=E.getContext("2d");if(!g)return;g.clearRect(0,0,j,j),g.save(),g.beginPath(),g.arc(j/2,j/2,j/2,0,Math.PI*2),g.clip(),g.fillStyle="rgba(0, 0, 0, 0.6)",g.fillRect(0,0,j,j);const ne=R();g.translate(j/2,j/2),g.rotate(ne*Math.PI/180),g.translate(-200/2,-200/2),(()=>{g.save(),g.fillStyle=(h==null?void 0:h.color)||Ce.color,g.font=`${(h==null?void 0:h.fontSize)||Ce.fontSize} sans-serif`,[{text:"N",x:j/2,y:30},{text:"S",x:j/2,y:j-30},{text:"E",x:j-30,y:j/2},{text:"W",x:30,y:j/2}].forEach(({text:me,x:B,y:V})=>{g.save(),g.translate(B,V),g.rotate(-ne*Math.PI/180),g.textAlign="center",g.textBaseline="middle",g.fillText(me,0,0),g.restore()}),g.restore()})(),Object.values(w.props).forEach((fe,me)=>{const{center:B,size:V,text:he}=fe,qe=(B.x-M.position.x)*(c?Math.sin(c):1)*P,$e=(B.z-M.position.z)*(c?-Math.cos(c):1)*P;g.save(),g.fillStyle=(m==null?void 0:m.background)||kn.background;const re=V.x*P,oe=V.z*P,ge=j/2-qe-re/2,xe=j/2-$e-oe/2;g.fillRect(ge,xe,re,oe),he&&(g.save(),g.fillStyle=(d==null?void 0:d.color)||Oe.color,g.font=`${(d==null?void 0:d.fontSize)||Oe.fontSize} sans-serif`,g.translate(ge+re/2,xe+oe/2),i||S.control==="normal"?g.rotate(Math.PI):g.rotate(-ne*Math.PI/180),g.textAlign="center",g.textBaseline="middle",g.fillText(he,0,0),g.restore()),g.restore()}),g.save(),g.fillStyle=(f==null?void 0:f.background)||Re.background,g.shadowColor=(f==null?void 0:f.boxShadow)||Re.boxShadow,g.shadowBlur=10,g.beginPath(),g.arc(j/2,j/2,6,0,Math.PI*2),g.fill(),g.restore(),g.restore()},[w,M,P,c,i,S.control,R,m,d,f,h]),a.jsxs("div",{children:[a.jsx("canvas",{ref:_,width:j,height:j,style:{...q.minimap,...s},onWheel:U}),!o&&a.jsxs("div",{style:{...q.scale,...x},children:[a.jsx("div",{style:{...q.plusMinus,cursor:r?"default":"pointer",...y},onClick:D,children:"+"}),a.jsxs("span",{children:["SCALE 1:",Math.round(100/P)]}),a.jsx("div",{style:{...q.plusMinus,cursor:r?"default":"pointer",...y},onClick:G,children:"-"})]})]})}b(),I(),b();function Me({children:e,...t}){const n=l.useRef(),[r,o]=l.useState(),i=new A;return Q(c=>{const s=c.camera.position.distanceTo(n.current.getWorldPosition(i))<=10;s!==r&&o(s)}),a.jsx("group",{ref:n,children:a.jsx(Je,{transform:!0,occlude:!0,...t,children:e})})}function An(e,t){switch(t.type){case"init":return{...e};case"update":return{...e,...t.payload}}}function Dn(e){const t=l.useMemo(()=>({activeState:{...O.activeState,position:e.startPosition||O.activeState.position},cameraOption:{...O.cameraOption,...e.cameraOption||{}},mode:{...O.mode,...e.mode||{}},urls:{...O.urls,...e.urls||{}},refs:null,states:O.states,rideable:O.rideable,minimap:O.minimap,control:O.control,clicker:O.clicker,clickerOption:{...O.clickerOption,...e.clickerOption||{}},animationState:O.animationState,block:{...O.block,...e.block||{}},sizes:O.sizes}),[e.startPosition,e.cameraOption,e.mode,e.urls,e.clickerOption,e.block]),[n,r]=l.useReducer(An,t);return{gaesupProps:l.useMemo(()=>({value:n,dispatch:r}),[n,r])}}function En(e){const{gaesupProps:t}=Dn(e);return a.jsx(C.Provider,{value:t.value,children:a.jsx(k.Provider,{value:t.dispatch,children:e.children})})}function In(){const e=l.useContext(C);return{state:e.activeState,mode:e.mode,urls:e.urls,currentAnimation:e.mode.type?e.animationState[e.mode.type].current:"idle"}}function Tn(e){var t=e.match(/^var\((.*)\)$/);return t?t[1]:e}function ke(e,t){var n={};{var r=e;for(var o in r){var i=r[o];i!=null&&(n[Tn(o)]=i)}}return Object.defineProperty(n,"toString",{value:function(){return Object.keys(this).map(s=>"".concat(s,":").concat(this[s])).join(";")},writable:!1}),n}var Fn="_1kpnjzy0 dsxi6zhi dsxi6zib",Gn="_1kpnjzy1 dsxi6zhi",Un="_1kpnjzy2 dsxi6zli dsxi6zmb dsxi6z0";const $=({children:e,ToolTip:t,onClick:n,id:r,toolTipStyles:o,iconStyle:i})=>{const[c,s]=l.useState(!0);return a.jsxs("div",{className:Fn,onMouseOver:()=>s(!1),onMouseLeave:()=>s(!0),onClick:u=>{n&&n(u)},style:ke({...i}),id:r,children:[a.jsx("div",{className:Gn,children:e}),a.jsx("div",{className:Un,style:ke({opacity:c?"0":"1",...o}),children:t})]})};function Ln(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _n(e){var t=Ln(e,"string");return typeof t=="symbol"?t:String(t)}function Bn(e,t,n){return t=_n(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Se(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Pe(Object(n),!0).forEach(function(r){Bn(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pe(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function ze(e,t){var n={};for(var r in e)n[r]=t(e[r],r);return n}var Vn=(e,t,n)=>{for(var r of Object.keys(e)){var o;if(e[r]!==((o=t[r])!==null&&o!==void 0?o:n[r]))return!1}return!0},Ve=e=>{var t=n=>{var r=e.defaultClassName,o=Se(Se({},e.defaultVariants),n);for(var i in o){var c,s=(c=o[i])!==null&&c!==void 0?c:e.defaultVariants[i];if(s!=null){var u=s;typeof u=="boolean"&&(u=u===!0?"true":"false");var d=e.variantClassNames[i][u];d&&(r+=" "+d)}}for(var[m,f]of e.compoundVariants)Vn(m,o,e.defaultVariants)&&(r+=" "+f);return r};return t.variants=()=>Object.keys(e.variantClassNames),t.classNames={get base(){return e.defaultClassName.split(" ")[0]},get variants(){return ze(e.variantClassNames,n=>ze(n,r=>r.split(" ")[0]))}},t},qn="_2h59lt0 dsxi6z82 dsxi6z8a",T=Ve({defaultClassName:"_2h59lt6",variantClassNames:{selected:{false:"_2h59lt7",true:"_2h59lt8"}},defaultVariants:{},compoundVariants:[]}),W="_2h59lt9";function $n(){const{mode:e}=l.useContext(C),t=l.useContext(k),n=o=>{t({type:"update",payload:{mode:{...e,type:o,control:"orbit"}}})},r=o=>{t({type:"update",payload:{mode:{...e,control:o}}})};return a.jsxs("div",{className:qn,children:[a.jsx($,{ToolTip:a.jsxs(a.Fragment,{children:[a.jsx("p",{className:T({selected:e.type==="character"}),onClick:()=>n("character"),children:"character"}),a.jsx("p",{className:T({selected:e.type==="vehicle"}),onClick:()=>n("vehicle"),children:"vehicle"}),a.jsx("p",{className:T({selected:e.type==="airplane"}),onClick:()=>n("airplane"),children:"airplane"})]}),toolTipStyles:{background:"rgba(0,0,0,0.8)"},children:a.jsx("button",{className:W,children:e.type})}),a.jsx($,{ToolTip:a.jsxs(a.Fragment,{children:[a.jsx("p",{className:T({selected:e.control==="orbit"}),onClick:()=>r("orbit"),children:"orbit"}),e.type==="character"&&a.jsx("p",{className:T({selected:e.control==="normal"}),onClick:()=>r("normal"),children:"normal"})]}),toolTipStyles:{background:"rgba(0,0,0,0.8)"},children:a.jsx("button",{className:W,children:e.control})}),a.jsx($,{ToolTip:a.jsx(a.Fragment,{}),toolTipStyles:{background:"rgba(0,0,0,0.8)"},children:a.jsx("button",{className:W,children:e.controller})}),a.jsx($,{ToolTip:a.jsxs(a.Fragment,{children:[a.jsx("p",{className:T({selected:e.control==="orbit"}),onClick:()=>r("orbit"),children:"orbit"}),e.type==="character"&&a.jsx("p",{className:T({selected:e.control==="normal"}),onClick:()=>r("normal"),children:"normal"})]}),toolTipStyles:{background:"rgba(0,0,0,0.8)"},children:a.jsx("button",{className:W,children:e.control})})]})}function Wn(){const e=[v(10,0,10)];for(let t=-10;t<=10;t+=30)for(let n=-10;n<=10;n+=30)e.push(v(t,0,n));return In(),a.jsxs(a.Fragment,{children:[a.jsx(dn,{position:v(10,0,0),rotation:I(),url:"gltf/ally_body.glb",currentAnimation:"jump",rigidbodyType:"fixed",isNotColliding:!0,parts:[{url:"gltf/ally_cloth_rabbit.glb",color:"red"}]}),a.jsx(fn,{position:v(20,0,0),rotation:I(),url:Y+"/gaebird.glb",currentAnimation:"idle",rigidbodyType:"fixed",isNotColliding:!0}),a.jsx("group",{visible:!1,children:a.jsx(un,{position:v(30,0,0),rotation:I(),url:Y+"/gaebird.glb",currentAnimation:"idle",rigidbodyType:"fixed",isNotColliding:!0})})]})}function Xn(){return a.jsxs(a.Fragment,{children:[a.jsx(Ye,{renderOrder:-1,position:[0,.2,0],infiniteGrid:!0,cellSize:2,cellThickness:1,cellColor:"#1d1d1d",sectionSize:5,sectionThickness:0,fadeDistance:1e3,userData:{intangible:!0}}),a.jsxs(Ee,{type:"fixed",userData:{intangible:!0},children:[a.jsx("mesh",{receiveShadow:!0,position:[0,-1,0],children:a.jsx("boxGeometry",{args:[1e3,2,1e3]})}),a.jsx(pn,{type:"ground",children:a.jsxs("mesh",{receiveShadow:!0,position:[0,.1,0],rotation:[-Math.PI/2,0,0],children:[a.jsx("planeGeometry",{args:[1e3,1e3]}),a.jsx("meshStandardMaterial",{color:"#3d3d3d"})]})})]})]})}var Zn="wvg6fc5",Hn="wvg6fc7",Kn="wvg6fc8";Ve({defaultClassName:"wvg6fcc",variantClassNames:{control:{true:"wvg6fcd"}},defaultVariants:{},compoundVariants:[]});var Jn="wvg6fce dsxi6z82 dsxi6z88";function Yn({radius:e=2.75,speed:t=6,...n}){const r=l.useRef();return Q(o=>{const i=o.clock.getElapsedTime()*t;r.current&&r.current.position.set(Math.sin(i)*e,Math.cos(i)*e*Math.atan(i)/Math.PI/1.25,0)}),a.jsx("group",{...n,children:a.jsx(et,{local:!0,width:5,length:6,color:new it(2,1,10),attenuation:o=>o*o,children:a.jsxs("mesh",{ref:r,children:[a.jsx("sphereGeometry",{args:[.25]}),a.jsx("meshBasicMaterial",{color:[10,1,10],toneMapped:!1})]})})})}const Y="https://jiggloghttps.s3.ap-northeast-2.amazonaws.com/gltf";function Qn(){const e="gltf/ally_body.glb",t=Y+"/gaebird.glb",n=Y+"/gorani.glb";return a.jsxs(En,{urls:{characterUrl:e,vehicleUrl:n,airplaneUrl:t},mode:{type:"character",controller:"clicker",control:"normal"},debug:!1,cameraOption:{XDistance:20,YDistance:20,ZDistance:20},children:[a.jsxs(Ze,{shadows:!0,dpr:[1,2],camera:{position:[0,10,20],fov:45,near:.1,far:1e3},style:{width:"100vw",height:"100vh",position:"fixed"},frameloop:"demand",children:[a.jsx(Qe,{background:!0,preset:"sunset",backgroundBlurriness:1}),a.jsx("directionalLight",{castShadow:!0,"shadow-normalBias":.06,position:[20,30,10],intensity:.5,"shadow-mapSize":[1024,1024],"shadow-camera-near":1,"shadow-camera-far":50,"shadow-camera-top":50,"shadow-camera-right":50,"shadow-camera-bottom":-50,"shadow-camera-left":-50}),a.jsx("directionalLight",{castShadow:!0,"shadow-normalBias":.06,position:[-200,30,-100],intensity:.7,"shadow-mapSize":[5e3,5e3],"shadow-camera-near":1,"shadow-camera-far":50,"shadow-camera-top":50,"shadow-camera-right":50,"shadow-camera-bottom":-50,"shadow-camera-left":-50}),a.jsx(l.Suspense,{children:a.jsxs(rt,{debug:!0,interpolate:!0,children:[a.jsx(xn,{onAnimate:({control:r,subscribe:o})=>{o({tag:"greet",condition:()=>r==null?void 0:r.keyZ})},controllerOptions:{lerp:{cameraTurn:.1,cameraPosition:1}},rigidBodyProps:{},parts:[{url:"gltf/ally_cloth_rabbit.glb",color:"#ffe0e0"}]}),a.jsx(Xn,{}),a.jsx(Wn,{}),a.jsx(Yn,{}),a.jsx(vn,{onMarker:a.jsx("group",{rotation:I({x:0,y:Math.PI/2,z:0}),children:a.jsx(Me,{position:v(0,1,0),children:a.jsx(ve,{style:{color:"#f4ffd4",fontSize:"5rem"}})})}),runMarker:a.jsx(Me,{position:v(0,1,0),children:a.jsx(ve,{style:{color:"#ffac8e",fontSize:"5rem"}})})})]})})]}),a.jsx($n,{}),a.jsx("div",{className:Hn,children:a.jsx("div",{className:Jn,children:a.jsx(Mn,{label:{keyZ:"GREET",shift:"SPLINT",space:"JUMP"}})})}),a.jsx("div",{className:Kn,children:a.jsx("div",{className:Zn,children:a.jsx(Nn,{})})})]})}function er(){return a.jsx(Qn,{})}tt.createRoot(document.getElementById("root")).render(a.jsx(z.StrictMode,{children:a.jsx(er,{})}));
