# 시냅스(가소성) 연구 메모 — 전기 신호로 “누구와 붙는가?”

## 0. 목적과 범위
이 문서는 “뉴런이 어느 뉴런과 연결(시냅스)을 강화/약화/형성할지”를 **생물학 기반**으로 정리하고, (구현 미포함) 토이 실험에 **어디까지 / 어떤 방식으로** 붙일 수 있는지의 최소 설계를 남깁니다.

- 목표는 **뇌 전체의 정밀 생물물리 시뮬레이션**이 아니라,
  - (A) **활동-의존 시냅스 가소성**(STDP 등) 규칙을 명시하고
  - (B) 토이 모듈(가정: experiment / metric / dopamine / lbo)에
  - (C) 구현 가능한 형태로 매핑하는 것입니다.

> 주의: “발달/배선(화학적 guidance)”까지 포함한 구조 형성은 이 레포 범위 밖입니다. 여기서는 “전기 활동(스파이크) 기반의 연결 강도 변화”를 중심으로 다룹니다.


## 1. 생물학에서 ‘붙는다’의 두 층
“붙는다”는 말을 엄밀히 나누면 다음 두 층입니다.

- **구조적 가소성(structural plasticity)**: 실제로 시냅스가 생기고 사라짐(스파인 형성/제거).
- **기능적 가소성(synaptic plasticity)**: 이미 존재하는 시냅스의 **강도 $w_{ij}$** 가 변함(LTP/LTD).

전기 신호 기반 규칙(STDP 등)은 기본적으로 **기능적 가소성**을 직접 기술합니다.  
“구조적”을 넣고 싶다면, 기능적 가소성으로 업데이트된 $w_{ij}$에 임계치/예산 제약을 걸어 “연결의 on/off”로 해석하는 최소 규칙을 추가합니다(5절).


## 2. 최소 모델: 방향성 시냅스와 스파이크
### 2.1 방향성
생물학적 화학 시냅스는 기본적으로 **방향성**이 있습니다(축삭(pre) → 수상돌기(post)).

- 가중치 $w_{ij}$: “뉴런 $i$가 뉴런 $j$에 미치는 영향”(방향성).
- 따라서 일반적으로 $w_{ij} \neq w_{ji}$ 입니다.

### 2.2 전기 신호의 최소 표현
전기 신호를 가장 간단히 수학화하면 **스파이크 이벤트**입니다.

- 이산 시간 $t$에서 스파이크 지시변수: $s_i[t] \in \{0,1\}$
- 연속 활동 $u_i[t]$가 있다면, 스파이크는 예를 들어 아래처럼 정의할 수 있습니다.
  - 임계치: $s_i[t] = \mathbf{1}[u_i[t] > \theta]$
  - 확률적(발화율): $s_i[t] \sim \mathrm{Bernoulli}(\sigma(u_i[t]))$
같은 형태로 정의할 수 있습니다.


## 3. 대표 규칙: STDP(Spike-Timing Dependent Plasticity)
STDP의 핵심은 “pre가 먼저, post가 뒤” 같은 **시간차(인과성)** 입니다.

### 3.1 쌍(spike pair) 기반 STDP(개념식)
$\Delta t = t_{\mathrm{post}} - t_{\mathrm{pre}}$ 일 때:

$$
\Delta w_{ij}=
\begin{cases}
A_+\exp(-\Delta t/\tau_+) & \Delta t>0 \\
-A_-\exp(\Delta t/\tau_-) & \Delta t<0
\end{cases}
$$

### 3.2 trace 기반 STDP(구현 친화, 이산 시간)
실제 구현에서는 “최근 스파이크의 흔적(trace)”를 상태로 유지합니다.

- pre trace $p_i[t]$, post trace $q_i[t]$:

$$
p_i[t+1] = \lambda_+ p_i[t] + s_i[t],\qquad
q_i[t+1] = \lambda_- q_i[t] + s_i[t]
$$

- 업데이트 예시(방향 $i\to j$):

$$
\Delta w_{ij}[t]
=
\eta\Big(A_+\,p_i[t]\,s_j[t]-A_-\,s_i[t]\,q_j[t]\Big)
$$

해석:
- $s_j[t]=1$ (post 발화) 시점에 pre의 흔적 $p_i$가 크면 강화(LTP).
- $s_i[t]=1$ (pre 발화) 시점에 post의 흔적 $q_j$가 크면 약화(LTD).


## 4. 3-factor 학습(도파민/보상 신호로 조절)
STDP(2-factor)가 “학습이 항상 일어난다”라면, 생물학에서는 종종 **전역 신호(도파민 등)** 가 학습을 ‘허용/강화’합니다.

### 4.1 eligibility trace + 도파민
가장 단순한 형태는:

- eligibility $e_{ij}$를 누적
- 도파민성 신호 $\delta[t]$가 있을 때만 $w_{ij}$를 변경

$$
e_{ij}[t+1]
=
\lambda_e e_{ij}[t]
+
\Big(A_+\,p_i[t]\,s_j[t]-A_-\,s_i[t]\,q_j[t]\Big)
$$

$$
\Delta w_{ij}[t]=\eta\,\delta[t]\,e_{ij}[t]
$$

이 3-factor 형태는 2-factor(STDP)의 **상위호환**입니다.
- 게이트를 항상 열어두면(예: $\delta[t]\equiv 1$) “항상 학습”하는 2-factor 계열로 환원됩니다.
- 반대로 $\delta[t]=0$이면 해당 시점에는 학습이 일어나지 않습니다.

레포 매핑 관점:
- DopamineGate는 “오차 급등”을 사건 신호로 쓰는 토이 게이트로 해석할 수 있습니다.
- 이를 $\delta[t]\in\{0,1\}$로 해석하면 3-factor의 최소 형태를 구성할 수 있습니다.


## 5. “붙는다/끊긴다”(구조적 가소성)의 최소 규칙
STDP는 기본적으로 연속 가중치 업데이트입니다. 이를 “연결 형성/제거”로 쓰려면 보통 아래를 추가합니다.

- **임계치 on/off(히스테리시스 권장)**:
  - $w_{ij} \ge w_{\mathrm{on}}$이면 연결로 간주
  - $w_{ij} \le w_{\mathrm{off}}$이면 제거($w_{\mathrm{off}} < w_{\mathrm{on}}$)
- **희소성/예산**:
  - 뉴런당 상위 $k$개만 유지(top-k pruning)
  - 총 시냅스 수 예산 고정
- **폭주 방지(homeostasis)**:
  - 가중치 클램프($0 \le w_{ij} \le w_{\max}$)
  - synaptic scaling(행/열 정규화로 총 입력/출력 보존)
  - 평균 발화율 타깃(BCM 류) 등

수학적으로는 위의 “희소화/클램프/히스테리시스”를 하나의 투영(또는 제약) 연산자 \(\Pi\)로 묶어,

$$
W_{t+1}=\Pi\!\big(W_t+\Delta W_t\big)
$$

처럼 쓸 수 있습니다. \(\Pi\)를 항등 연산자로 두면(제약을 끄면) 원래의 연속 업데이트로 정확히 환원되며, 제약을 켜면 구조적 가소성(붙음/끊김)을 “최소 규칙”으로 포함하는 상위호환 형태가 됩니다.

토이 실험에서는 top-k, decay, clamp 같은 제약이 유용하며, 연결 업데이트 규칙(metric)에 포함시키는 것이 자연스럽습니다.


## 6. “토션”은 생물학 표준식이 아니다(하지만 분석 지표로는 가능)
가소성 문맥에서 “토션”은 표준 단일 수식으로 굳어져 있지 않습니다.  
“방향성/순환 회로가 얼마나 강한가”를 보고 싶다면, **분석 도구**로 아래 최소 분해를 사용할 수 있습니다.

- 방향 가중치 행렬 $W$를 아래처럼 분해합니다.

$$
S=\frac{W+W^\top}{2},\qquad
A=\frac{W-W^\top}{2}
$$

로 분해합니다.
- $S$: 상호 결합(대칭) 성분(확산/스무딩과 궁합이 좋음)
- $A$: 방향성/비대칭 성분(피드백/순환 구조가 강할수록 커질 수 있음)

특히 $A=0$이면 완전 대칭 결합만 남아, 확산/스무딩(그래프 라플라시안) 해석으로 깔끔하게 환원됩니다.

이는 “토션의 생물학 법칙”이 아니라, 네트워크를 이해하기 위한 최소 수학적 요약입니다.


## 7. (가정) 구현/실험 포인트(최소 매핑)
메인 IGD 루프는 게임 설계 최적화가 목적이라, 뉴런 가소성 수식은 바로 들어가지 않습니다.  
대신 토이 실험 모듈에 붙이는 것이 KISS합니다.

- **실험 엔진**: experiment
  - 현재는 연속 활동 $u$ + 확산($-Lu$) + 게이트 시 metric 업데이트 구조
- **가중치 업데이트 규칙**: metric
  - 현재는 “활동 유사도 → 대칭 $W$ 학습”
  - 생물학 기반으로 바꾸려면: (i) 방향성 $w_{ij}$, (ii) trace/eligibility 상태가 필요
- **사건/보상 게이트**: dopamine
  - $\delta[t]$로 해석 가능(3-factor)
- **확산/스무딩(토이)**: lbo
  - 생물학적 정합을 강하게 주장하기보다는 “잡음 억제/공간적 매끈함”을 위한 모델링 항으로 취급


## 8. 구현 전 결정해야 하는 최소 스펙(체크리스트)
아래가 정해지면 “전기 신호로 연결 판정” 규칙을 코드로 고정할 수 있습니다.

- 스파이크 정의: 임계치 vs 확률발화(발화율)
- 시간 해상도: $\Delta t$, $\tau_+$, $\tau_-$, $\tau_e$
- 부호/클램프: 흥분성만 허용(비음수) vs 억제성 포함(부호 허용)
- 희소성 제약: top-k 유지 여부
- 도파민 신호: `DopamineGate`를 그대로 쓸지(오차 기반), 아니면 보상 기반으로 바꿀지


## 9. 다음 작업(원하면)
문서에서 끝내지 않고 토이 실험에 붙이는 경우의 최소 단계:

1) experiment에 스파이크 $s[t]$를 정의(임계치)
2) trace $p,q$ 추가
3) (선택) eligibility $e$ + DopamineGate를 $\delta[t]$로 사용
4) $W$ 업데이트를 STDP/3-factor로 교체(희소성/클램프 유지)
5) (선택) “게이트가 있을 때 적응이 빨라진다” 같은 어블레이션을 추가

